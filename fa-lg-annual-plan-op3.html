<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>FA ‚Äì LG Annual | ‡∏≠‡∏õ‡∏ó.3 ‚Äì ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (Understanding the Entity)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#060818;
      --card:#11152b;
      --border:#262b46;
      --accent:#42a5f5;
      --accent2:#26c6da;
      --muted:#a3acc7;
      --text:#f5f7ff;
      --pink:#f48fb1;
    }
    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, sans-serif;
      background:
        radial-gradient(circle at 10% 0%, rgba(123,30,60,0.36) 0, transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(66,165,245,0.32) 0, transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(38,198,218,0.22) 0, transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
      font-size:140%;
    }

    header{
      padding:16px 10px 12px;
      text-align:center;
      background:linear-gradient(120deg,#0d47a1,#42a5f5,#26c6da);
      box-shadow:0 4px 16px rgba(0,0,0,0.7);
      position:sticky;
      top:0;
      z-index:20;
    }
    header h2{ margin:0; font-size:20px; }
    header .sub{ font-size:13px; opacity:.9; }

    main{
      max-width:1100px;
      margin:20px auto 28px;
      padding:0 16px 20px;
    }

    .nav-top{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }
    .btn-nav{
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.45);
      background:rgba(0,0,0,0.35);
      color:#fff;
      font-size:12px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-nav:hover{ background:rgba(0,0,0,0.6); }

    .card{
      background:var(--card);
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      padding:16px 14px 16px;
      box-shadow:0 10px 30px rgba(0,0,0,0.9);
      margin-bottom:16px;
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      margin-bottom:10px;
    }
    .card-title{
      font-size:16px;
      font-weight:600;
    }
    .card-sub{
      font-size:12px;
      color:var(--muted);
    }
    .chip{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.2);
      font-size:11px;
      background:rgba(0,0,0,0.35);
      white-space:nowrap;
    }

    .form-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:10px 14px;
      margin-top:4px;
    }

    label{
      font-size:12px;
      display:block;
      margin-bottom:2px;
      color:#e3f2fd;
    }
    .input, select, textarea{
      width:100%;
      padding:6px 8px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#080c1b;
      color:var(--text);
      font-size:12px;
    }
    textarea{
      min-height:70px;
      resize:vertical;
    }
    .input:focus, select:focus, textarea:focus{
      outline:none;
      border-color:var(--accent2);
      box-shadow:0 0 0 1px rgba(38,198,218,0.5);
    }

    .section-title{
      font-size:14px;
      font-weight:600;
      margin:10px 0 6px;
    }
    .hint{
      font-size:11px;
      color:var(--muted);
      margin-bottom:6px;
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .btn{
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.4);
      background:rgba(0,0,0,0.4);
      color:#fff;
      font-size:12px;
      cursor:pointer;
    }
    .btn-primary{
      border-color:var(--accent);
      background:linear-gradient(120deg,#0d47a1,#42a5f5);
    }
    .btn-danger{
      border-color:#f44336;
      background:linear-gradient(120deg,#b71c1c,#f44336);
    }
    .btn-success{
      border-color:#4caf50;
      background:linear-gradient(120deg,#1b5e20,#4caf50);
    }
    .btn-info{
      border-color:#26c6da;
      background:linear-gradient(120deg,#006064,#26c6da);
    }
    .btn-ai{
      border-color:#f48fb1;
      background:linear-gradient(120deg,#7b1e3c,#f48fb1);
    }
    .btn-sm{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.4);
      background:rgba(0,0,0,0.45);
      color:#fff;
      cursor:pointer;
    }
    .btn:hover,
    .btn-sm:hover{
      background:rgba(0,0,0,0.7);
    }
    .btn-primary:hover,
    .btn-danger:hover,
    .btn-success:hover,
    .btn-info:hover,
    .btn-ai:hover{
      filter:brightness(1.1);
    }

    .ai-btn-inline{
      margin-top:4px;
      display:inline-flex;
      gap:6px;
      flex-wrap:wrap;
    }

    .footer-note{
      font-size:10px;
      color:var(--muted);
      margin-top:6px;
    }

    .file-list{
      font-size:11px;
      color:var(--muted);
      margin-top:4px;
      max-height:80px;
      overflow:auto;
    }

    /* ---------- A4 PREVIEW ---------- */
    .a4-wrapper{
      margin-top:18px;
    }

    .a4-title{
      font-size:14px;
      font-weight:600;
      margin-bottom:6px;
    }

    .a4-page{
      width:210mm;
      min-height:297mm;
      margin:0 auto 16px;
      background:#ffffff;
      color:#000000;
      box-shadow:0 0 8px rgba(0,0,0,0.5);
      padding:12mm;
      font-size:11pt;
      position:relative;
    }

    .a4-header-center{
      text-align:center;
      margin-bottom:6px;
      font-size:12pt;
      font-weight:600;
    }
    .a4-subheader{
      text-align:center;
      font-size:10pt;
      margin-bottom:8px;
    }
    .a4-row{
      display:flex;
      justify-content:space-between;
      font-size:10pt;
      margin-bottom:4px;
    }
    .a4-row span{
      display:inline-block;
      min-width:80px;
    }
    .a4-row .value{
      border-bottom:1px solid #000;
      min-width:160px;
      display:inline-block;
      padding:0 2px;
    }

    .a4-block-title{
      font-size:10pt;
      font-weight:600;
      margin-top:8px;
    }
    .a4-block-content{
      font-size:10pt;
      margin-top:3px;
    }

    .a4-footer{
      position:absolute;
      bottom:8mm;
      left:12mm;
      right:12mm;
      font-size:8pt;
      display:flex;
      justify-content:space-between;
    }

    /* PRINT */
    @page{
      size:A4;
      margin:12mm;
    }
    @media print{
      body{
        background:#ffffff;
        color:#000000;
        font-size:11pt;
      }
      header,
      .nav-top,
      .card:not(.card-a4),
      .no-print{
        display:none !important;
      }
      .a4-page{
        box-shadow:none;
        margin:0;
        width:auto;
        min-height:auto;
        padding:0;
      }
      main{
        max-width:100%;
        margin:0;
        padding:0;
      }
    }

    @media (max-width:900px){
      .a4-page{
        width:100%;
        min-height:auto;
      }
    }

    @media (max-width:600px){
      .card-header{
        flex-direction:column;
        align-items:flex-start;
      }
    }
  </style>
</head>
<body>

<header>
  <h2>üèõÔ∏è ‡∏≠‡∏õ‡∏ó.3 ‚Äì ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (Understanding the Entity)</h2>
  <div class="sub">
    Understanding the Entity & Internal Control ‚Äì ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô
  </div>
</header>

<main>

  <div class="nav-top">
    <a href="fa-lg-annual-plan.html" class="btn-nav">
      <span>üß≠</span> ‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô
    </a>
    <a href="fa-lg-annual.html" class="btn-nav">
      <span>üìÖ</span> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à
    </a>
    <a href="fa-menu.html" class="btn-nav">
      <span>üìÇ</span> FA Main Menu
    </a>
    <a href="index.html" class="btn-nav">
      <span>üè†</span> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    </a>
  </div>

  <!-- CARD 1: Basic info -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‚Äì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</div>
        <div class="card-sub">
          ‡∏ú‡∏π‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‚Äì‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‚Äì‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
          ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
        </div>
      </div>
      <div class="chip">‡∏≠‡∏õ‡∏ó.3 ‚Ä¢ Understanding</div>
    </div>

    <div class="hint">
      ‚öôÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å <code>localStorage["fa-db-data-gov"]</code>  
      ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ <code>fa-db-data-gov.html</code> ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
    </div>
    <div id="govDbStatus" class="hint"></div>

    <div class="form-grid">
      <div>
        <label for="fy">‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (2565 ‚Äì 2582)</label>
        <select id="fy" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‚Äî</option>
          <option>2565</option><option>2566</option><option>2567</option>
          <option>2568</option><option>2569</option><option>2570</option>
          <option>2571</option><option>2572</option><option>2573</option>
          <option>2574</option><option>2575</option><option>2576</option>
          <option>2577</option><option>2578</option><option>2579</option>
          <option>2580</option><option>2581</option><option>2582</option>
        </select>
      </div>

      <div>
        <label for="period">‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (30 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2566 ‚Äì 2582)</label>
        <select id="period" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‚Äî</option>
          <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
        </select>
      </div>

      <div>
        <label for="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á)</label>
        <select id="province" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‚Äî</option>
        </select>
      </div>

      <div>
        <label for="amphoe">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï (‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á)</label>
        <select id="amphoe" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï ‚Äî</option>
        </select>
      </div>

      <div>
        <label for="auditee">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / ‡∏≠‡∏õ‡∏ó. (‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á)</label>
        <select id="auditee" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî</option>
        </select>
      </div>

      <div>
        <label for="formRef">‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏≠‡∏õ‡∏ó.3 ‚Äì ‡∏≠‡∏õ‡∏ó.8.31)</label>
        <select id="formRef" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‚Äî</option>
          <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
        </select>
      </div>
    </div>

    <div class="section-title">1.2 ‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</div>
    <textarea id="orgContext" class="input" placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó., ‡∏Ç‡∏ô‡∏≤‡∏î‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì, ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà, ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏Ø‡∏•‡∏Ø"></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('orgContext','‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πà‡∏≤‡∏á/‡∏™‡∏£‡∏∏‡∏õ</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('orgContext')">üìé ‡πÅ‡∏ô‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏î‡∏¥‡∏ö‡πÑ‡∏ü‡∏•‡πå/‡πÄ‡∏ß‡πá‡∏ö</button>
    </div>
  </section>

  <!-- CARD 2: Data source (file / web) -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‚Äì ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</div>
        <div class="card-sub">
          ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå (CSV/Excel/Text) ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö (‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡∏≠‡∏õ‡∏ó., e-LAAS, BI ‡∏Ø‡∏•‡∏Ø)
          ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
        </div>
      </div>
      <div class="chip">Data Source ‚Ä¢ File / Web</div>
    </div>

    <div class="section-title">2.1 ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</div>
    <div class="form-grid">
      <div>
        <label for="dataFiles">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏ä‡πà‡∏ô CSV, TXT, JSON ‡∏Ø‡∏•‡∏Ø)</label>
        <input id="dataFiles" class="input" type="file" multiple onchange="handleFiles(this.files)">
      </div>
      <div>
        <label>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</label>
        <div id="fileList" class="file-list">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</div>
      </div>
    </div>

    <div class="section-title">2.2 ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Web / API</div>
    <div class="form-grid">
      <div>
        <label for="dataUrl">URL (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡∏≠‡∏õ‡∏ó., e-LAAS, BI ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô)</label>
        <input id="dataUrl" class="input" type="url" placeholder="‡πÄ‡∏ä‡πà‡∏ô https://example.go.th/report/2567">
      </div>
      <div>
        <label>&nbsp;</label>
        <button type="button" class="btn" onclick="fetchFromWeb()">üåê ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Web (‡∏ó‡∏î‡∏•‡∏≠‡∏á)</button>
      </div>
    </div>

    <div class="section-title">2.3 ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</div>
    <textarea id="rawData" class="input" placeholder="‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞ URL ‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πà‡∏≠"></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('rawData','‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡πÇ‡∏Ñ‡∏£‡∏á/‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>

    <div class="footer-note">
      * ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel/‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏ö‡∏ô‡∏≤‡∏£‡∏µ ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô CSV/TXT ‡∏Å‡πà‡∏≠‡∏ô  
      * ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Web ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢ CORS ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
    </div>
  </section>

  <!-- CARD 3: Understanding entity -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 ‚Äì ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à ‡πÅ‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</div>
        <div class="card-sub">
          ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏≠‡∏õ‡∏ó., ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å, ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
        </div>
      </div>
      <div class="chip">Org Structure ‚Ä¢ Environment</div>
    </div>

    <div class="section-title">3.1 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å</div>
    <div class="hint">
      ‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£/‡∏Å‡∏≠‡∏á, ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢, ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å, ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç, ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏Ø‡∏•‡∏Ø
    </div>
    <textarea id="orgStructure" class="input" placeholder="‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á ‡∏≠‡∏õ‡∏ó."></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('orgStructure','‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('orgStructure')">üìé ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>

    <div class="section-title">3.2 ‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</div>
    <div class="hint">
      ‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à/‡∏™‡∏±‡∏á‡∏Ñ‡∏°, ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏†‡∏±‡∏¢‡∏û‡∏¥‡∏ö‡∏±‡∏ï‡∏¥, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô, ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏Ø‡∏•‡∏Ø
    </div>
    <textarea id="environment" class="input" placeholder="‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à"></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('environment','‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('environment')">üìé ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>
  </section>

  <!-- CARD 4: Legal / revenue / IC / IT -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4 ‚Äì ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢/‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</div>
        <div class="card-sub">
          ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢, ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢, ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
        </div>
      </div>
      <div class="chip">Law ‚Ä¢ IC ‚Ä¢ IT System</div>
    </div>

    <div class="section-title">4.1 ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</div>
    <div class="hint">
      ‡πÄ‡∏ä‡πà‡∏ô ‡∏û.‡∏£.‡∏ö. ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á, ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á, ‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô, ‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á/‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏Ø‡∏•‡∏Ø
    </div>
    <textarea id="legalFramework" class="input" placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢/‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á ‡∏≠‡∏õ‡∏ó."></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('legalFramework','‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('legalFramework')">üìé ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>

    <div class="section-title">4.2 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</div>
    <div class="hint">
      ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏Å, ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏≤‡∏ß, ‡∏†‡∏≤‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥, ‡∏Å‡∏≤‡∏£‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏á‡∏ö‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô ‡∏Ø‡∏•‡∏Ø
    </div>
    <textarea id="revenueExpense" class="input" placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç"></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('revenueExpense','‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('revenueExpense')">üìé ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>

    <div class="section-title">4.3 ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</div>
    <div class="hint">
      ‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ó‡∏ô‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£, ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏¢‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà, ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï, ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô, ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö 5 ‡∏î‡πâ‡∏≤‡∏ô ‡∏Ø‡∏•‡∏Ø
    </div>
    <textarea id="internalControl" class="input" placeholder="‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó.11.1.3/11.1.4 ‡πÅ‡∏•‡∏∞ 11.1.5)"></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('internalControl','‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('internalControl')">üìé ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>

    <div class="section-title">4.4 ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div>
    <div class="hint">
      ‡πÄ‡∏ä‡πà‡∏ô e-LAAS, ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ, ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏, ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏•‡∏±‡∏á, BI ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏Ø‡∏•‡∏Ø
    </div>
    <textarea id="itSystems" class="input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('itSystems','‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('itSystems')">üìé ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>
  </section>

  <!-- CARD 5: Risk summary -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5 ‚Äì ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</div>
        <div class="card-sub">
          ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à
          ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (‡∏≠‡∏õ‡∏ó.4, 3.5, 3.6, 11.1.5 ‡∏Ø‡∏•‡∏Ø)
        </div>
      </div>
      <div class="chip">Key Risks ‚Ä¢ Issues</div>
    </div>

    <div class="section-title">5.1 ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div>
    <div class="hint">
      ‡πÄ‡∏ô‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™
    </div>
    <textarea id="keyRisks" class="input" placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ, ‡∏û‡∏±‡∏™‡∏î‡∏∏, ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ñ‡∏≤‡∏ß‡∏£, ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô, ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‚Äì‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î ‡∏Ø‡∏•‡∏Ø"></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('keyRisks','‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('keyRisks')">üìé ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>

    <div class="section-title">5.2 ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏∑‡πà‡∏ô ‡πÜ / ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</div>
    <textarea id="otherNotes" class="input" placeholder="‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏°‡∏Ñ‡∏ß‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
    <div class="ai-btn-inline no-print">
      <button type="button" class="btn-sm btn-ai" onclick="aiSuggestForField('otherNotes','‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏∑‡πà‡∏ô ‡πÜ / ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô')">ü§ñ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</button>
      <button type="button" class="btn-sm" onclick="appendRawDataTo('otherNotes')">üìé ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
    </div>
  </section>

  <!-- CARD 6: AI Overall + integration -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6 ‚Äì ‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö</div>
        <div class="card-sub">
          ‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£
        </div>
      </div>
      <div class="chip">AI Summary ‚Ä¢ Review / Working Paper</div>
    </div>

    <div class="section-title">6.1 ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ AI/‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</div>
    <textarea id="aiQuestion" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‚Äì‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô ‡∏≠‡∏õ‡∏ó.4"></textarea>

    <div class="section-title">6.2 ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏î‡∏¢ AI / ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
    <textarea id="aiOverall" class="input" placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"></textarea>

    <div class="btn-row no-print">
      <button type="button" class="btn-ai" onclick="fakeAiAnalyzeAll()">ü§ñ ‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á (Prototype)</button>
      <button type="button" class="btn" onclick="pushToA4()">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° A4</button>
      <button type="button" class="btn-success" onclick="sendToReviewSystem()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô (Review)</button>
      <button type="button" class="btn-info" onclick="sendToWorkingpaperDb()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ (WP DB)</button>
    </div>

    <div class="footer-note">
      * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô AI ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Prototype ‡πÉ‡∏ô Browser ‚Äì ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API AI ‡∏à‡∏£‡∏¥‡∏á‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ  
      * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏£‡∏π‡∏õ JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô
    </div>
  </section>

  <!-- CARD 7: A4 + Export -->
  <section class="card card-a4">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 7 ‚Äì ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö A4 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå / ‡πÅ‡∏ô‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</div>
        <div class="card-sub">
          ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‚Äì‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4
        </div>
      </div>
      <div class="chip">A4 Layout ‚Ä¢ Export</div>
    </div>

    <div class="btn-row no-print">
      <button type="button" class="btn" onclick="pushToA4()">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° A4</button>
      <button type="button" class="btn btn-primary" onclick="window.print()">‡∏û‡∏¥‡∏°‡∏û‡πå / Export PDF (A4)</button>
      <button type="button" class="btn" onclick="exportA4Html()">Export ‡πÄ‡∏õ‡πá‡∏ô HTML (A4 ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤)</button>
      <button type="button" class="btn btn-danger" onclick="exportJson()">Export ‡πÄ‡∏õ‡πá‡∏ô JSON (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°)</button>
      <button type="button" class="btn-success" onclick="sendToReviewSystem()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô (Review)</button>
      <button type="button" class="btn-info" onclick="sendToWorkingpaperDb()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ (WP DB)</button>
    </div>

    <div class="a4-wrapper">
      <div class="a4-title">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3 ‚Äì ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4</div>

      <div class="a4-page" id="a4Page">
        <div class="a4-header-center">
          ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3 ‚Äì ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (Understanding the Entity)
        </div>
        <div class="a4-subheader">
          ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô
        </div>

        <div class="a4-row">
          <div>
            <span>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</span>
            <span class="value" id="a4Fy">&nbsp;</span>
          </div>
          <div>
            <span>‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
            <span class="value" id="a4Period">&nbsp;</span>
          </div>
        </div>
        <div class="a4-row">
          <div>
            <span>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</span>
            <span class="value" id="a4Auditee">&nbsp;</span>
          </div>
          <div>
            <span>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï</span>
            <span class="value" id="a4Amphoe">&nbsp;</span>
          </div>
        </div>
        <div class="a4-row">
          <div>
            <span>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</span>
            <span class="value" id="a4Province">&nbsp;</span>
          </div>
          <div>
            <span>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</span>
            <span class="value" id="a4FormRef">&nbsp;</span>
          </div>
        </div>

        <div class="a4-block-title">1. ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</div>
        <div class="a4-block-content" id="a4OrgContext"></div>

        <div class="a4-block-title">2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (‡∏™‡∏£‡∏∏‡∏õ)</div>
        <div class="a4-block-content" id="a4RawData"></div>

        <div class="a4-block-title">3. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à ‡πÅ‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</div>
        <div class="a4-block-content">
          <strong>3.1 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å</strong>
          <div id="a4OrgStructure"></div>
        </div>
        <div class="a4-block-content">
          <strong>3.2 ‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</strong>
          <div id="a4Environment"></div>
        </div>

        <div class="a4-block-title">4. ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢/‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</div>
        <div class="a4-block-content">
          <strong>4.1 ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</strong>
          <div id="a4LegalFramework"></div>
        </div>
        <div class="a4-block-content">
          <strong>4.2 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</strong>
          <div id="a4RevenueExpense"></div>
        </div>
        <div class="a4-block-content">
          <strong>4.3 ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</strong>
          <div id="a4InternalControl"></div>
        </div>
        <div class="a4-block-content">
          <strong>4.4 ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</strong>
          <div id="a4ItSystems"></div>
        </div>

        <div class="a4-block-title">5. ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</div>
        <div class="a4-block-content">
          <strong>5.1 ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</strong>
          <div id="a4KeyRisks"></div>
        </div>
        <div class="a4-block-content">
          <strong>5.2 ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏∑‡πà‡∏ô ‡πÜ / ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</strong>
          <div id="a4OtherNotes"></div>
        </div>

        <div class="a4-block-title">6. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏î‡∏¢ AI / ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
        <div class="a4-block-content" id="a4AiOverall"></div>

        <div class="a4-footer">
          <div>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3 ‚Äì Understanding the Entity ‚Äì FA LG Annual</div>
          <div id="a4FooterMeta">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö FA ‚Äì LG</div>
        </div>
      </div>
    </div>
  </section>

</main>

<script>
  /* ---------- Helper ---------- */

  function nl2br(text){
    if(!text) return '';
    return text.replace(/\n/g,'<br>');
  }

  function setStatus(msg, isError){
    const el = document.getElementById('govDbStatus');
    if(!el) return;
    el.textContent = msg || '';
    el.style.color = isError ? '#ffab91' : '#a3acc7';
  }

  /* ---------- Gov DB (fa-db-data-gov) ---------- */

  let LG_DB = [];

  function getProvinceField(row){
    return row.province || row.Province || row.prov || row['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î'] || '';
  }
  function getAmphoeField(row){
    return row.amphoe || row.district || row.District || row['‡∏≠‡∏≥‡πÄ‡∏†‡∏≠'] || row['‡πÄ‡∏Ç‡∏ï'] || '';
  }
  function getAuditeeNameField(row){
    return (
      row.auditee ||
      row.unitName ||
      row.unit ||
      row['‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à'] ||
      row['‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô'] ||
      ''
    );
  }

  function fillSelectOptions(select, items, placeholder){
    if(!select) return;
    select.innerHTML = '';
    const opt0 = document.createElement('option');
    opt0.value = '';
    opt0.textContent = placeholder;
    select.appendChild(opt0);
    items.forEach(v => {
      const o = document.createElement('option');
      o.value = v;
      o.textContent = v;
      select.appendChild(o);
    });
  }

  function initGovDbFromLocalStorage(){
    try{
      const raw = localStorage.getItem('fa-db-data-gov');
      if(!raw){
        setStatus('‚ö† ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage["fa-db-data-gov"] ‚Äì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ fa-db-data-gov.html ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô', true);
        return;
      }
      const data = JSON.parse(raw);
      if(!Array.isArray(data)){
        setStatus('‚ö† ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• fa-db-data-gov ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Array', true);
        return;
      }
      LG_DB = data;

      const provinces = [...new Set(
        LG_DB.map(getProvinceField).filter(Boolean)
      )].sort((a,b)=>a.localeCompare(b,'th-TH'));

      const provinceSelect = document.getElementById('province');
      fillSelectOptions(provinceSelect, provinces, '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‚Äî');

      setStatus(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${LG_DB.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, false);
    }catch(e){
      console.error(e);
      setStatus('‚ö† ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• fa-db-data-gov ‡∏à‡∏≤‡∏Å localStorage', true);
    }
  }

  function onProvinceChange(){
    const province = document.getElementById('province').value || '';
    const amphoeSelect = document.getElementById('amphoe');
    const auditeeSelect = document.getElementById('auditee');

    if(!province){
      fillSelectOptions(amphoeSelect, [], '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï ‚Äî');
      fillSelectOptions(auditeeSelect, [], '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî');
      return;
    }

    const amphoeList = [...new Set(
      LG_DB
        .filter(row => getProvinceField(row) === province)
        .map(getAmphoeField)
        .filter(Boolean)
    )].sort((a,b)=>a.localeCompare(b,'th-TH'));

    fillSelectOptions(amphoeSelect, amphoeList, '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï ‚Äî');
    fillSelectOptions(auditeeSelect, [], '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî');
  }

  function onAmphoeChange(){
    const province = document.getElementById('province').value || '';
    const amphoe = document.getElementById('amphoe').value || '';
    const auditeeSelect = document.getElementById('auditee');

    if(!province || !amphoe){
      fillSelectOptions(auditeeSelect, [], '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî');
      return;
    }

    const units = LG_DB.filter(row =>
      getProvinceField(row) === province &&
      getAmphoeField(row) === amphoe
    );

    const names = [...new Set(
      units.map(getAuditeeNameField).filter(Boolean)
    )].sort((a,b)=>a.localeCompare(b,'th-TH'));

    fillSelectOptions(auditeeSelect, names, '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî');
  }

  /* ---------- ‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà + ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ---------- */

  function initPeriods(){
    const periodSelect = document.getElementById('period');
    if(!periodSelect) return;
    for(let y=2566; y<=2582; y++){
      const txt = '30 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô ' + y;
      const opt = document.createElement('option');
      opt.value = txt;
      opt.textContent = txt;
      periodSelect.appendChild(opt);
    }
  }

  function initFormRefs(){
    const select = document.getElementById('formRef');
    if(!select) return;

    const formsSet = new Set();

    [
      '‡∏≠‡∏õ‡∏ó.3','‡∏≠‡∏õ‡∏ó.3.1','‡∏≠‡∏õ‡∏ó.4','‡∏≠‡∏õ‡∏ó.5','‡∏≠‡∏õ‡∏ó.5.1','‡∏≠‡∏õ‡∏ó.5.2',
      '‡∏≠‡∏õ‡∏ó.3.5','‡∏≠‡∏õ‡∏ó.3.6',
      '‡∏≠‡∏õ‡∏ó.8.2','‡∏≠‡∏õ‡∏ó.8.2.1','‡∏≠‡∏õ‡∏ó.8.2.2','‡∏≠‡∏õ‡∏ó.8.2.3'
    ].forEach(f => formsSet.add(f));

    for(let i=1; i<=31; i++){
      formsSet.add('‡∏≠‡∏õ‡∏ó.8.' + i);
    }

    const forms = Array.from(formsSet).sort((a,b)=>a.localeCompare(b,'th-TH',{numeric:true}));

    forms.forEach(f => {
      const opt = document.createElement('option');
      opt.value = f;
      opt.textContent = f;
      select.appendChild(opt);
    });
  }

  /* ---------- File & Web data ---------- */

  function handleFiles(files){
    const listEl = document.getElementById('fileList');
    const rawEl  = document.getElementById('rawData');
    if(!files || files.length === 0){
      if(listEl) listEl.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
      return;
    }

    const lines = [];
    const readers = [];
    for(let i=0; i<files.length; i++){
      const f = files[i];
      lines.push(`‚Ä¢ ${f.name} (${f.type || 'unknown'}, ${f.size} bytes)`);
      const reader = new FileReader();
      readers.push(new Promise((resolve) => {
        reader.onload = () => resolve({name:f.name, content:reader.result});
        reader.onerror = () => resolve({name:f.name, content:''});
      }));
      reader.readAsText(f, 'utf-8');
    }

    if(listEl) listEl.innerHTML = lines.join('<br>');

    Promise.all(readers).then(results => {
      let txt = rawEl.value || '';
      if(txt) txt += '\n\n';
      txt += '===== ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î =====\n';
      results.forEach(r => {
        txt += `\n--- ${r.name} ---\n`;
        txt += (r.content || '').substring(0,4000);
        if((r.content || '').length > 4000){
          txt += '\n...[‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö]...\n';
        }
      });
      rawEl.value = txt;
    });
  }

  function fetchFromWeb(){
    const url = document.getElementById('dataUrl').value || '';
    const rawEl = document.getElementById('rawData');
    if(!url){
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏Å‡πà‡∏≠‡∏ô');
      return;
    }
    fetch(url, {mode:'cors'}).then(res => res.text()).then(text => {
      let txt = rawEl.value || '';
      if(txt) txt += '\n\n';
      txt += '===== ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Web: ' + url + ' =====\n';
      txt += text.substring(0,4000);
      if(text.length > 4000){
        txt += '\n...[‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö]...\n';
      }
      rawEl.value = txt;
      alert('‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Web ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ï‡∏±‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö)');
    }).catch(err => {
      console.error(err);
      alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Web ‡πÑ‡∏î‡πâ (‡∏≠‡∏≤‡∏à‡∏ï‡∏¥‡∏î CORS ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢)');
    });
  }

  function appendRawDataTo(fieldId){
    const raw = document.getElementById('rawData').value || '';
    if(!raw){
      alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à"');
      return;
    }
    const el = document.getElementById(fieldId);
    if(!el) return;
    let txt = el.value || '';
    if(txt) txt += '\n\n';
    txt += '[‡∏ï‡∏±‡∏î‡∏ï‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö]\n';
    txt += raw.substring(0,1000);
    if(raw.length > 1000){
      txt += '\n...[‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö]...\n';
    }
    el.value = txt;
  }

  /* ---------- AI helpers ---------- */

  function getBasicMeta(){
    return {
      fy      : document.getElementById('fy').value || '‚Äî',
      period  : document.getElementById('period').value || '‚Äî',
      auditee : document.getElementById('auditee').value || '‚Äî',
      amphoe  : document.getElementById('amphoe').value || '‚Äî',
      province: document.getElementById('province').value || '‚Äî',
      formRef : document.getElementById('formRef').value || '‚Äî'
    };
  }

  function aiSuggestForField(fieldId, label){
    const meta = getBasicMeta();
    const raw  = document.getElementById('rawData').value || '';
    const el   = document.getElementById(fieldId);
    if(!el) return;

    let txt = '';
    txt += `‡∏™‡∏£‡∏∏‡∏õ/‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: ${label}\n`;
    txt += `‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à: ${meta.auditee} ‡∏≠.${meta.amphoe} ‡∏à.${meta.province}\n`;
    txt += `‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${meta.fy} ‡∏á‡∏ß‡∏î ${meta.period} (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°: ${meta.formRef})\n\n`;
    txt += '- ‡πÇ‡∏Ñ‡∏£‡∏á‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ):\n';
    txt += '  ‚Ä¢ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏•‡∏±‡∏Å\n';
    txt += '  ‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå\n';
    txt += '  ‚Ä¢ ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á/‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö\n\n';
    if(raw){
      txt += '[‡∏ï‡∏±‡∏î‡∏ï‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö]\n';
      txt += raw.substring(0,800);
      if(raw.length > 800){
        txt += '\n...[‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö]...\n';
      }
    }

    el.value = txt;
    alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: ' + label + ' ‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ)');
  }

  function fakeAiAnalyzeAll(){
    const meta = getBasicMeta();
    const orgC = document.getElementById('orgContext').value || '';
    const orgS = document.getElementById('orgStructure').value || '';
    const env  = document.getElementById('environment').value || '';
    const law  = document.getElementById('legalFramework').value || '';
    const rev  = document.getElementById('revenueExpense').value || '';
    const ic   = document.getElementById('internalControl').value || '';
    const it   = document.getElementById('itSystems').value || '';
    const risk = document.getElementById('keyRisks').value || '';
    const note = document.getElementById('otherNotes').value || '';
    const q    = document.getElementById('aiQuestion').value || '';
    const raw  = document.getElementById('rawData').value || '';

    let txt = '';
    txt += `‚òÖ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äì ${meta.auditee} ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${meta.fy}\n\n`;
    if(orgC){
      txt += '1) ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à\n';
      txt += orgC.substring(0,800) + '\n\n';
    }
    txt += '2) ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°\n';
    if(orgS) txt += '- ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏´‡∏•‡∏±‡∏Å: ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô 3.1\n';
    if(env)  txt += '- ‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô 3.2\n\n';

    txt += '3) ‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÅ‡∏•‡∏∞ IT\n';
    if(law) txt += '- ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢/‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö: ‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 4.1\n';
    if(rev) txt += '- ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‚Äì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢: ‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 4.2\n';
    if(ic)  txt += '- ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô: ‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 4.3\n';
    if(it)  txt += '- ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®: ‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 4.4\n\n';

    txt += '4) ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô\n';
    if(risk) txt += '- ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 5.1\n';
    if(note) txt += '- ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï/‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô: ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 5.2\n\n';

    if(q){
      txt += '5) ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°\n';
      txt += q + '\n\n';
    }

    if(raw){
      txt += '6) ‡∏ï‡∏±‡∏î‡∏ï‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à\n';
      txt += raw.substring(0,800);
      if(raw.length > 800){
        txt += '\n...[‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö]...\n';
      }
      txt += '\n';
    }

    txt += '\n(‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏£‡πà‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Material ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô/‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ)\n';

    document.getElementById('aiOverall').value = txt;
    alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°)');
  }

  /* ---------- Build data ‡∏Å‡∏•‡∏≤‡∏á ---------- */

  function buildFormData(){
    const data = {
      fiscalYear   : document.getElementById('fy').value || '',
      period       : document.getElementById('period').value || '',
      auditee      : document.getElementById('auditee').value || '',
      amphoe       : document.getElementById('amphoe').value || '',
      province     : document.getElementById('province').value || '',
      formRef      : document.getElementById('formRef').value || '',
      orgContext   : document.getElementById('orgContext').value || '',
      rawData      : document.getElementById('rawData').value || '',
      orgStructure : document.getElementById('orgStructure').value || '',
      environment  : document.getElementById('environment').value || '',
      legalFramework: document.getElementById('legalFramework').value || '',
      revenueExpense: document.getElementById('revenueExpense').value || '',
      internalControl: document.getElementById('internalControl').value || '',
      itSystems    : document.getElementById('itSystems').value || '',
      keyRisks     : document.getElementById('keyRisks').value || '',
      otherNotes   : document.getElementById('otherNotes').value || '',
      aiQuestion   : document.getElementById('aiQuestion').value || '',
      aiOverall    : document.getElementById('aiOverall').value || '',
      meta: {
        formCode : '‡∏≠‡∏õ‡∏ó.3',
        module   : 'FA-LG-Annual-Planning',
        exportedAt: new Date().toISOString()
      }
    };
    return data;
  }

  /* ---------- Sync ‡πÑ‡∏õ A4 ---------- */

  function pushToA4(){
    const d = buildFormData();

    document.getElementById('a4Fy').textContent       = d.fiscalYear || '';
    document.getElementById('a4Period').textContent   = d.period || '';
    document.getElementById('a4Auditee').textContent  = d.auditee || '';
    document.getElementById('a4Amphoe').textContent   = d.amphoe || '';
    document.getElementById('a4Province').textContent = d.province || '';
    document.getElementById('a4FormRef').textContent  = d.formRef || '';

    document.getElementById('a4OrgContext').innerHTML   = nl2br(d.orgContext);
    document.getElementById('a4RawData').innerHTML      = nl2br(d.rawData ? d.rawData.substring(0,1500) + (d.rawData.length>1500 ? '\n...[‡∏ï‡∏±‡∏î‡∏ï‡∏≠‡∏ô]...' : '') : '');
    document.getElementById('a4OrgStructure').innerHTML = nl2br(d.orgStructure);
    document.getElementById('a4Environment').innerHTML  = nl2br(d.environment);
    document.getElementById('a4LegalFramework').innerHTML = nl2br(d.legalFramework);
    document.getElementById('a4RevenueExpense').innerHTML = nl2br(d.revenueExpense);
    document.getElementById('a4InternalControl').innerHTML = nl2br(d.internalControl);
    document.getElementById('a4ItSystems').innerHTML    = nl2br(d.itSystems);
    document.getElementById('a4KeyRisks').innerHTML     = nl2br(d.keyRisks);
    document.getElementById('a4OtherNotes').innerHTML   = nl2br(d.otherNotes);
    document.getElementById('a4AiOverall').innerHTML    = nl2br(d.aiOverall);

    const now = new Date();
    const ts  = now.toLocaleString('th-TH');
    document.getElementById('a4FooterMeta').textContent = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö FA ‚Äì LG ‡∏ì ' + ts;
  }

  /* ---------- Export ---------- */

  function exportA4Html(){
    const a4 = document.getElementById('a4Page');
    if(!a4){
      alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ A4');
      return;
    }
    const htmlContent =
      '<!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><title>OP3-Understanding-A4</title>' +
      '<style>@page{size:A4;margin:12mm;}body{font-family:"TH Sarabun New","Segoe UI",sans-serif;font-size:11pt;} .a4-page{width:100%;min-height:100%;}</style>' +
      '</head><body>' + a4.outerHTML + '</body></html>';

    const blob = new Blob([htmlContent], {type:'text/html'});
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href = url;
    a.download = 'op3_understanding_a4.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function exportJson(){
    const data = buildFormData();
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href = url;
    a.download = 'op3_understanding.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  /* ---------- Integration: Review & Working Papers ---------- */

  function sendToReviewSystem(){
    const data = buildFormData();

    try{
      localStorage.setItem('fa_op3_last_for_review', JSON.stringify(data));
    }catch(e){
      console.error('localStorage error', e);
    }

    /*
    fetch('/api/review-system/op3', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    */

    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3 ‡∏™‡πà‡∏á‡πÑ‡∏õ ‚Äú‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô‚Äù (‡∏à‡∏≥‡∏•‡∏≠‡∏á) ‡πÅ‡∏•‡πâ‡∏ß \n(‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà localStorage: fa_op3_last_for_review)');
  }

  function sendToWorkingpaperDb(){
    const data = buildFormData();

    try{
      localStorage.setItem('fa_op3_last_workingpaper', JSON.stringify(data));
    }catch(e){
      console.error('localStorage error', e);
    }

    /*
    fetch('/api/workingpapers/op3', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    */

    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3 ‡∏™‡πà‡∏á‡πÑ‡∏õ ‚Äú‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‚Äù (‡∏à‡∏≥‡∏•‡∏≠‡∏á) ‡πÅ‡∏•‡πâ‡∏ß \n(‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà localStorage: fa_op3_last_workingpaper)');
  }

  /* ---------- Init ---------- */

  document.addEventListener('DOMContentLoaded', function(){
    initGovDbFromLocalStorage();
    initPeriods();
    initFormRefs();

    const provinceSelect = document.getElementById('province');
    const amphoeSelect   = document.getElementById('amphoe');

    if(provinceSelect){
      provinceSelect.addEventListener('change', onProvinceChange);
    }
    if(amphoeSelect){
      amphoeSelect.addEventListener('change', onAmphoeChange);
    }
  });
</script>

</body>
</html>
