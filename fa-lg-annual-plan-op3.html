<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>FA ‚Äì LG Annual | ‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó. 3 (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#060818;
      --card:#11152b;
      --border:#262b46;
      --accent:#42a5f5;
      --accent2:#26c6da;
      --muted:#a3acc7;
      --text:#f5f7ff;
      --pink:#f48fb1;
    }
    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, sans-serif;
      background:
        radial-gradient(circle at 10% 0%, rgba(123,30,60,0.36) 0, transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(66,165,245,0.32) 0, transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(38,198,218,0.22) 0, transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    header{
      padding:14px 10px 10px;
      text-align:center;
      background:linear-gradient(120deg,#0d47a1,#42a5f5,#26c6da);
      box-shadow:0 4px 16px rgba(0,0,0,0.7);
      position:sticky;
      top:0;
      z-index:10;
    }
    header h2{margin:0;font-size:19px;}
    header .sub{font-size:13px;opacity:.9;}

    main{
      max-width:1120px;
      margin:16px auto 30px;
      padding:0 14px 20px;
    }

    .breadcrumb{
      font-size:11px;
      color:var(--muted);
      margin-bottom:8px;
    }

    .intro{
      font-size:13px;
      color:var(--muted);
      margin-bottom:10px;
      line-height:1.5;
    }

    .nav-top{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:14px;
    }
    .btn-nav{
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.45);
      background:rgba(0,0,0,0.35);
      color:#fff;
      font-size:12px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-nav:hover{background:rgba(0,0,0,0.6);}

    .layout{
      display:grid;
      grid-template-columns:minmax(0, 1.2fr) minmax(0, 1fr);
      gap:14px;
    }
    @media(max-width:900px){
      .layout{grid-template-columns:1fr;}
    }

    .card{
      background:var(--card);
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.15);
      box-shadow:0 8px 24px rgba(0,0,0,0.9);
      padding:12px 12px 10px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 0 0, rgba(66,165,245,0.24) 0, transparent 55%);
      opacity:0;
      transition:opacity .2s;
      pointer-events:none;
    }
    .card:hover::before{opacity:1;}
    .card > *{position:relative;z-index:1;}

    .card-title{
      font-size:15px;
      font-weight:600;
      margin-bottom:4px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .card-sub{
      font-size:11px;
      color:var(--muted);
      margin-bottom:8px;
    }

    label{
      font-size:12px;
      display:block;
      margin:4px 0 2px;
    }
    input[type="text"],
    input[type="number"],
    input[type="url"],
    select,
    textarea{
      width:100%;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.25);
      background:#060818;
      color:var(--text);
      font-size:12px;
    }
    textarea{
      min-height:64px;
      resize:vertical;
    }
    input::file-selector-button{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.35);
      background:rgba(0,0,0,0.5);
      color:#fff;
      font-size:11px;
      margin-right:8px;
      cursor:pointer;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.45);
      background:rgba(0,0,0,0.45);
      color:#fff;
      font-size:11px;
      cursor:pointer;
      text-decoration:none;
      margin-top:4px;
    }
    .btn:hover{
      background:rgba(0,0,0,0.75);
    }
    .btn-small{
      padding:3px 8px;
      font-size:10px;
    }
    .btn-primary{
      border-color:var(--accent2);
      background:rgba(38,198,218,0.18);
    }
    .btn-danger{
      border-color:#ff8a80;
      background:rgba(255,82,82,0.2);
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
    }
    th,td{
      border:1px solid rgba(255,255,255,0.16);
      padding:4px 6px;
      vertical-align:top;
    }
    th{background:rgba(0,0,0,0.4);}

    .badge{
      display:inline-block;
      padding:1px 6px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.3);
      font-size:10px;
      margin-left:4px;
      opacity:.9;
    }

    /* A4 preview */
    .a4-wrapper{
      padding:6px;
      background:rgba(0,0,0,0.4);
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.2);
      overflow:auto;
    }
    .a4-sheet{
      background:#ffffff;
      color:#000000;
      width:794px;
      min-height:1123px;
      margin:0 auto;
      padding:24px 28px;
      box-shadow:0 4px 14px rgba(0,0,0,0.6);
      font-family:"TH Sarabun New","Tahoma",sans-serif;
      font-size:16px;
    }
    .a4-header{
      text-align:center;
      margin-bottom:12px;
      font-size:18px;
      font-weight:bold;
      text-decoration:underline;
    }
    .a4-meta{
      font-size:14px;
      margin-bottom:4px;
    }
    .a4-section-title{
      font-weight:bold;
      margin-top:8px;
      margin-bottom:4px;
      font-size:16px;
    }
    .a4-textarea{
      width:100%;
      min-height:70px;
      border:1px solid #888;
      border-radius:4px;
      padding:4px 6px;
      font-size:15px;
      font-family:"TH Sarabun New","Tahoma",sans-serif;
      resize:vertical;
      box-sizing:border-box;
    }
    .a4-inline-input{
      border:none;
      border-bottom:1px solid #555;
      font-size:15px;
      font-family:"TH Sarabun New","Tahoma",sans-serif;
      padding:0 2px;
      min-width:60px;
    }

    .remark-block{
      margin-top:4px;
    }
    .sign-block{
      margin-top:6px;
      border-top:1px dashed #aaa;
      padding-top:4px;
      font-size:14px;
    }

    .export-bar{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }

    .status{
      font-size:11px;
      color:var(--muted);
      margin-top:6px;
    }

    @media print{
      body{background:#fff;}
      header,.nav-top,.layout > .card-left-only,
      .export-bar{display:none !important;}
      .a4-wrapper{
        padding:0;
        border:none;
        box-shadow:none;
      }
      .a4-sheet{
        width:auto;
        min-height:auto;
        margin:0;
        box-shadow:none;
      }
    }
  </style>
</head>
<body>

<header>
  <h2>‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó. 3 ‚Äì ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</h2>
  <div class="sub">FA ‚Äì LG Annual | Understanding the Entity (Local Government)</div>
</header>

<main>

  <div class="breadcrumb">
    FA Main ‚ñ∏ FA Annual (LG) ‚ñ∏ Planning ‚ñ∏ <strong>‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó. 3</strong>
  </div>

  <div class="intro">
    ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° <strong>‡∏≠‡∏õ‡∏ó. 3</strong> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏Ç‡∏≠‡∏á ‡∏≠‡∏õ‡∏ó.
    ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å ‚Äú‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Äù (AI Room) ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞
    ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4 ‡πÅ‡∏•‡∏∞ Export ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö
  </div>

  <div class="nav-top">
    <a href="fa-lg-annual-plan.html" class="btn-nav">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π Planning (FA Annual LG)</a>
    <a href="fa-lg-annual.html" class="btn-nav">üèõÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π FA Annual LG</a>
    <a href="index.html" class="btn-nav">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
  </div>

  <div class="layout">
    <!-- LEFT -->
    <div class="card card-left-only">
      <div class="card-title">1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‚Äì ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</div>
      <div class="card-sub">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏õ‡∏ó. ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏π‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞ A4
      </div>

      <div style="display:grid;grid-template-columns:1fr 2fr;gap:8px;">
        <div>
          <label>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (‡∏û.‡∏®.)</label>
          <select id="yearSelect">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ --</option>
            <option value="2567">2567</option>
            <option value="2568">2568</option>
            <option value="2569">2569</option>
          </select>
        </div>
        <div>
          <label>‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ‡πÄ‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á)</label>
          <input type="number" id="yearCustom" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2570">
        </div>
      </div>

      <label style="margin-top:6px;">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô)</label>
      <input type="text" id="entityName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©">

      <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;margin-top:4px;">
        <div>
          <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
          <input type="text" id="district" placeholder="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠">
        </div>
        <div>
          <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
          <input type="text" id="province" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">
        </div>
        <div>
          <label>‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input type="text" id="entityCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô 330201">
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.15);margin:10px 0;">

      <!-- 2.1 + 2.2 -->
      <div class="card-title">2. ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Äì ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö (2.1‚Äì2.2)</div>
      <div class="card-sub">
        ‡πÄ‡∏Å‡πá‡∏ö URL ‡∏Ç‡∏≠‡∏á Web/Platform (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡∏≠‡∏õ‡∏ó. / new e-LAAS)
        ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏ô ‚Äú‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (2.3)‚Äù
      </div>

      <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå / ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° (2.1)</label>
      <div style="display:flex;gap:6px;align-items:center;">
        <input type="url" id="sourceUrl" placeholder="‡πÄ‡∏ä‡πà‡∏ô https://www.xxx.go.th ‡∏´‡∏£‡∏∑‡∏≠ https://newelass.dla.go.th/...">
        <button class="btn btn-small btn-primary" type="button" onclick="addUrlSource()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
      </div>

      <label style="margin-top:8px;">‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ó‡∏∏‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‚Äì ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ) (2.2)</label>
      <input type="file" id="fileInput" multiple>
      <div class="status">* ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</div>

      <div style="margin-top:8px;max-height:150px;overflow:auto;border-radius:8px;border:1px solid rgba(255,255,255,0.2);padding:4px;">
        <table>
          <thead>
            <tr>
              <th style="width:8%;">#</th>
              <th style="width:40%;">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th>
              <th style="width:18%;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
              <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
            </tr>
          </thead>
          <tbody id="sourceTableBody">
            <tr>
              <td colspan="4" style="text-align:center;color:var(--muted);">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå</td>
            </tr>
          </tbody>
        </table>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.15);margin:10px 0;">

      <!-- 2.3 external analysis room -->
      <div class="card-title">3. ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (2.3) ‚Äì ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞</div>
      <div class="card-sub">
        ‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πâ‡∏≤ <strong>fa-lg-annual-plan-op3-analysis.html</strong> ‡πÄ‡∏õ‡πá‡∏ô ‚ÄúAI / Data Analysis Room‚Äù
        ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ú‡∏•‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3 ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4
      </div>

      <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:2px;">
        <button type="button" class="btn btn-small btn-primary" onclick="openAnalysisRoom()">
          üöÄ ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà)
        </button>
        <button type="button" class="btn btn-small" onclick="loadAnalysisFromRoom()">
          ‚¨á ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°
        </button>
      </div>

      <div id="analysisStatus" class="status"></div>
    </div>

    <!-- RIGHT: A4 -->
    <div class="card">
      <div class="card-title">
        4. ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° A4 ‚Äì ‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó. 3 (‡∏£‡∏ß‡∏° ‚Äú‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‚Äù)
        <span class="badge">A4 Preview</span>
      </div>
      <div class="card-sub">
        ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4 ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏≠‡∏õ‡∏ó.3 (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ / ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á / ‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏≤‡∏ô / ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ / ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ / ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠)
      </div>

      <div class="a4-wrapper">
        <div class="a4-sheet" id="a4Sheet">
          <div class="a4-header">
            ‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó. 3<br>
            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à
          </div>

          <!-- Meta -->
          <div class="a4-meta">
            ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®. <input class="a4-inline-input" id="a4Year" readonly>
          </div>
          <div class="a4-meta">
            ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à 
            <input class="a4-inline-input" id="a4Entity" readonly>
          </div>
          <div class="a4-meta">
            ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ <input class="a4-inline-input" id="a4District" readonly>
            ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <input class="a4-inline-input" id="a4Province" readonly>
            ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à <input class="a4-inline-input" id="a4EntityCode" readonly style="min-width:80px;">
          </div>

          <!-- ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó. / ‡∏Ç‡∏ô‡∏≤‡∏î / ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà / ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ -->
          <div class="a4-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 0 : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡πÄ‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</div>
          <div style="font-size:15px;margin-bottom:4px;">
            ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó. :
            [ ] ‡∏≠‡∏ö‡∏à. &nbsp; [ ] ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ô‡∏Ñ‡∏£ &nbsp; [ ] ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á &nbsp; [ ] ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ï‡∏≥‡∏ö‡∏• &nbsp; [ ] ‡∏≠‡∏ö‡∏ï. ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏£‡∏∞‡∏ö‡∏∏
            <input class="a4-inline-input" id="a4TypeOther">
          </div>
          <div style="font-size:15px;margin-bottom:4px;">
            ‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô :
            [ ] ‡πÉ‡∏´‡∏ç‡πà &nbsp; [ ] ‡∏Å‡∏•‡∏≤‡∏á &nbsp; [ ] ‡πÄ‡∏•‡πá‡∏Å &nbsp; ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
            <input class="a4-inline-input" id="a4SizeCriteria">
          </div>
          <div style="font-size:15px;margin-bottom:4px;">
            ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡∏™‡∏£‡∏∏‡∏õ :
            <input class="a4-inline-input" id="a4AreaSummary" style="min-width:250px;">
          </div>
          <div style="font-size:15px;margin-bottom:8px;">
            ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì :
            <input class="a4-inline-input" id="a4Population" style="min-width:120px;"> ‡∏Ñ‡∏ô
            &nbsp; ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô/‡∏ä‡∏∏‡∏°‡∏ä‡∏ô
            <input class="a4-inline-input" id="a4VillageCount" style="min-width:80px;"> ‡πÅ‡∏´‡πà‡∏á
          </div>

          <!-- Section 1 -->
          <div class="a4-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</div>
          <textarea id="a4Part1" class="a4-textarea"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ù‡πà‡∏≤‡∏¢/‡∏Å‡∏≠‡∏á ‡∏™‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤ ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏° ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à"></textarea>

          <!-- Section 2 -->
          <div class="a4-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 : ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</div>
          <textarea id="a4Part2" class="a4-textarea"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (e-LAAS / new e-LAAS) ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö"></textarea>

          <!-- Section 3 -->
          <div class="a4-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 : ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö ‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</div>
          <textarea id="a4Part3" class="a4-textarea"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û.‡∏£.‡∏ö.‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢ ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®/‡∏Ç‡πâ‡∏≠‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á"></textarea>

          <!-- Section 4 ‚Üí ‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå -->
          <div class="a4-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4 : ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå 2.3)</div>
          <textarea id="a4AnalysisSummary" class="a4-textarea"
            placeholder="‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‚Äù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (fa-lg-annual-plan-op3-analysis.html) ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ"></textarea>

          <!-- Section 5 ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
          <div class="a4-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5 : ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° / ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á</div>
          <div id="remarksContainer"></div>
          <button type="button" class="btn btn-small" onclick="addRemark()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</button>

          <!-- Section 6 ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ -->
          <div class="a4-section-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6 : ‡∏ä‡πà‡∏≠‡∏á‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥ / ‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏á‡∏≤‡∏ô / ‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô</div>
          <div id="signContainer"></div>
          <button type="button" class="btn btn-small" onclick="addSignBlock()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠</button>

        </div>
      </div>

      <!-- Export buttons -->
      <div class="export-bar">
        <button type="button" class="btn btn-primary" onclick="exportJson()">Export JSON</button>
        <button type="button" class="btn" onclick="exportXlsx()">Export Excel (.xlsx)</button>
        <button type="button" class="btn" onclick="exportDocx()">Export Word (.docx)</button>
        <button type="button" class="btn" onclick="window.print()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</button>
        <button type="button" class="btn" onclick="scrollToTop()">‚¨Ü ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</button>
      </div>
      <div class="status">
        * ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£ Export .xlsx/.docx ‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ (CSV/HTML) ‡∏ó‡∏µ‡πà Excel/Word ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ
        ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå OpenXML ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ JavaScript ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏ä‡πà‡∏ô SheetJS, docx.js)
      </div>

    </div>
  </div>
</main>

<script>
  const urlSources = [];
  const fileSources = [];

  function getSelectedYear() {
    const sel = document.getElementById('yearSelect').value;
    const custom = document.getElementById('yearCustom').value;
    return custom || sel || '';
  }

  function refreshA4Header() {
    document.getElementById('a4Year').value = getSelectedYear();
    document.getElementById('a4Entity').value = document.getElementById('entityName').value;
    document.getElementById('a4District').value = document.getElementById('district').value;
    document.getElementById('a4Province').value = document.getElementById('province').value;
    document.getElementById('a4EntityCode').value = document.getElementById('entityCode').value;
  }

  ['yearSelect','yearCustom','entityName','district','province','entityCode']
    .forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('input', refreshA4Header);
        el.addEventListener('change', refreshA4Header);
      }
    });

  function addUrlSource() {
    const input = document.getElementById('sourceUrl');
    const val = input.value.trim();
    if (!val) return;
    urlSources.push({ type:'url', value:val });
    input.value = '';
    renderSources();
  }

  document.getElementById('fileInput').addEventListener('change', (e) => {
    fileSources.length = 0;
    const files = Array.from(e.target.files || []);
    files.forEach(f => {
      fileSources.push({
        type:'file',
        name:f.name,
        size:f.size,
        file:f
      });
    });
    renderSources();
  });

  function renderSources() {
    const tbody = document.getElementById('sourceTableBody');
    tbody.innerHTML = '';
    let idx = 1;

    if (urlSources.length === 0 && fileSources.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--muted);">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå</td></tr>';
    } else {
      urlSources.forEach(src => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${idx++}</td>
          <td><a href="${src.value}" target="_blank" style="color:#90caf9;">${src.value}</a></td>
          <td>‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</td>
          <td>‡πÉ‡∏ä‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå/‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</td>
        `;
        tbody.appendChild(tr);
      });

      fileSources.forEach(src => {
        const sizeKB = (src.size/1024).toFixed(1);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${idx++}</td>
          <td>${src.name}</td>
          <td>‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</td>
          <td>‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${sizeKB} KB</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á localStorage ‡πÉ‡∏´‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    const summaryForAnalysis = {
      urls:urlSources.map(u=>u.value),
      files:fileSources.map(f=>({name:f.name,size:f.size}))
    };
    localStorage.setItem('fa_op3_sources', JSON.stringify(summaryForAnalysis));
  }

  // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
  function openAnalysisRoom() {
    // ‡πÄ‡∏Å‡πá‡∏ö context ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏ä‡πâ
    const ctx = {
      year: getSelectedYear(),
      entityName: document.getElementById('entityName').value
    };
    localStorage.setItem('fa_op3_context', JSON.stringify(ctx));
    window.open('fa-lg-annual-plan-op3-analysis.html', '_blank');
  }

  // ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
  function loadAnalysisFromRoom() {
    const statusEl = document.getElementById('analysisStatus');
    const raw = localStorage.getItem('fa_op3_analysis_result');
    if (!raw) {
      statusEl.textContent = '‚ö† ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ fa-lg-annual-plan-op3-analysis.html)';
      return;
    }
    try {
      const obj = JSON.parse(raw);
      document.getElementById('a4AnalysisSummary').value = obj.result || '';
      statusEl.textContent = '‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß';
    } catch(e) {
      statusEl.textContent = '‚ö† ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)';
    }
  }

  // 2.5
  function addRemark() {
    const container = document.getElementById('remarksContainer');
    const idx = container.children.length + 1;
    const div = document.createElement('div');
    div.className = 'remark-block';
    div.innerHTML = `
      <div>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà ${idx}</div>
      <textarea class="a4-textarea" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
    `;
    container.appendChild(div);
  }

  // 2.6
  function addSignBlock() {
    const container = document.getElementById('signContainer');
    const div = document.createElement('div');
    div.className = 'sign-block';
    div.innerHTML = `
      <div>
        ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ <input class="a4-inline-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
        ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <input class="a4-inline-input" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <input class="a4-inline-input" placeholder="‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ">
      </div>
    `;
    container.appendChild(div);
  }

  // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ export
  function collectData() {
    return {
      year:getSelectedYear(),
      entity:{
        name:document.getElementById('entityName').value,
        district:document.getElementById('district').value,
        province:document.getElementById('province').value,
        code:document.getElementById('entityCode').value,
        typeOther:document.getElementById('a4TypeOther').value,
        sizeCriteria:document.getElementById('a4SizeCriteria').value,
        areaSummary:document.getElementById('a4AreaSummary').value,
        population:document.getElementById('a4Population').value,
        villageCount:document.getElementById('a4VillageCount').value
      },
      sources:{
        urls:urlSources.map(u=>u.value),
        files:fileSources.map(f=>({name:f.name,size:f.size}))
      },
      form:{
        part1:document.getElementById('a4Part1').value,
        part2:document.getElementById('a4Part2').value,
        part3:document.getElementById('a4Part3').value,
        analysisSummary:document.getElementById('a4AnalysisSummary').value,
        remarks:Array.from(document.querySelectorAll('#remarksContainer textarea')).map(t=>t.value),
        signs:Array.from(document.querySelectorAll('#signContainer .sign-block')).map(b=>{
          const inputs = b.querySelectorAll('.a4-inline-input');
          return {
            name:inputs[0]?.value || '',
            position:inputs[1]?.value || '',
            date:inputs[2]?.value || ''
          };
        })
      }
    };
  }

  function exportJson() {
    const data = collectData();
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const y = data.year || 'xxxx';
    const e = (data.entity.name || 'entity').replace(/[^\w‡∏Å-‡πô]+/g,'_');
    a.href = url;
    a.download = `fa-lg-annual-op3-${y}-${e}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // Export Excel ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ (CSV)
  function exportXlsx() {
    const data = collectData();
    const rows = [];

    rows.push(['Field','Value']);
    rows.push(['Year', data.year]);
    rows.push(['Entity Name', data.entity.name]);
    rows.push(['District', data.entity.district]);
    rows.push(['Province', data.entity.province]);
    rows.push(['Entity Code', data.entity.code]);
    rows.push(['Entity Type (Other)', data.entity.typeOther]);
    rows.push(['Size Criteria', data.entity.sizeCriteria]);
    rows.push(['Area Summary', data.entity.areaSummary]);
    rows.push(['Population', data.entity.population]);
    rows.push(['Village Count', data.entity.villageCount]);

    rows.push(['Part 1 ‚Äì Structure', data.form.part1]);
    rows.push(['Part 2 ‚Äì Systems', data.form.part2]);
    rows.push(['Part 3 ‚Äì Laws', data.form.part3]);
    rows.push(['Part 4 ‚Äì Analysis Summary', data.form.analysisSummary]);

    data.form.remarks.forEach((r,i)=>{
      rows.push([`Remark ${i+1}`, r]);
    });
    data.form.signs.forEach((s,i)=>{
      rows.push([`Sign Block ${i+1}`, `Name: ${s.name} / Position: ${s.position} / Date: ${s.date}`]);
    });

    const csv = rows.map(r=>r.map(v=>{
      const s = (v||'').toString().replace(/"/g,'""');
      return `"${s}"`;
    }).join(',')).join('\r\n');

    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const y = data.year || 'xxxx';
    const e = (data.entity.name || 'entity').replace(/[^\w‡∏Å-‡πô]+/g,'_');
    a.href = url;
    a.download = `fa-lg-annual-op3-${y}-${e}.xlsx`; // ‡πÉ‡∏´‡πâ Excel ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ (‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡∏Ñ‡∏∑‡∏≠ CSV)
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // Export Word ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ (HTML ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô)
  function exportDocx() {
    const sheet = document.getElementById('a4Sheet').outerHTML;
    const html = `
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Export ‚Äì ‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó.3</title>
</head>
<body>${sheet}</body>
</html>`;
    const blob = new Blob([html], {type:'application/msword'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'fa-lg-annual-op3.docx'; // Word ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å HTML
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function scrollToTop() {
    window.scrollTo({top:0,behavior:'smooth'});
  }

  // init
  refreshA4Header();
  addRemark();
  addSignBlock();
</script>

</body>
</html>