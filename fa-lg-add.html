<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>FA DB | ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- XLSX ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  :root{
    --bg:#060818;
    --card:#11152b;
    --border:#262b46;
    --accent:#42a5f5;
    --accent2:#22c55e;
    --muted:#a3acc7;
    --text:#f5f7ff;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    font-family:"Segoe UI",Tahoma,sans-serif;
    background:
      radial-gradient(circle at 10% 0%, rgba(123,30,60,0.36) 0, transparent 55%),
      radial-gradient(circle at 90% 100%, rgba(66,165,245,0.32) 0, transparent 55%),
      var(--bg);
    color:var(--text);
  }
  header{
    padding:18px 12px 14px;
    text-align:center;
    background:linear-gradient(120deg,#0d47a1,#6f42c1,#22c55e);
    box-shadow:0 4px 16px rgba(0,0,0,.7);
    position:relative;
    overflow:hidden;
  }
  header::after{
    content:"";
    position:absolute;
    inset:0;
    background:
      radial-gradient(circle at 15% 0%,rgba(244,143,177,0.24) 0,transparent 55%),
      radial-gradient(circle at 85% 100%,rgba(45,212,191,0.22) 0,transparent 55%);
    mix-blend-mode:screen;
    opacity:.8;
    pointer-events:none;
  }
  .header-inner{position:relative;z-index:1;}
  header h1{
    margin:0;
    font-size:22px;
    font-weight:800;
    letter-spacing:.03em;
  }
  header p{
    margin:4px 0 0;
    font-size:13px;
    color:#e5e7eb;
  }

  .wrap{
    max-width:1150px;
    margin:18px auto 26px;
    padding:0 16px;
  }
  .top-row{
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    gap:8px;
    font-size:13px;
    color:var(--muted);
    margin-bottom:12px;
  }
  .top-left{
    display:flex;
    flex-direction:column;
    gap:2px;
  }
  .chip{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:3px 9px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.55);
    background:rgba(15,23,42,.9);
    font-size:12px;
  }
  .chip a{
    color:inherit;
    text-decoration:none;
  }

  .card{
    background:var(--card);
    border-radius:18px;
    border:1px solid rgba(255,255,255,.08);
    padding:14px 14px 12px;
    margin-bottom:14px;
    box-shadow:0 8px 22px rgba(0,0,0,.72);
    position:relative;
    overflow:hidden;
  }
  .card::before{
    content:"";
    position:absolute;
    inset:-40%;
    background:radial-gradient(circle at 10% 0%,rgba(148,163,255,0.16) 0,transparent 55%);
    opacity:0.9;
    pointer-events:none;
  }
  .card-inner{position:relative;z-index:1;}

  h2{
    margin:0 0 6px;
    font-size:18px;
    display:flex;
    align-items:center;
    gap:8px;
  }
  h2 span.en{
    font-size:12px;
    font-weight:400;
    color:var(--muted);
  }
  p.desc{
    margin:2px 0 8px;
    font-size:13px;
    color:var(--muted);
  }

  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:8px 12px;
  }

  label{
    display:block;
    font-size:13px;
    margin-top:6px;
  }
  input,select,textarea{
    width:100%;
    margin-top:3px;
    padding:7px 8px;
    border-radius:8px;
    border:1px solid rgba(148,163,184,.4);
    background:#05081a;
    color:var(--text);
    font-size:13px;
  }
  input:focus,select:focus,textarea:focus{
    outline:none;
    border-color:#22c55e;
  }

  .btn-row{
    margin-top:10px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }
  button,a.nav{
    border:none;
    border-radius:999px;
    padding:8px 14px;
    font-size:13px;
    cursor:pointer;
  }
  .btn-primary{
    background:#22c55e;
    color:#082f1a;
    font-weight:700;
  }
  .btn-secondary{
    background:#374151;
    color:#e5e7eb;
  }
  .btn-danger{
    background:#b91c1c;
    color:#fff;
  }
  a.nav{
    display:inline-flex;
    align-items:center;
    gap:6px;
    color:#e0e7ff;
    text-decoration:none;
    border:1px solid rgba(148,163,184,.55);
    background:rgba(15,23,42,.95);
  }

  .note{
    font-size:12px;
    color:var(--muted);
    margin-top:4px;
  }
  .badge{
    display:inline-flex;
    align-items:center;
    gap:4px;
    font-size:11px;
    padding:2px 7px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.5);
    background:rgba(15,23,42,.95);
  }
  .log{
    margin-top:6px;
    font-size:12px;
    color:#a5b4fc;
  }
  pre.sample{
    background:#020617;
    border-radius:10px;
    border:1px solid #1e293b;
    padding:8px;
    font-size:11px;
    overflow:auto;
  }

  table{
    width:100%;
    border-collapse:collapse;
    font-size:12px;
    margin-top:8px;
  }
  th,td{
    border:1px solid #374151;
    padding:5px 6px;
  }
  th{
    background:#020617;
  }
  tr:nth-child(even){
    background:#111827;
  }

  .link-btn{
    display:inline-flex;
    align-items:center;
    padding:3px 8px;
    border-radius:999px;
    border:1px solid #38bdf8;
    color:#e0f2fe;
    font-size:11px;
    text-decoration:none;
  }
  .link-btn:hover{
    background:#0ea5e9;
    color:#0b1120;
  }

  .center-text{
    text-align:center;
    color:#9ca3af;
  }

  @media(max-width:600px){
    header h1{font-size:18px;}
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <h1>FA DB ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó.</h1>
    <p>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡∏≠‡∏õ‡∏ó. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á fa-db-data-gov ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
  </div>
</header>

<div class="wrap">

  <div class="top-row">
    <div class="top-left">
      <div>‚è± <span id="nowTime">-</span></div>
      <div>
        ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <strong id="userEmail">-</strong>
        <span class="chip" style="margin-left:6px;">
          <span>üì¶</span> key: <code>fa-db-data-gov</code>
        </span>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;gap:4px;align-items:flex-end;">
      <div style="display:flex;flex-wrap:wrap;gap:6px;justify-content:flex-end;">
        <span class="chip">
          <a href="#importHistoryCard">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</a>
        </span>
        <span class="chip">
          <a href="#lgBoardCard">üìä ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</a>
        </span>
      </div>
      <div style="margin-top:4px;">
        <span class="chip">
          üì• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <strong id="totalRecords">0</strong>
        </span>
      </div>
    </div>
  </div>

  <!-- 1) ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå / URL -->
  <div class="card">
    <div class="card-inner">
      <h2>1) ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå / URL
        <span class="en">Bulk Import (One Button)</span>
      </h2>
      <p class="desc">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á: ‡πÑ‡∏ü‡∏•‡πå CSV / Excel ‡∏´‡∏£‡∏∑‡∏≠ URL (‡πÑ‡∏ü‡∏•‡πå CSV ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)<br>
        ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß <strong>‚Äú‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Äù</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡∏ô‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á.
      </p>

      <div class="grid">
        <div>
          <label>üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (.csv, .xls, .xlsx)</label>
          <input type="file" id="inputFile" accept=".csv,.xls,.xlsx">
          <div class="note">
            ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå <strong>‚Äú‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó. ‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢.csv‚Äù</strong> ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå Excel ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
          </div>
        </div>
        <div>
          <label>üîó ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏∏ URL ‡πÑ‡∏ü‡∏•‡πå CSV ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</label>
          <input type="text" id="inputUrl" placeholder="‡πÄ‡∏ä‡πà‡∏ô https://example.go.th/lg-data.csv">
          <div class="note">
            ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö (‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï CORS)
          </div>
        </div>
        <div>
          <label>üìÑ ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå)</label>
          <input type="file" id="fileDoc" accept=".pdf,.doc,.docx,.ppt,.pptx">
          <div class="note">
            ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‡∏≠‡∏õ‡∏ó. ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
          </div>
        </div>
      </div>

      <div class="btn-row">
        <button type="button" class="btn-primary" id="btnImportAll">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button type="button" class="btn-secondary" id="btnClearAttach">‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå / URL</button>
      </div>

      <div class="log" id="importProgress">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: -</div>
      <div class="log" id="importLog">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>

      <details style="margin-top:8px;">
        <summary style="font-size:12px;cursor:pointer;color:#a5b4fc;">
          ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
        </summary>
        <div style="margin-top:6px;">
          <div class="badge">‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (‡πÑ‡∏ü‡∏•‡πå‡∏ê‡∏≤‡∏ô ‡∏≠‡∏õ‡∏ó.)</div>
          <pre class="sample">
‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î,‡∏≠‡∏≥‡πÄ‡∏†‡∏≠,‡∏ï‡∏≥‡∏ö‡∏•,‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó.,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó.,‡∏≠‡∏õ‡∏ó.,‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà,‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà,‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå,LAT,LONG,‡πÄ‡∏ß‡πá‡∏õ‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏≠‡∏õ‡∏ó
‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠,1099,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,123,1,33000,15.1180,104.3220,https://...
          </pre>
          <div class="badge">‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)</div>
          <pre class="sample">
code,name,unit,type,ministry,level,province,district,subdistrict,village,address,zipcode,lat,long,website,remark
1099,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á,‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢,‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô,‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠,,123 ‡∏°.1,33000,15.1180,104.3220,https://...,‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
          </pre>
        </div>
      </details>
    </div>
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ -->
  <div class="card" id="importHistoryCard">
    <div class="card-inner">
      <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå
        <span class="en">Import History</span>
      </h2>
      <p class="desc">
        ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠ URL ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ê‡∏≤‡∏ô.
      </p>

      <div class="btn-row">
        <button type="button" class="btn-danger" id="btnDeleteImportSelected">‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå / URL</th>
            <th>‡∏Ç‡∏ô‡∏≤‡∏î (KB)</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‚Äì‡πÄ‡∏ß‡∏•‡∏≤</th>
            <th>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏•‡∏ö</th>
          </tr>
        </thead>
        <tbody id="importHistoryBody"></tbody>
      </table>
    </div>
  </div>

  <!-- ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô fa-db-data-gov -->
  <div class="card" id="lgBoardCard">
    <div class="card-inner">
      <h2>2) ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / ‡∏≠‡∏õ‡∏ó.
        <span class="en">Local Government Data Board</span>
      </h2>
      <p class="desc">
        ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô <code>fa-db-data-gov</code> (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö FA, Tracking, Review, Learning, Cash Board)<br>
        <span id="boardSummary">-</span>
      </p>

      <div class="btn-row">
        <button type="button" class="btn-danger" id="btnDeleteBoardSelected">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>‡∏£‡∏´‡∏±‡∏™</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
            <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</th>
            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
            <th>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</th>
            <th>‡∏ï‡∏≥‡∏ö‡∏•</th>
            <th>‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
            <th>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏•‡∏ö</th>
          </tr>
        </thead>
        <tbody id="boardBody"></tbody>
      </table>
    </div>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö -->
  <div style="margin-top:10px;">
    <a href="fa-db-local.html" class="nav">
      <span>‚¨Ö</span> ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó.
    </a>
    <a href="fa-database-menu.html" class="nav" style="margin-left:6px;">
      <span>üè†</span> ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å
    </a>
  </div>

</div>

<script>
const STORAGE_KEY    = "fa-db-data-gov";
const IMPORT_LOG_KEY = "fa-db-import-log-gov";

let db = [];
let importLog = [];
let attachedDoc = null;

/* ===== CLOCK ===== */
function updateClock(){
  const el = document.getElementById("nowTime");
  if(!el) return;
  const now = new Date();
  const opts = {
    year:"numeric",
    month:"short",
    day:"2-digit",
    hour:"2-digit",
    minute:"2-digit",
    second:"2-digit"
  };
  el.textContent = now.toLocaleString("th-TH", opts);
}

/* ===== SESSION DISPLAY ===== */
function displaySession(){
  const el = document.getElementById("userEmail");
  try{
    const raw = localStorage.getItem("fas-session");
    if(!raw){ el.textContent = "-"; return; }
    const s = JSON.parse(raw);
    if(s.expiresAt && Date.now() > s.expiresAt){
      el.textContent = "-";
      return;
    }
    el.textContent = s.email || "-";
  }catch{
    el.textContent = "-";
  }
}

/* ===== DB LOAD/SAVE + BOARD ===== */
function loadDB(){
  try{
    db = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  }catch(e){
    db = [];
  }
  document.getElementById("totalRecords").textContent = db.length;
  renderBoard();
}
function saveDB(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  document.getElementById("totalRecords").textContent = db.length;
  renderBoard();
}

function renderBoard(){
  const tbody = document.getElementById("boardBody");
  const summary = document.getElementById("boardSummary");
  tbody.innerHTML = "";
  const total = db.length;

  if(total === 0){
    summary.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô";
    const tr = document.createElement("tr");
    tr.innerHTML = `<td colspan="10" class="center-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô fa-db-data-gov</td>`;
    tbody.appendChild(tr);
    return;
  }

  const maxRows = 100;
  summary.textContent = `‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${maxRows} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô`;

  let shown = 0;
  for(let i=0; i<db.length && shown<maxRows; i++){
    const r = db[i];
    const tr = document.createElement("tr");
    const code = r.code || "";
    const name = r.name || "";
    const unit = r.unit || name;
    const type = r.type || "";
    const prov = r.province || "";
    const dist = r.district || "";
    const subd = r.subdistrict || "";
    const detailHref = "fa-lg-view.html?code=" + encodeURIComponent(code);

    tr.dataset.idx = String(i);
    tr.innerHTML = `
      <td>${shown+1}</td>
      <td>${code}</td>
      <td>${name}</td>
      <td>${unit}</td>
      <td>${type}</td>
      <td>${prov}</td>
      <td>${dist}</td>
      <td>${subd}</td>
      <td style="text-align:center;">
        <a href="${detailHref}" class="link-btn">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
      </td>
      <td style="text-align:center;">
        <input type="checkbox" class="chkBoard" data-idx="${i}">
      </td>
    `;
    tbody.appendChild(tr);
    shown++;
  }

  if(shown === 0){
    const tr = document.createElement("tr");
    tr.innerHTML = `<td colspan="10" class="center-text">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á</td>`;
    tbody.appendChild(tr);
  }
}

/* ===== IMPORT LOG ===== */
function loadImportLog(){
  try{
    importLog = JSON.parse(localStorage.getItem(IMPORT_LOG_KEY) || "[]");
  }catch(e){
    importLog = [];
  }
  renderImportHistory();
}
function saveImportLog(){
  localStorage.setItem(IMPORT_LOG_KEY, JSON.stringify(importLog));
  renderImportHistory();
}
function renderImportHistory(){
  const tbody = document.getElementById("importHistoryBody");
  tbody.innerHTML = "";
  if(importLog.length === 0){
    const tr = document.createElement("tr");
    tr.innerHTML = `<td colspan="7" class="center-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</td>`;
    tbody.appendChild(tr);
    return;
  }
  importLog.forEach((log,idx)=>{
    const tr = document.createElement("tr");
    const sizeKB = log.size ? (log.size/1024).toFixed(1) : "-";
    const dt = new Date(log.when);
    const dtStr = isNaN(dt.getTime()) ? log.when : dt.toLocaleString("th-TH");
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${log.type||""}</td>
      <td>${log.name||""}</td>
      <td style="text-align:right;">${sizeKB}</td>
      <td style="text-align:right;">${log.records||0}</td>
      <td>${dtStr}</td>
      <td style="text-align:center;">
        <input type="checkbox" class="chkImport" data-idx="${idx}">
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* ===== ATTACH DOC ===== */
document.getElementById("fileDoc").addEventListener("change", e=>{
  const f = e.target.files[0];
  if(!f){ attachedDoc = null; return; }
  attachedDoc = { name:f.name, type:f.type || "document" };
});
document.getElementById("btnClearAttach").addEventListener("click", ()=>{
  document.getElementById("inputFile").value = "";
  document.getElementById("inputUrl").value = "";
  document.getElementById("fileDoc").value = "";
  attachedDoc = null;
  document.getElementById("importProgress").textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: -";
  document.getElementById("importLog").textContent = "‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå / URL ‡πÅ‡∏•‡πâ‡∏ß";
});

/* ===== CSV PARSE + IMPORT (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©) ===== */

function detectDelimiter(line){
  if(line.includes(",") && line.includes(";")){
    const c = (line.match(/,/g)||[]).length;
    const s = (line.match(/;/g)||[]).length;
    return c>=s ? "," : ";";
  }
  if(line.includes(";")) return ";";
  return ",";
}

function importFromCSVText(text, srcMeta){
  const linesRaw = text.split(/\r?\n/).filter(l=>l.trim()!=="");
  if(linesRaw.length < 2){
    alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");
    return 0;
  }
  const delim = detectDelimiter(linesRaw[0]);
  const header = linesRaw[0].split(delim).map(h=>h.replace(/(^"|"$)/g,"").trim());

  function findIdxContains(keyword){
    const lowerKey = keyword.toLowerCase();
    for(let i=0;i<header.length;i++){
      if(header[i].toLowerCase().includes(lowerKey)) return i;
    }
    return -1;
  }

  const idxThai_province   = findIdxContains("‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î");
  const idxThai_district   = findIdxContains("‡∏≠‡∏≥‡πÄ‡∏†");
  const idxThai_subdistrict= findIdxContains("‡∏ï‡∏≥‡∏ö‡∏•");
  const idxThai_code       = findIdxContains("‡∏£‡∏´‡∏±‡∏™");
  const idxThai_type       = findIdxContains("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó");
  const idxThai_name       = findIdxContains("‡∏≠‡∏õ‡∏ó");
  const idxThai_addrNo     = findIdxContains("‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á");
  const idxThai_moo        = findIdxContains("‡∏´‡∏°‡∏π‡πà");
  const idxThai_zip        = findIdxContains("‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå");
  const idxThai_lat        = findIdxContains("lat");
  const idxThai_long       = findIdxContains("long");
  const idxThai_web        = (function(){
    const i1 = findIdxContains("‡πÄ‡∏ß‡πá‡∏õ‡πÑ‡∏ã‡∏ï‡πå");
    const i2 = findIdxContains("‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå");
    return i1!==-1?i1:i2;
  })();

  const isThaiLG =
    idxThai_province   !== -1 &&
    idxThai_district   !== -1 &&
    idxThai_subdistrict!== -1 &&
    idxThai_code       !== -1 &&
    idxThai_name       !== -1;

  const now = new Date().toISOString();
  const srcUrlMeta = srcMeta.sourceUrl || "";

  const imported = [];
  const progressEl = document.getElementById("importProgress");
  const totalRecords = linesRaw.length - 1;
  progressEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤... (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì " + totalRecords + " ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)";

  if(isThaiLG){
    for(let i=1;i<linesRaw.length;i++){
      const cols = linesRaw[i].split(delim).map(c=>c.replace(/(^"|"$)/g,""));
      if(cols.length === 0) continue;
      const name = cols[idxThai_name] || "";
      const province = cols[idxThai_province] || "";
      const district = cols[idxThai_district] || "";
      const subd = cols[idxThai_subdistrict] || "";
      const code = (cols[idxThai_code] || "").toString();

      imported.push({
        code      : code,
        name      : name,
        unit      : name,
        type      : idxThai_type !== -1 ? (cols[idxThai_type]||"") : "",
        ministry  : "‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢",
        level     : "‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô",
        province  : province,
        district  : district,
        subdistrict: subd,
        village   : "",
        address   : (
          (idxThai_addrNo !== -1 ? (cols[idxThai_addrNo]||"") : "") +
          (idxThai_moo !== -1 && cols[idxThai_moo] ? " ‡∏°." + cols[idxThai_moo] : "")
        ).trim(),
        zipcode   : idxThai_zip !== -1 ? (cols[idxThai_zip]||"") : "",
        lat       : idxThai_lat !== -1 ? (cols[idxThai_lat]||"") : "",
        long      : idxThai_long !== -1 ? (cols[idxThai_long]||"") : "",
        website   : idxThai_web !== -1 ? (cols[idxThai_web]||"") : "",
        sourceType: "csv-thai-lg",
        sourceUrl : srcUrlMeta,
        attachmentName: attachedDoc ? attachedDoc.name : "",
        attachmentType: attachedDoc ? attachedDoc.type : "",
        remark    : "",
        createdAt : now,
        updatedAt : now
      });
    }
  }else{
    const idx = {
      code     : header.indexOf("code"),
      name     : header.indexOf("name"),
      unit     : header.indexOf("unit"),
      type     : header.indexOf("type"),
      ministry : header.indexOf("ministry"),
      level    : header.indexOf("level"),
      province : header.indexOf("province"),
      district : header.indexOf("district"),
      subdistrict: header.indexOf("subdistrict"),
      village  : header.indexOf("village"),
      address  : header.indexOf("address"),
      zipcode  : header.indexOf("zipcode"),
      lat      : header.indexOf("lat"),
      long     : header.indexOf("long"),
      website  : header.indexOf("website"),
      remark   : header.indexOf("remark")
    };
    if(idx.code === -1 || idx.name === -1 || idx.province === -1){
      alert("‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ code, name, province)");
      progressEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á)";
      return 0;
    }
    for(let i=1;i<linesRaw.length;i++){
      const cols = linesRaw[i].split(delim).map(c=>c.replace(/(^"|"$)/g,""));
      if(cols.length === 0) continue;
      imported.push({
        code      : idx.code !== -1 ? (cols[idx.code]||"") : "",
        name      : idx.name !== -1 ? (cols[idx.name]||"") : "",
        unit      : idx.unit !== -1 ? (cols[idx.unit]||"") : (idx.name !== -1 ? (cols[idx.name]||"") : ""),
        type      : idx.type !== -1 ? (cols[idx.type]||"") : "",
        ministry  : idx.ministry !== -1 ? (cols[idx.ministry]||"") : "",
        level     : idx.level !== -1 ? (cols[idx.level]||"") : "",
        province  : idx.province !== -1 ? (cols[idx.province]||"") : "",
        district  : idx.district !== -1 ? (cols[idx.district]||"") : "",
        subdistrict: idx.subdistrict !== -1 ? (cols[idx.subdistrict]||"") : "",
        village   : idx.village !== -1 ? (cols[idx.village]||"") : "",
        address   : idx.address !== -1 ? (cols[idx.address]||"") : "",
        zipcode   : idx.zipcode !== -1 ? (cols[idx.zipcode]||"") : "",
        lat       : idx.lat !== -1 ? (cols[idx.lat]||"") : "",
        long      : idx.long !== -1 ? (cols[idx.long]||"") : "",
        website   : idx.website !== -1 ? (cols[idx.website]||"") : "",
        sourceType: "csv-english",
        sourceUrl : srcUrlMeta,
        attachmentName: attachedDoc ? attachedDoc.name : "",
        attachmentType: attachedDoc ? attachedDoc.type : "",
        remark    : idx.remark !== -1 ? (cols[idx.remark]||"") : "",
        createdAt : now,
        updatedAt : now
      });
    }
  }

  const importedCount = imported.length;
  if(importedCount === 0){
    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ");
    progressEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ";
    return 0;
  }
  db = db.concat(imported);
  progressEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß " + importedCount + " / " + totalRecords + " ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
  return importedCount;
}

/* ===== ONE BUTTON IMPORT HANDLER ===== */
document.getElementById("btnImportAll").addEventListener("click", async ()=>{
  const file = document.getElementById("inputFile").files[0];
  const url  = document.getElementById("inputUrl").value.trim();
  const progressEl = document.getElementById("importProgress");
  const logEl = document.getElementById("importLog");

  if(!file && !url){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á");
    return;
  }

  let srcName = "";
  let srcType = "";
  let size    = null;
  let text    = "";

  try{
    if(file){
      srcName = file.name;
      size    = file.size || null;
      const ext = (file.name.split(".").pop() || "").toLowerCase();

      progressEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå " + file.name + " ...";
      if(ext === "xls" || ext === "xlsx"){
        const reader = new FileReader();
        reader.onload = e =>{
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data,{type:"array"});
          const sheetName = workbook.SheetNames[0];
          const sheet = workbook.Sheets[sheetName];
          const csv = XLSX.utils.sheet_to_csv(sheet);
          srcType = "Excel";
          doImport(csv, { sourceUrl:"" }, srcName, srcType, size);
        };
        reader.readAsArrayBuffer(file);
        return;
      }else{
        const reader = new FileReader();
        reader.onload = e =>{
          const csvText = e.target.result;
          srcType = "CSV";
          doImport(csvText, { sourceUrl:"" }, srcName, srcType, size);
        };
        reader.readAsText(file,"utf-8");
        return;
      }
    }else if(url){
      srcName = url;
      size    = null;
      srcType = "URL-CSV";
      progressEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å URL ...";
      const res = await fetch(url);
      if(!res.ok){
        progressEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (HTTP "+res.status+")";
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å URL ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ");
        return;
      }
      text = await res.text();
      doImport(text, { sourceUrl:url }, srcName, srcType, size);
    }
  }catch(err){
    console.error(err);
    progressEl.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î";
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
  }

  function doImport(csvText, meta, name, type, sizeBytes){
    const count = importFromCSVText(csvText, meta);
    if(count>0){
      saveDB();
      importLog.push({
        type:type,
        name:name,
        size:sizeBytes,
        records:count,
        when:new Date().toISOString()
      });
      saveImportLog();
      logEl.textContent =
        `‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ ${type} "${name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${db.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô)`;
      alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
    }
  }
});

/* ===== DELETE IMPORT HISTORY SELECTED ===== */
document.getElementById("btnDeleteImportSelected").addEventListener("click", ()=>{
  const checks = Array.from(document.querySelectorAll(".chkImport:checked"));
  if(checks.length === 0){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
    return;
  }
  if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô "+checks.length+" ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?")) return;
  const idxSet = new Set(checks.map(ch=>Number(ch.dataset.idx)));
  importLog = importLog.filter((_,idx)=>!idxSet.has(idx));
  saveImportLog();
});

/* ===== DELETE BOARD RECORDS SELECTED ===== */
document.getElementById("btnDeleteBoardSelected").addEventListener("click", ()=>{
  const checks = Array.from(document.querySelectorAll(".chkBoard:checked"));
  if(checks.length === 0){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
    return;
  }
  if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô "+checks.length+" ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?")) return;
  const idxArr = checks.map(ch=>Number(ch.dataset.idx)).filter(n=>!isNaN(n));
  idxArr.sort((a,b)=>b-a); // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏ó‡πâ‡∏≤‡∏¢‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô index ‡∏Ç‡∏¢‡∏±‡∏ö
  idxArr.forEach(i=>{
    if(i>=0 && i<db.length){
      db.splice(i,1);
    }
  });
  saveDB();
});

/* ===== INIT ===== */
displaySession();
loadDB();
loadImportLog();
updateClock();
setInterval(updateClock,1000);
</script>

</body>
</html>
