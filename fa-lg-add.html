<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>FA DB | ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- XLSX ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  :root{
    --bg:#060818;
    --card:#11152b;
    --border:#262b46;
    --accent:#42a5f5;
    --accent2:#22c55e;
    --muted:#a3acc7;
    --text:#f5f7ff;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    font-family:"Segoe UI",Tahoma,sans-serif;
    background:
      radial-gradient(circle at 10% 0%, rgba(123,30,60,0.36) 0, transparent 55%),
      radial-gradient(circle at 90% 100%, rgba(66,165,245,0.32) 0, transparent 55%),
      var(--bg);
    color:var(--text);
  }
  header{
    padding:18px 12px 14px;
    text-align:center;
    background:linear-gradient(120deg,#0d47a1,#6f42c1,#22c55e);
    box-shadow:0 4px 16px rgba(0,0,0,.7);
    position:relative;
    overflow:hidden;
  }
  header::after{
    content:"";
    position:absolute;
    inset:0;
    background:
      radial-gradient(circle at 15% 0%,rgba(244,143,177,0.24) 0,transparent 55%),
      radial-gradient(circle at 85% 100%,rgba(45,212,191,0.22) 0,transparent 55%);
    mix-blend-mode:screen;
    opacity:.8;
    pointer-events:none;
  }
  .header-inner{position:relative;z-index:1;}
  header h1{
    margin:0;
    font-size:22px;
    font-weight:800;
    letter-spacing:.03em;
  }
  header p{
    margin:4px 0 0;
    font-size:13px;
    color:#e5e7eb;
  }

  .wrap{
    max-width:1150px;
    margin:18px auto 26px;
    padding:0 16px;
  }
  .top-row{
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    gap:8px;
    font-size:13px;
    color:var(--muted);
    margin-bottom:12px;
  }
  .chip{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:3px 9px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.55);
    background:rgba(15,23,42,.9);
    font-size:12px;
  }

  .card{
    background:var(--card);
    border-radius:18px;
    border:1px solid rgba(255,255,255,.08);
    padding:14px 14px 12px;
    margin-bottom:14px;
    box-shadow:0 8px 22px rgba(0,0,0,.72);
    position:relative;
    overflow:hidden;
  }
  .card::before{
    content:"";
    position:absolute;
    inset:-40%;
    background:radial-gradient(circle at 10% 0%,rgba(148,163,255,0.16) 0,transparent 55%);
    opacity:0.9;
    pointer-events:none;
  }
  .card-inner{position:relative;z-index:1;}

  h2{
    margin:0 0 6px;
    font-size:18px;
    display:flex;
    align-items:center;
    gap:8px;
  }
  h2 span.en{
    font-size:12px;
    font-weight:400;
    color:var(--muted);
  }
  p.desc{
    margin:2px 0 8px;
    font-size:13px;
    color:var(--muted);
  }

  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:8px 12px;
  }

  label{
    display:block;
    font-size:13px;
    margin-top:6px;
  }
  input,select,textarea{
    width:100%;
    margin-top:3px;
    padding:7px 8px;
    border-radius:8px;
    border:1px solid rgba(148,163,184,.4);
    background:#05081a;
    color:var(--text);
    font-size:13px;
  }
  input:focus,select:focus,textarea:focus{
    outline:none;
    border-color:#22c55e;
  }
  textarea{min-height:60px;resize:vertical;}

  .btn-row{
    margin-top:10px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }
  button,a.nav{
    border:none;
    border-radius:999px;
    padding:8px 14px;
    font-size:13px;
    cursor:pointer;
  }
  .btn-primary{
    background:#22c55e;
    color:#082f1a;
    font-weight:700;
  }
  .btn-secondary{
    background:#374151;
    color:#e5e7eb;
  }
  .btn-danger{
    background:#b91c1c;
    color:#fff;
  }
  a.nav{
    display:inline-flex;
    align-items:center;
    gap:6px;
    color:#e0e7ff;
    text-decoration:none;
    border:1px solid rgba(148,163,184,.55);
    background:rgba(15,23,42,.95);
  }

  .note{
    font-size:12px;
    color:var(--muted);
    margin-top:4px;
  }
  .badge{
    display:inline-flex;
    align-items:center;
    gap:4px;
    font-size:11px;
    padding:2px 7px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.5);
    background:rgba(15,23,42,.95);
  }
  .log{
    margin-top:8px;
    font-size:12px;
    color:#a5b4fc;
  }
  pre.sample{
    background:#020617;
    border-radius:10px;
    border:1px solid #1e293b;
    padding:8px;
    font-size:11px;
    overflow:auto;
  }
  @media(max-width:600px){
    header h1{font-size:18px;}
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <h1>FA DB ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó.</h1>
    <p>‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡∏≠‡∏õ‡∏ó. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á fa-db-data-gov ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö FA</p>
  </div>
</header>

<div class="wrap">

  <div class="top-row">
    <div>
      ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <strong id="userEmail">-</strong>
      <span class="chip" style="margin-left:6px;">
        <span>üì¶</span> localStorage key: <code>fa-db-data-gov</code>
      </span>
    </div>
    <div>
      <span class="chip">
        üì• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <strong id="totalRecords">0</strong>
      </span>
    </div>
  </div>

  <!-- 1) ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå / ‡∏•‡∏¥‡∏á‡∏Å‡πå -->
  <div class="card">
    <div class="card-inner">
      <h2>1) ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå / ‡∏•‡∏¥‡∏á‡∏Å‡πå
        <span class="en">Bulk Import</span>
      </h2>
      <p class="desc">
        ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå CSV, Excel ‡∏Ç‡∏≠‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó. ‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏≠‡∏á
        ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Import ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ.
      </p>

      <div class="grid">
        <div>
          <label>üì• Import CSV</label>
          <input type="file" id="fileCsv" accept=".csv">
          <div class="note">
            ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î, ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏ï‡∏≥‡∏ö‡∏•, ‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó., ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó., ‡∏≠‡∏õ‡∏ó.) 
            ‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (code,name,unit,type,province,...)
          </div>
        </div>
        <div>
          <label>üìä Import Excel (.xls, .xlsx)</label>
          <input type="file" id="fileXlsx" accept=".xls,.xlsx">
          <div class="note">
            ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ö CSV.
          </div>
        </div>
        <div>
          <label>üìÑ ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå)</label>
          <input type="file" id="fileDoc" accept=".pdf,.doc,.docx,.ppt,.pptx">
          <div class="note">
            ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ç‡∏≠‡∏á record.
          </div>
        </div>
        <div>
          <label>üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (URL)</label>
          <input type="text" id="f-sourceUrl" placeholder="‡πÄ‡∏ä‡πà‡∏ô https://example.go.th/lg-info">
          <div class="note">
            ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡∏≠‡∏õ‡∏ó., ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô.
          </div>
        </div>
      </div>

      <div class="btn-row">
        <button type="button" class="btn-primary" id="btnImportCsv">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ CSV</button>
        <button type="button" class="btn-secondary" id="btnImportXlsx">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel</button>
        <button type="button" class="btn-secondary" id="btnClearAttach">‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö / ‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
      </div>

      <div class="log" id="importLog">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>

      <details style="margin-top:8px;">
        <summary style="font-size:12px;cursor:pointer;color:#a5b4fc;">
          ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
        </summary>
        <div style="margin-top:6px;">
          <div class="badge">‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (‡πÑ‡∏ü‡∏•‡πå‡∏ê‡∏≤‡∏ô ‡∏≠‡∏õ‡∏ó.)</div>
          <pre class="sample">
‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î,‡∏≠‡∏≥‡πÄ‡∏†‡∏≠,‡∏ï‡∏≥‡∏ö‡∏•,‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó.,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó.,‡∏≠‡∏õ‡∏ó.,‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà,‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà,‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå,LAT,LONG,‡πÄ‡∏ß‡πá‡∏õ‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏≠‡∏õ‡∏ó
‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠,1099,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,123,1,33000,15.1180,104.3220,https://...
          </pre>
          <div class="badge">‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)</div>
          <pre class="sample">
code,name,unit,type,ministry,level,province,district,subdistrict,village,address,zipcode,lat,long,website,remark
1099,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á,‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢,‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô,‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©,‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠,,123 ‡∏°.1,33000,15.1180,104.3220,https://...,‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
          </pre>
        </div>
      </details>
    </div>
  </div>

  <!-- 2) ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (Manual Add) -->
  <div class="card">
    <div class="card-inner">
      <h2>2) ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        <span class="en">Manual Add</span>
      </h2>
      <p class="desc">
        ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á 
        ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° record ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°.
      </p>

      <form id="formAdd">
        <div class="grid">
          <div>
            <label>‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó. (code)</label>
            <input type="text" id="f-code" required>
          </div>
          <div>
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏õ‡∏ó. (name)</label>
            <input type="text" id="f-name" required>
          </div>
          <div>
            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (unit)</label>
            <input type="text" id="f-unit" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©">
          </div>
          <div>
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó. (type)</label>
            <input type="text" id="f-type" placeholder="‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á/‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏ö‡∏ï./‡∏≠‡∏ö‡∏à.">
          </div>
          <div>
            <label>‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á (ministry)</label>
            <input type="text" id="f-ministry" value="‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢">
          </div>
          <div>
            <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (level)</label>
            <select id="f-level">
              <option value="‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô">‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô</option>
              <option value="‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á">‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
              <option value="‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ">‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ</option>
              <option value="">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
            </select>
          </div>
          <div>
            <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (province)</label>
            <select id="f-province"></select>
          </div>
          <div>
            <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï (district)</label>
            <input type="text" id="f-district">
          </div>
          <div>
            <label>‡∏ï‡∏≥‡∏ö‡∏• / ‡πÅ‡∏Ç‡∏ß‡∏á (subdistrict)</label>
            <input type="text" id="f-subdistrict">
          </div>
          <div>
            <label>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô / ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô (village)</label>
            <input type="text" id="f-village">
          </div>
          <div>
            <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà/‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏´‡∏°‡∏π‡πà (address)</label>
            <input type="text" id="f-address">
          </div>
          <div>
            <label>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå (zipcode)</label>
            <input type="text" id="f-zipcode">
          </div>
          <div>
            <label>‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î (LAT)</label>
            <input type="text" id="f-lat">
          </div>
          <div>
            <label>‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î (LONG)</label>
            <input type="text" id="f-long">
          </div>
          <div>
            <label>‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (website)</label>
            <input type="text" id="f-website" placeholder="https://...">
          </div>
          <div>
            <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (sourceUrl)</label>
            <input type="text" id="f-url" placeholder="‡πÄ‡∏ä‡πà‡∏ô URL ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á">
          </div>
        </div>
        <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (remark)</label>
        <textarea id="f-remark"></textarea>

        <div class="btn-row">
          <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          <button type="button" class="btn-secondary" id="btnClearForm">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö -->
  <div style="margin-top:10px;">
    <a href="fa-db-local.html" class="nav">
      <span>‚¨Ö</span> ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó.
    </a>
    <a href="fa-db-menu.html" class="nav" style="margin-left:6px;">
      <span>üè†</span> ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å
    </a>
  </div>

</div>

<script>
const STORAGE_KEY = "fa-db-data-gov";

let db = [];
let attachedDoc = null; // ‡πÄ‡∏Å‡πá‡∏ö info ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

function loadDB(){
  try{
    db = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  }catch(e){
    db = [];
  }
  document.getElementById("totalRecords").textContent = db.length;
}

function saveDB(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  document.getElementById("totalRecords").textContent = db.length;
}

/* SESSION DISPLAY (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö redirect) */
function displaySession(){
  const el = document.getElementById("userEmail");
  try{
    const raw = localStorage.getItem("fas-session");
    if(!raw){ el.textContent = "-"; return; }
    const s = JSON.parse(raw);
    if(s.expiresAt && Date.now() > s.expiresAt){
      el.textContent = "-";
      return;
    }
    el.textContent = s.email || "-";
  }catch{
    el.textContent = "-";
  }
}

/* ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î */
const PROVINCES = [
  "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£","‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà","‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ","‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå","‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£",
  "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô","‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ","‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤","‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ","‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó",
  "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥","‡∏ä‡∏∏‡∏°‡∏û‡∏£","‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà","‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢","‡∏ï‡∏£‡∏±‡∏á",
  "‡∏ï‡∏£‡∏≤‡∏î","‡∏ï‡∏≤‡∏Å","‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å","‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°","‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°",
  "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤","‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä","‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå","‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ","‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™",
  "‡∏ô‡πà‡∏≤‡∏ô","‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå","‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ","‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå",
  "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ","‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ","‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤","‡∏û‡∏∞‡πÄ‡∏¢‡∏≤","‡∏û‡∏±‡∏á‡∏á‡∏≤",
  "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á","‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£","‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å","‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ","‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå",
  "‡πÅ‡∏û‡∏£‡πà","‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï","‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°","‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£","‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô",
  "‡∏¢‡∏∞‡∏•‡∏≤","‡∏¢‡πÇ‡∏™‡∏ò‡∏£","‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î","‡∏£‡∏∞‡∏ô‡∏≠‡∏á","‡∏£‡∏∞‡∏¢‡∏≠‡∏á",
  "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ","‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ","‡∏•‡∏≥‡∏õ‡∏≤‡∏á","‡∏•‡∏≥‡∏û‡∏π‡∏ô","‡πÄ‡∏•‡∏¢",
  "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©","‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","‡∏™‡∏á‡∏Ç‡∏•‡∏≤","‡∏™‡∏ï‡∏π‡∏•","‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£",
  "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°","‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£","‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß","‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ","‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ",
  "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢","‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ","‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ","‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå","‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢",
  "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π","‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á","‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç","‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ","‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå",
  "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ","‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"
];

function populateProvinceSelect(){
  const sel = document.getElementById("f-province");
  sel.innerHTML = "";
  const opt0 = document.createElement("option");
  opt0.value = "";
  opt0.textContent = "-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --";
  sel.appendChild(opt0);
  PROVINCES.forEach(p=>{
    const o = document.createElement("option");
    o.value = p;
    o.textContent = p;
    sel.appendChild(o);
  });
  sel.value = "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©";
}

/* Import CSV */
document.getElementById("btnImportCsv").addEventListener("click", ()=>{
  const file = document.getElementById("fileCsv").files[0];
  if(!file){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Å‡πà‡∏≠‡∏ô"); return; }
  const reader = new FileReader();
  reader.onload = e => {
    importFromCSVText(e.target.result, file.name);
  };
  reader.readAsText(file,"utf-8");
});

function importFromCSVText(text, fname){
  const lines = text.split(/\r?\n/).filter(l=>l.trim()!=="");
  if(lines.length < 2){
    alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");
    return;
  }
  const header = lines[0].split(",").map(h=>h.replace(/(^"|"$)/g,"").trim());

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå ‡∏≠‡∏õ‡∏ó. ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  const isThaiLG =
    header.indexOf("‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î") !== -1 &&
    header.indexOf("‡∏≠‡∏≥‡πÄ‡∏†‡∏≠") !== -1 &&
    header.indexOf("‡∏ï‡∏≥‡∏ö‡∏•") !== -1 &&
    header.indexOf("‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó.") !== -1;

  const imported = [];

  if(isThaiLG){
    const idx = {
      province   : header.indexOf("‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"),
      district   : header.indexOf("‡∏≠‡∏≥‡πÄ‡∏†‡∏≠"),
      subdistrict: header.indexOf("‡∏ï‡∏≥‡∏ö‡∏•"),
      code       : header.indexOf("‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó."),
      type       : header.indexOf("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó."),
      name       : header.indexOf("‡∏≠‡∏õ‡∏ó."),
      addrNo     : header.indexOf("‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà"),
      moo        : header.indexOf("‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà"),
      zipcode    : header.indexOf("‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå"),
      latTH      : header.indexOf("LAT"),
      longTH     : header.indexOf("LONG"),
      websiteTH  : header.indexOf("‡πÄ‡∏ß‡πá‡∏õ‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏≠‡∏õ‡∏ó")
    };
    const now = new Date().toISOString();
    for(let i=1;i<lines.length;i++){
      const cols = lines[i].split(",").map(c=>c.replace(/(^"|"$)/g,""));
      if(cols.length === 0) continue;
      const name = cols[idx.name] || "";
      const province = cols[idx.province] || "";
      const district = cols[idx.district] || "";
      const subd = cols[idx.subdistrict] || "";
      const code = (cols[idx.code] || "").toString();

      imported.push({
        code      : code,
        name      : name,
        unit      : name,
        type      : cols[idx.type] || "",
        ministry  : "‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢",
        level     : "‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô",
        province  : province,
        district  : district,
        subdistrict: subd,
        village   : "",
        address   : ((cols[idx.addrNo]||"") + (cols[idx.moo] ? " ‡∏°." + cols[idx.moo] : "")).trim(),
        zipcode   : cols[idx.zipcode] || "",
        lat       : (idx.latTH !== -1 ? cols[idx.latTH] : ""),
        long      : (idx.longTH !== -1 ? cols[idx.longTH] : ""),
        website   : (idx.websiteTH !== -1 ? cols[idx.websiteTH] : ""),
        sourceType: "csv-thai-lg",
        sourceUrl : document.getElementById("f-sourceUrl").value.trim() || "",
        attachmentName: attachedDoc ? attachedDoc.name : "",
        attachmentType: attachedDoc ? attachedDoc.type : "",
        remark    : "",
        createdAt : now,
        updatedAt : now
      });
    }
  }else{
    // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
    const idx = {
      code     : header.indexOf("code"),
      name     : header.indexOf("name"),
      unit     : header.indexOf("unit"),
      type     : header.indexOf("type"),
      ministry : header.indexOf("ministry"),
      level    : header.indexOf("level"),
      province : header.indexOf("province"),
      district : header.indexOf("district"),
      subdistrict: header.indexOf("subdistrict"),
      village  : header.indexOf("village"),
      address  : header.indexOf("address"),
      zipcode  : header.indexOf("zipcode"),
      lat      : header.indexOf("lat"),
      long     : header.indexOf("long"),
      website  : header.indexOf("website"),
      remark   : header.indexOf("remark")
    };
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏ö‡∏û‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°
    if(idx.code === -1 || idx.name === -1 || idx.province === -1){
      alert("‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö (code/name/province ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢)");
      return;
    }
    const now = new Date().toISOString();
    for(let i=1;i<lines.length;i++){
      const cols = lines[i].split(",").map(c=>c.replace(/(^"|"$)/g,""));
      if(cols.length === 0) continue;
      imported.push({
        code      : idx.code !== -1 ? (cols[idx.code]||"") : "",
        name      : idx.name !== -1 ? (cols[idx.name]||"") : "",
        unit      : idx.unit !== -1 ? (cols[idx.unit]||"") : (cols[idx.name]||""),
        type      : idx.type !== -1 ? (cols[idx.type]||"") : "",
        ministry  : idx.ministry !== -1 ? (cols[idx.ministry]||"") : "",
        level     : idx.level !== -1 ? (cols[idx.level]||"") : "",
        province  : idx.province !== -1 ? (cols[idx.province]||"") : "",
        district  : idx.district !== -1 ? (cols[idx.district]||"") : "",
        subdistrict: idx.subdistrict !== -1 ? (cols[idx.subdistrict]||"") : "",
        village   : idx.village !== -1 ? (cols[idx.village]||"") : "",
        address   : idx.address !== -1 ? (cols[idx.address]||"") : "",
        zipcode   : idx.zipcode !== -1 ? (cols[idx.zipcode]||"") : "",
        lat       : idx.lat !== -1 ? (cols[idx.lat]||"") : "",
        long      : idx.long !== -1 ? (cols[idx.long]||"") : "",
        website   : idx.website !== -1 ? (cols[idx.website]||"") : "",
        sourceType: "csv-english",
        sourceUrl : document.getElementById("f-sourceUrl").value.trim() || "",
        attachmentName: attachedDoc ? attachedDoc.name : "",
        attachmentType: attachedDoc ? attachedDoc.type : "",
        remark    : idx.remark !== -1 ? (cols[idx.remark]||"") : "",
        createdAt : now,
        updatedAt : now
      });
    }
  }

  if(imported.length === 0){
    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ");
    return;
  }
  db = db.concat(imported);
  saveDB();

  document.getElementById("importLog").textContent =
    `‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå "${fname}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${imported.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${db.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
}

/* Import Excel */
document.getElementById("btnImportXlsx").addEventListener("click", ()=>{
  const file = document.getElementById("fileXlsx").files[0];
  if(!file){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏Å‡πà‡∏≠‡∏ô"); return; }
  const reader = new FileReader();
  reader.onload = e =>{
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data,{type:"array"});
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    const csv = XLSX.utils.sheet_to_csv(sheet);
    importFromCSVText(csv, file.name);
  };
  reader.readAsArrayBuffer(file);
});

/* ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ */
document.getElementById("fileDoc").addEventListener("change", e=>{
  const f = e.target.files[0];
  if(!f){ attachedDoc = null; return; }
  attachedDoc = { name:f.name, type:f.type || "document" };
});

/* ‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö / ‡∏•‡∏¥‡∏á‡∏Å‡πå */
document.getElementById("btnClearAttach").addEventListener("click", ()=>{
  document.getElementById("fileCsv").value = "";
  document.getElementById("fileXlsx").value = "";
  document.getElementById("fileDoc").value = "";
  document.getElementById("f-sourceUrl").value = "";
  attachedDoc = null;
  document.getElementById("importLog").textContent = "‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß";
});

/* ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ */
function clearForm(){
  document.getElementById("f-code").value = "";
  document.getElementById("f-name").value = "";
  document.getElementById("f-unit").value = "";
  document.getElementById("f-type").value = "";
  document.getElementById("f-ministry").value = "‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢";
  document.getElementById("f-level").value = "‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô";
  document.getElementById("f-province").value = "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©";
  document.getElementById("f-district").value = "";
  document.getElementById("f-subdistrict").value = "";
  document.getElementById("f-village").value = "";
  document.getElementById("f-address").value = "";
  document.getElementById("f-zipcode").value = "";
  document.getElementById("f-lat").value = "";
  document.getElementById("f-long").value = "";
  document.getElementById("f-website").value = "";
  document.getElementById("f-url").value = "";
  document.getElementById("f-remark").value = "";
}
document.getElementById("btnClearForm").addEventListener("click", clearForm);

document.getElementById("formAdd").addEventListener("submit", e=>{
  e.preventDefault();
  const code = document.getElementById("f-code").value.trim();
  const name = document.getElementById("f-name").value.trim();
  if(!code || !name){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }
  const now = new Date().toISOString();
  const rec = {
    code      : code,
    name      : name,
    unit      : document.getElementById("f-unit").value.trim() || name,
    type      : document.getElementById("f-type").value.trim(),
    ministry  : document.getElementById("f-ministry").value.trim(),
    level     : document.getElementById("f-level").value,
    province  : document.getElementById("f-province").value,
    district  : document.getElementById("f-district").value.trim(),
    subdistrict: document.getElementById("f-subdistrict").value.trim(),
    village   : document.getElementById("f-village").value.trim(),
    address   : document.getElementById("f-address").value.trim(),
    zipcode   : document.getElementById("f-zipcode").value.trim(),
    lat       : document.getElementById("f-lat").value.trim(),
    long      : document.getElementById("f-long").value.trim(),
    website   : document.getElementById("f-website").value.trim(),
    sourceType: "manual",
    sourceUrl : document.getElementById("f-url").value.trim(),
    attachmentName: attachedDoc ? attachedDoc.name : "",
    attachmentType: attachedDoc ? attachedDoc.type : "",
    remark    : document.getElementById("f-remark").value.trim(),
    createdAt : now,
    updatedAt : now
  };
  db.push(rec);
  saveDB();
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î "+db.length+" ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)");
  clearForm();
});

/* init */
displaySession();
loadDB();
populateProvinceSelect();
clearForm();
</script>

</body>
</html>
