<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏á‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (2 ‡∏õ‡∏µ)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, sans-serif;
      background:#060818;
      color:#f5f7ff;
    }
    header{
      padding:18px 20px 12px;
      background:linear-gradient(120deg,#0d47a1,#42a5f5,#7b1e3c);
      box-shadow:0 4px 12px rgba(0,0,0,0.45);
    }
    header h1{
      margin:0;
      font-size:24px;
      font-weight:700;
    }
    header p{
      margin:4px 0 0 0;
      font-size:13px;
      opacity:0.9;
    }

    .header-actions{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .btn-header{
      padding:6px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.3);
      background:rgba(0,0,0,0.25);
      color:#fff;
      font-size:12px;
      cursor:pointer;
    }
    .btn-header:hover{
      background:rgba(0,0,0,0.45);
    }

    .container{
      padding:20px;
    }

    .upload-box{
      background:#11152b;
      padding:18px 20px;
      border-radius:14px;
      border:1px solid #262b46;
      margin-bottom:20px;
    }
    .upload-box h3{
      margin-top:0;
      font-size:18px;
    }
    .upload-box label{
      font-size:14px;
    }
    .upload-box input[type="file"]{
      margin-top:6px;
      margin-bottom:10px;
    }
    .btn-primary{
      padding:8px 18px;
      border:none;
      border-radius:999px;
      background:#42a5f5;
      color:#fff;
      font-size:14px;
      cursor:pointer;
      box-shadow:0 4px 10px rgba(0,0,0,0.4);
    }
    .btn-primary:hover{
      background:#64b5f6;
    }

    .btn-link-report{
      margin-top:10px;
      padding:7px 16px;
      border-radius:999px;
      border:1px solid #42a5f5;
      background:transparent;
      color:#42a5f5;
      font-size:13px;
      cursor:pointer;
    }
    .btn-link-report:hover{
      background:rgba(66,165,245,0.12);
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:16px;
      background:#11152b;
    }
    th,td{
      border:1px solid #262b46;
      padding:6px 8px;
      font-size:13px;
    }
    th{
      background:#0d47a1;
      text-align:center;
      position:sticky;
      top:0;
      z-index:5;
    }
    td.num{
      text-align:right;
      font-variant-numeric:tabular-nums;
    }
    td.note-col{
      text-align:center;
      width:70px;
    }

    /* ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ */
    .lvl-1{ padding-left:4px; }
    .lvl-2{ padding-left:18px; }
    .lvl-3{ padding-left:34px; }

    /* ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏ñ‡∏ß */
    .row-section{
      background:#1b2142;
      font-weight:800;
      border-top:2px solid #42a5f5;
    }
    .row-group{
      background:#151c38;
      font-weight:700;
    }
    .row-subtotal{
      background:#172844;
      font-weight:700;
    }
    .row-grand{
      background:#264d79;
      font-weight:800;
    }

    .caption{
      margin-top:10px;
      font-size:13px;
      opacity:0.85;
    }
    a.note-link{
      color:#ffd54f;
      text-decoration:none;
    }
    a.note-link:hover{
      text-decoration:underline;
    }
  </style>
</head>

<body>

<header>
  <h1>‡∏á‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (2 ‡∏õ‡∏µ)</h1>
  <p>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ ‡πÅ‡∏ú‡πà‡∏ô <strong>BS</strong> ‚Äì ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô</p>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Annual Report (Editor) -->
  <div class="header-actions">
    <button class="btn-header" onclick="goToAnnualReport()">
      ‚ñ∂ ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (fa-lg-annual-report-editor.html)
    </button>
  </div>
</header>

<div class="container">

  <div class="upload-box">
    <h3>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå Excel ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</h3>
    <p class="caption">
      ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏õ‡∏µ N) ‡πÅ‡∏•‡∏∞‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô (‡∏õ‡∏µ N-1)
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á SOFP ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ
    </p>

    <div>
      <label>‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏õ‡∏µ N):<br>
        <input type="file" id="fileCurrent" accept=".xlsx,.xls,.xlsm" />
      </label>
    </div>

    <div>
      <label>‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô (‡∏õ‡∏µ N-1):<br>
        <input type="file" id="filePrevious" accept=".xlsx,.xls,.xlsm" />
      </label>
    </div>

    <button class="btn-primary" onclick="processSOFP()">
      ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏á‡∏ö‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (2 ‡∏õ‡∏µ)
    </button>
  </div>

  <div id="bsContainer"></div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Annual Report (Editor) -->
  <div id="sendToReportContainer" style="display:none;">
    <button class="btn-link-report" onclick="sendToAnnualReport()">
      üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ö‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (2 ‡∏õ‡∏µ) ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (Editor)
    </button>
    <p class="caption">
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô <code>localStorage</code> ‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ key 
      <code>fa-lg-balance-2y</code> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤ 
      <code>fa-lg-annual-report-editor.html</code> 
      ‡∏î‡∏∂‡∏á‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
    </p>
  </div>

</div>

<!-- XLSX -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.20.0/dist/xlsx.full.min.js"></script>

<script>
// ----------------------------------------------------
// 0) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Annual Report (Editor)
// ----------------------------------------------------
function goToAnnualReport(){
  // ‡πÉ‡∏ä‡πâ hash ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å BS 2 ‡∏õ‡∏µ ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ Editor ‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ
  window.location.href = 'fa-lg-annual-report-editor.html#source=bs-2y';
}

// ----------------------------------------------------
// 1) ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á SOFP ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤
// ----------------------------------------------------
const SOFP_SPEC = {
  fs_type: "SOFP",
  sheet_name: "BS",
  description: "‡∏á‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô",
  lines: [
    {"line_code":"SOFP_001","excel_row":5,"label":"‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå","note_ref":"‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏","level_col":1,"line_type":"section_header"},
    {"line_code":"SOFP_002","excel_row":6,"label":"‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","note_ref":null,"level_col":2,"line_type":"group_header"},
    {"line_code":"SOFP_003","excel_row":7,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î","note_ref":4,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_004","excel_row":8,"label":"‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤","note_ref":5,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_005","excel_row":9,"label":"‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":6,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_006","excel_row":10,"label":"‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":7,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_007","excel_row":11,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":8,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_008","excel_row":12,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":9,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_009","excel_row":13,"label":"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠","note_ref":10,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_010","excel_row":14,"label":"‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠","note_ref":11,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_011","excel_row":15,"label":"‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô","note_ref":12,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_012","excel_row":16,"label":"‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","note_ref":null,"level_col":3,"line_type":"subtotal"},
    {"line_code":"SOFP_013","excel_row":17,"label":"‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","note_ref":null,"level_col":2,"line_type":"group_header"},
    {"line_code":"SOFP_014","excel_row":18,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß","note_ref":13,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_015","excel_row":19,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß","note_ref":14,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_016","excel_row":20,"label":"‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå - ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥","note_ref":15,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_017","excel_row":21,"label":"‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô - ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥","note_ref":16,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_018","excel_row":22,"label":"‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏ï‡∏ô - ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥","note_ref":17,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_019","excel_row":23,"label":"‡∏≠‡∏™‡∏±‡∏á‡∏´‡∏≤‡∏£‡∏¥‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô - ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥","note_ref":18,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_020","excel_row":24,"label":"‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô","note_ref":19,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_021","excel_row":25,"label":"‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","note_ref":null,"level_col":3,"line_type":"subtotal"},
    {"line_code":"SOFP_022","excel_row":26,"label":"‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå","note_ref":null,"level_col":1,"line_type":"subtotal"},
    {"line_code":"SOFP_023","excel_row":27,"label":"‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥/‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏∏‡∏ô","note_ref":null,"level_col":1,"line_type":"section_header"},
    {"line_code":"SOFP_024","excel_row":28,"label":"‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô","note_ref":null,"level_col":1,"line_type":"section_header"},
    {"line_code":"SOFP_025","excel_row":29,"label":"‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","note_ref":null,"level_col":2,"line_type":"group_header"},
    {"line_code":"SOFP_026","excel_row":30,"label":"‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤","note_ref":20,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_027","excel_row":31,"label":"‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":21,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_028","excel_row":32,"label":"‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏∑‡πà‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":22,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_029","excel_row":33,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":23,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_030","excel_row":34,"label":"‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏õ‡∏µ","note_ref":24,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_031","excel_row":35,"label":"‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1 ‡∏õ‡∏µ","note_ref":25,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_032","excel_row":36,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏±‡∏ö‡∏ù‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":26,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_033","excel_row":37,"label":"‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô","note_ref":27,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_034","excel_row":38,"label":"‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô","note_ref":28,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_035","excel_row":39,"label":"‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","note_ref":null,"level_col":3,"line_type":"subtotal"},
    {"line_code":"SOFP_036","excel_row":40,"label":"‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","note_ref":null,"level_col":2,"line_type":"group_header"},
    {"line_code":"SOFP_037","excel_row":41,"label":"‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß","note_ref":null,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_038","excel_row":42,"label":"‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß","note_ref":29,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_039","excel_row":43,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß - ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥","note_ref":30,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_040","excel_row":44,"label":"‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß - ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥","note_ref":31,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_041","excel_row":45,"label":"‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏±‡∏ö‡∏ù‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß","note_ref":32,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_042","excel_row":46,"label":"‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß","note_ref":33,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_043","excel_row":47,"label":"‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏≠‡∏∑‡πà‡∏ô","note_ref":34,"level_col":3,"line_type":"detail"},
    {"line_code":"SOFP_044","excel_row":48,"label":"‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","note_ref":null,"level_col":3,"line_type":"subtotal"},
    {"line_code":"SOFP_045","excel_row":49,"label":"‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô","note_ref":null,"level_col":1,"line_type":"subtotal"},
    {"line_code":"SOFP_046","excel_row":50,"label":"‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥/‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏∏‡∏ô","note_ref":null,"level_col":1,"line_type":"section_header"},
    {"line_code":"SOFP_047","excel_row":51,"label":"‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á/(‡∏ï‡πà‡∏≥)‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏∞‡∏™‡∏°","note_ref":39,"level_col":2,"line_type":"detail"},
    {"line_code":"SOFP_048","excel_row":52,"label":"‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥/‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏∏‡∏ô","note_ref":40,"level_col":2,"line_type":"detail"},
    {"line_code":"SOFP_049","excel_row":53,"label":"‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥","note_ref":null,"level_col":2,"line_type":"detail"},
    {"line_code":"SOFP_050","excel_row":54,"label":"‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥/‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏∏‡∏ô","note_ref":null,"level_col":1,"line_type":"grand_total"},
    {"line_code":"SOFP_051","excel_row":55,"label":"‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥/‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏∏‡∏ô","note_ref":null,"level_col":1,"line_type":"grand_total"}
  ]
};

// ----------------------------------------------------
// 2) ‡∏≠‡πà‡∏≤‡∏ô Excel
// ----------------------------------------------------
function readExcel(file){
  return new Promise((resolve, reject)=>{
    const reader = new FileReader();
    reader.onload = e => {
      try{
        const data = new Uint8Array(e.target.result);
        const wb = XLSX.read(data, {type:"array"});
        resolve(wb);
      }catch(err){
        reject(err);
      }
    };
    reader.onerror = reject;
    reader.readAsArrayBuffer(file);
  });
}

// ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå C (index 2) ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏á‡∏ö
function getValue(sheet, excelRow, colIndex=2){
  const addr = XLSX.utils.encode_cell({r:excelRow-1, c:colIndex});
  const cell = sheet[addr];
  return cell ? cell.v : "";
}

// ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô string)
function toNumber(v){
  if(v === null || v === undefined || v === "") return null;
  if(typeof v === "number") return v;
  const cleaned = String(v).replace(/[, ]/g,"");
  const n = Number(cleaned);
  return isNaN(n) ? null : n;
}

// ----------------------------------------------------
// 3) ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏á‡∏ö‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô 2 ‡∏õ‡∏µ + ‡∏™‡πà‡∏á payload ‡πÑ‡∏õ localStorage
// ----------------------------------------------------
async function processSOFP(){
  const fileN  = document.getElementById("fileCurrent").files[0];
  const fileP  = document.getElementById("filePrevious").files[0];

  if(!fileN || !fileP){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ ‡∏õ‡∏µ N ‡πÅ‡∏•‡∏∞‡∏õ‡∏µ N-1 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  const wbN = await readExcel(fileN);
  const wbP = await readExcel(fileP);

  const sheetName = SOFP_SPEC.sheet_name;
  const sheetN = wbN.Sheets[sheetName];
  const sheetP = wbP.Sheets[sheetName];

  if(!sheetN || !sheetP){
    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠ 'BS' ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå");
    return;
  }

  let html = `
    <table>
      <tr>
        <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
        <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        <th>‡∏õ‡∏µ N</th>
        <th>‡∏õ‡∏µ N-1</th>
      </tr>
  `;

  // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° payload ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Annual Report (Editor)
  const rowsPayload = [];

  SOFP_SPEC.lines.forEach(line=>{
    const row = line.excel_row;
    const rawN = getValue(sheetN, row);
    const rawP = getValue(sheetP, row);
    const vN = rawN;
    const vP = rawP;

    // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤
    const lvlClass = line.level_col === 1 ? "lvl-1"
                     : line.level_col === 2 ? "lvl-2"
                     : "lvl-3";

    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å class ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏ñ‡∏ß
    let trClass = "";
    if(line.line_type === "section_header") trClass = "row-section";
    else if(line.line_type === "group_header") trClass = "row-group";
    else if(line.line_type === "subtotal") trClass = "row-subtotal";
    else if(line.line_type === "grand_total") trClass = "row-grand";

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
    let noteCell = "";
    if(typeof line.note_ref === "number"){
      const n = line.note_ref;
      noteCell = `<a class="note-link" href="fa-lg-notes-2y.html#note-${n}" target="_blank">${n}</a>`;
    }else{
      noteCell = (line.note_ref && line.note_ref !== null && line.line_type === "section_header")
                  ? line.note_ref
                  : "";
    }

    // section header ‡πÉ‡∏´‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
    if(line.line_type === "section_header"){
      html += `
        <tr class="${trClass}">
          <td class="${lvlClass}" colspan="4">${line.label}</td>
        </tr>
      `;
    }else{
      html += `
        <tr class="${trClass}">
          <td class="${lvlClass}">${line.label}</td>
          <td class="note-col">${noteCell}</td>
          <td class="num">${vN ?? ""}</td>
          <td class="num">${vP ?? ""}</td>
        </tr>
      `;
    }

    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á payload
    rowsPayload.push({
      line_code : line.line_code,
      label     : line.label,
      note_ref  : line.note_ref,
      line_type : line.line_type,
      level_col : line.level_col,
      excel_row : line.excel_row,
      year_N    : toNumber(vN),
      year_N_1  : toNumber(vP)
    });
  });

  html += `</table>
    <p class="caption">
      * ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ <code>fa-lg-notes-2y.html</code><br>
      * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤ <code>fa-lg-annual-report-editor.html</code> ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
    </p>
  `;

  document.getElementById("bsContainer").innerHTML = html;

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á payload ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage
  const payload = {
    fs_type     : SOFP_SPEC.fs_type,
    sheet_name  : SOFP_SPEC.sheet_name,
    description : SOFP_SPEC.description,
    generated_at: new Date().toISOString(),
    source_files: {
      current : fileN.name,
      previous: fileP.name
    },
    rows: rowsPayload
  };

  try{
    localStorage.setItem('fa-lg-balance-2y', JSON.stringify(payload));
    document.getElementById('sendToReportContainer').style.display = 'block';
  }catch(e){
    console.error(e);
    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á localStorage ‡πÑ‡∏î‡πâ ‚Äì ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå");
  }
}

// ----------------------------------------------------
// 4) ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Annual Report (Editor)
// ----------------------------------------------------
function sendToAnnualReport(){
  const data = localStorage.getItem('fa-lg-balance-2y');
  if(!data){
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ö‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Å‡πà‡∏≠‡∏ô");
    return;
  }
  // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Annual Report (Editor) ‡∏û‡∏£‡πâ‡∏≠‡∏° hash ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ BS 2 ‡∏õ‡∏µ
  window.location.href = 'fa-lg-annual-report-editor.html#source=bs-2y';
}
</script>

</body>
</html>
