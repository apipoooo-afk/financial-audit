<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>FA Cash Board | Executive Summary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg-page:#f3f5fb;
      --bg-header:#ffffff;
      --bg-card:#ffffff;
      --bg-sidebar:#0f172a;
      --bg-kpi:#ffffff;
      --border-soft:#e2e8f0;
      --border-strong:#cbd5e1;
      --accent:#2563eb;
      --accent-soft:#e0edff;
      --accent-danger:#ef4444;
      --accent-success:#16a34a;
      --accent-warning:#eab308;
      --text-main:#0f172a;
      --text-muted:#64748b;
      --shadow-soft:0 6px 20px rgba(15,23,42,0.15);
      --radius-lg:16px;
    }
    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:"Segoe UI",Tahoma,Arial,sans-serif;
      background:var(--bg-page);
      color:var(--text-main);
    }

    .layout{
      display:flex;
      min-height:100vh;
    }

    /* SIDEBAR LEFT */

    .sidebar{
      width:70px;
      background:var(--bg-sidebar);
      color:#e5e7eb;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:12px 8px;
      gap:10px;
      box-shadow:2px 0 8px rgba(15,23,42,0.4);
      position:sticky;
      top:0;
    }

    .sb-logo{
      font-size:22px;
      margin-bottom:6px;
    }
    .sb-title{
      font-size:11px;
      text-align:center;
      line-height:1.2;
      margin-bottom:8px;
    }
    .sb-nav{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:4px;
      flex:1;
    }
    .sb-btn{
      width:46px;
      height:46px;
      border-radius:14px;
      border:none;
      background:transparent;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      position:relative;
    }
    .sb-btn span{
      font-size:22px;
    }
    .sb-btn.active{
      background:linear-gradient(135deg,#2563eb,#4f46e5);
    }
    .sb-btn:hover{
      background:rgba(148,163,184,0.25);
    }
    .sb-tooltip{
      position:absolute;
      left:54px;
      top:50%;
      transform:translateY(-50%);
      background:#111827;
      color:#e5e7eb;
      padding:4px 8px;
      border-radius:6px;
      font-size:11px;
      white-space:nowrap;
      opacity:0;
      pointer-events:none;
      transition:.12s;
    }
    .sb-btn:hover .sb-tooltip{
      opacity:1;
    }

    .sb-footer{
      font-size:10px;
      color:#94a3b8;
      text-align:center;
      margin-top:10px;
    }

    /* MAIN */

    .main{
      flex:1;
      display:flex;
      flex-direction:column;
      min-width:0;
    }

    /* HEADER TOP */

    header{
      background:var(--bg-header);
      box-shadow:0 2px 6px rgba(148,163,184,.35);
      padding:10px 16px 8px;
      position:sticky;
      top:0;
      z-index:10;
    }
    .header-row1{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      flex-wrap:wrap;
    }
    .h-title-block{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .h-title{
      font-size:22px;
      font-weight:800;
      color:#0f172a;
    }
    .h-sub{
      font-size:13px;
      color:var(--text-muted);
    }
    .h-tag{
      margin-top:2px;
      font-size:11px;
      color:var(--text-muted);
    }
    .h-right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:4px;
      min-width:220px;
    }
    .h-filters-top{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }
    .filter-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border-soft);
      background:#f8fafc;
      font-size:12px;
    }
    .dt-box{
      font-size:11px;
      border-radius:10px;
      padding:4px 8px;
      background:#0f172a;
      color:#e5e7eb;
      display:inline-flex;
      flex-direction:column;
      align-items:flex-end;
      gap:2px;
    }

    .header-row2{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      font-size:12px;
    }
    .hdr-label{
      font-weight:600;
      color:var(--text-muted);
    }

    .hdr-select{
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border-strong);
      background:#eff6ff;
      font-size:12px;
      min-width:100px;
    }

    /* CONTENT */

    .content{
      padding:12px 16px 24px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    /* KPI CARDS */

    .kpi-row{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:10px;
    }
    .kpi-card{
      background:var(--bg-kpi);
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-soft);
      padding:8px 10px;
      border:1px solid var(--border-soft);
      position:relative;
      overflow:hidden;
      cursor:default;
    }
    .kpi-card::after{
      content:"";
      position:absolute;
      right:-20px;
      top:-20px;
      width:80px;
      height:80px;
      border-radius:50%;
      background:rgba(148,163,184,0.13);
    }
    .kpi-label{
      font-size:11px;
      color:var(--text-muted);
      margin-bottom:2px;
      display:flex;
      justify-content:space-between;
      gap:4px;
    }
    .kpi-main{
      display:flex;
      align-items:flex-end;
      gap:6px;
    }
    .kpi-value{
      font-size:20px;
      font-weight:800;
      color:#0f172a;
    }
    .kpi-unit{
      font-size:11px;
      color:var(--text-muted);
      margin-bottom:2px;
    }
    .kpi-chip{
      font-size:10px;
      padding:2px 6px;
      border-radius:999px;
      background:var(--accent-soft);
      color:var(--accent);
      border:1px solid rgba(37,99,235,0.35);
    }
    .kpi-foot{
      font-size:10px;
      color:var(--text-muted);
      margin-top:4px;
    }
    .kpi-card[data-tip]:hover::before{
      content:attr(data-tip);
      position:absolute;
      left:8px;
      bottom:6px;
      padding:4px 6px;
      border-radius:6px;
      background:#0f172a;
      color:#e5e7eb;
      font-size:10px;
      max-width:260px;
      box-shadow:0 4px 12px rgba(15,23,42,0.7);
      white-space:normal;
      z-index:5;
    }

    /* CHART AREA */

    .chart-row{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:12px;
    }
    .chart-card{
      background:#ffffff;
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-soft);
      border:1px solid var(--border-soft);
      padding:10px 12px 12px;
    }
    .chart-title{
      font-size:13px;
      font-weight:600;
      margin-bottom:2px;
    }
    .chart-sub{
      font-size:11px;
      color:var(--text-muted);
      margin-bottom:4px;
    }
    .chart-wrap{
      position:relative;
      height:220px;
    }

    /* TABLE */

    .table-card{
      background:#ffffff;
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-soft);
      border:1px solid var(--border-soft);
      padding:10px 12px 12px;
    }
    .table-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
      font-size:13px;
    }
    .table-info{
      font-size:11px;
      color:var(--text-muted);
    }
    .table-search-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-bottom:8px;
      font-size:11px;
      color:var(--text-muted);
    }
    .table-search-row input{
      padding:6px 8px;
      border-radius:999px;
      border:1px solid var(--border-strong);
      min-width:210px;
      font-size:12px;
    }
    .table-container{
      max-height:280px;
      overflow:auto;
      border-radius:12px;
      border:1px solid var(--border-strong);
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
    }
    thead{
      background:#eff6ff;
      position:sticky;
      top:0;
      z-index:5;
    }
    th,td{
      padding:5px 6px;
      border-bottom:1px solid #e5e7eb;
      white-space:nowrap;
      text-align:left;
    }
    tbody tr:nth-child(even){
      background:#f8fafc;
    }
    tbody tr:hover{
      background:#e0f2fe;
    }
    .col-code{font-family:monospace;}

    .link-small a{
      color:#2563eb;
      text-decoration:none;
    }
    .link-small a:hover{text-decoration:underline;}

    /* BOTTOM BUTTONS */

    .bottom-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:8px;
      font-size:12px;
    }
    .btn-secondary{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border-strong);
      background:#ffffff;
      box-shadow:0 2px 6px rgba(148,163,184,.35);
      cursor:pointer;
      text-decoration:none;
      color:var(--text-main);
    }
    .btn-secondary:hover{
      background:#eff6ff;
    }

    @media(max-width:768px){
      .header-row1{flex-direction:column;}
      .h-right{align-items:flex-start;}
      .sidebar{display:none;} /* ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ã‡πà‡∏≠‡∏ô sidebar */
    }
  </style>
</head>
<body>

<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sb-logo">üìä</div>
    <div class="sb-title">
      FA<br>CASH<br>BOARD
    </div>

    <div class="sb-nav">
      <button class="sb-btn" onclick="location.href='index.html'">
        <span>üè†</span>
        <div class="sb-tooltip">Portal ‡∏´‡∏•‡∏±‡∏Å</div>
      </button>
      <button class="sb-btn" onclick="location.href='fa-menu.html'">
        <span>üìÇ</span>
        <div class="sb-tooltip">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (FA)</div>
      </button>
      <button class="sb-btn" onclick="location.href='fa-tracking.html'">
        <span>üìå</span>
        <div class="sb-tooltip">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•</div>
      </button>
      <button class="sb-btn" onclick="location.href='fa-review-login.html'">
        <span>üßÆ</span>
        <div class="sb-tooltip">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô</div>
      </button>
      <button class="sb-btn" onclick="location.href='fa-chatbot.html'">
        <span>ü§ñ</span>
        <div class="sb-tooltip">Chatbot FA</div>
      </button>
      <button class="sb-btn active" onclick="location.href='fa-dashboard.html'">
        <span>üìà</span>
        <div class="sb-tooltip">FA Cash Board</div>
      </button>
      <button class="sb-btn" onclick="location.href='fa-db-data-gov.html'">
        <span>üóÑ</span>
        <div class="sb-tooltip">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á ‡∏≠‡∏õ‡∏ó.</div>
      </button>
    </div>

    <div class="sb-footer">
      OAG SS<br>Group 4
    </div>
  </aside>

  <!-- MAIN PANEL -->
  <div class="main">

    <header>
      <div class="header-row1">
        <div class="h-title-block">
          <div class="h-title">EXECUTIVE SUMMARY ‚Äì FA CASH BOARD</div>
          <div class="h-sub">
            ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡∏≠‡∏õ‡∏ó. ‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® (Real-time ‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á)
          </div>
          <div class="h-tag">
            ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà 4 ‚Ä¢ ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©
          </div>
        </div>

        <div class="h-right">
          <div class="h-filters-top">
            <div class="filter-pill">
              üîÑ Data refresh:
              <span id="lastRefresh">‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
            </div>
            <div class="filter-pill">
              ‚ö° Mode: Real-time polling (30s)
            </div>
          </div>
          <div class="dt-box">
            <div>üìÖ <span id="thaiDate">--</span></div>
            <div>üïí <span id="thaiTime">--:--:--</span> ‡∏ô.</div>
          </div>
        </div>
      </div>

      <div class="header-row2">
        <span class="hdr-label">Filter:</span>
        <select id="yearFilter" class="hdr-select">
          <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option>
        </select>
        <select id="quarterFilter" class="hdr-select">
          <option value="">‡∏ó‡∏∏‡∏Å‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™</option>
          <option value="Q1">Q1</option>
          <option value="Q2">Q2</option>
          <option value="Q3">Q3</option>
          <option value="Q4">Q4</option>
        </select>
        <select id="regionFilter" class="hdr-select">
          <option value="">‡∏ó‡∏∏‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ</option>
          <option value="Central">Central</option>
          <option value="North">North</option>
          <option value="NorthEast">North East</option>
          <option value="South">South</option>
          <option value="Bangkok">Bangkok</option>
        </select>
        <span style="font-size:11px;color:var(--text-muted);">
          (* ‡∏ñ‡πâ‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ field ‡∏õ‡∏µ / ‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ / ‡∏ó‡∏∏‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ‚Äù ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
        </span>
      </div>
    </header>

    <div class="content">

      <!-- KPI ROW -->
      <div class="kpi-row">
        <div class="kpi-card" id="kpiTotalUnits"
             data-tip="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏≠‡∏õ‡∏ó. ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á (‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏•‡πâ‡∏ß)">
          <div class="kpi-label">
            <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏≠‡∏õ‡∏ó. ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
            <span class="kpi-chip">1.1 Total LG Units</span>
          </div>
          <div class="kpi-main">
            <div class="kpi-value" id="kpiTotalUnitsValue">0</div>
            <div class="kpi-unit">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
          </div>
          <div class="kpi-foot" id="kpiTotalUnitsFoot">‚Äì</div>
        </div>

        <div class="kpi-card" id="kpiFsClosed"
             data-tip="‡πÉ‡∏ä‡πâ field fsStatus = closed / notClosed / late / notSubmitted ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏¥‡∏î‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô">
          <div class="kpi-label">
            <span>‡∏õ‡∏¥‡∏î‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>
            <span class="kpi-chip" style="background:#dcfce7;color:#166534;border-color:#22c55e;">
              1.2 FS Closed
            </span>
          </div>
          <div class="kpi-main">
            <div class="kpi-value" id="kpiFsClosedValue">0</div>
            <div class="kpi-unit">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
          </div>
          <div class="kpi-foot" id="kpiFsClosedFoot">‚Äì</div>
        </div>

        <div class="kpi-card" id="kpiFsOpinion"
             data-tip="‡πÉ‡∏ä‡πâ field fsOpinion = unqualified / qualified / adverse / disclaimer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô">
          <div class="kpi-label">
            <span>‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (Unqualified)</span>
            <span class="kpi-chip" style="background:#e0f2fe;color:#0ea5e9;border-color:#0ea5e9;">
              1.3 FS Opinion
            </span>
          </div>
          <div class="kpi-main">
            <div class="kpi-value" id="kpiFsUnqValue">0</div>
            <div class="kpi-unit">‡∏´‡∏ô‡πà‡∏ß‡∏¢</div>
          </div>
          <div class="kpi-foot" id="kpiFsUnqFoot">‚Äì</div>
        </div>

        <div class="kpi-card" id="kpiAuditProgress"
             data-tip="‡πÉ‡∏ä‡πâ field progressStep = followUp / reportSent ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">
          <div class="kpi-label">
            <span>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>
            <span class="kpi-chip" style="background:#fee2e2;color:#b91c1c;border-color:#f97373;">
              1.5‚Äì1.6 Audit Progress
            </span>
          </div>
          <div class="kpi-main">
            <div class="kpi-value" id="kpiAuditDoneValue">0%</div>
            <div class="kpi-unit">‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          </div>
          <div class="kpi-foot" id="kpiAuditDoneFoot">‚Äì</div>
        </div>
      </div>

      <!-- CHARTS -->
      <div class="chart-row">
        <div class="chart-card">
          <div class="chart-title">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏≠‡∏õ‡∏ó. ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</div>
          <div class="chart-sub">
            ‡πÉ‡∏ä‡πâ field <code>type / ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</code> (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏ó‡∏°, ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏û‡∏±‡∏ó‡∏¢‡∏≤, ‡∏≠‡∏ö‡∏à., ‡∏ó‡∏ô., ‡∏ó‡∏ï., ‡∏≠‡∏ö‡∏ï.) ‚Äì ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå 1.1
          </div>
          <div class="chart-wrap">
            <canvas id="chartType"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-title">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
          <div class="chart-sub">
            ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢: ‡∏õ‡∏¥‡∏î‡∏á‡∏ö‡πÅ‡∏•‡πâ‡∏ß / ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î / ‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤ / ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏á‡∏ö + ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
            (‡πÉ‡∏ä‡πâ field <code>fsStatus</code>, <code>progressStep</code>)
          </div>
          <div class="chart-wrap">
            <canvas id="chartStatus"></canvas>
          </div>
        </div>
      </div>

      <!-- TABLE -->
      <div class="table-card">
        <div class="table-head">
          <div>Sales-like table ‚Üí ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‡∏≠‡∏õ‡∏ó. (‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á)</div>
          <div class="table-info" id="tableInfo">‡πÅ‡∏™‡∏î‡∏á 0 ‡∏à‡∏≤‡∏Å 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
        </div>
        <div class="table-search-row">
          <span>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:</span>
          <input id="searchInput" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ / ‡∏£‡∏´‡∏±‡∏™ / ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...">
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th style="width:40px;">#</th>
                <th>‡∏£‡∏´‡∏±‡∏™</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
                <th>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</th>
                <th>‡∏ï‡∏≥‡∏ö‡∏•</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</th>
                <th>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</th>
                <th>‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</th>
                <th>‡∏•‡∏¥‡∏á‡∏Å‡πå</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>

        <div class="bottom-row">
          <a class="btn-secondary" href="fa-db-data-gov.html">
            üóÑ ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏≠‡∏õ‡∏ó. (FA DB)
          </a>
          <a class="btn-secondary" href="index.html">
            ‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö Portal ‡∏´‡∏•‡∏±‡∏Å
          </a>
        </div>
      </div>

    </div> <!-- content -->

  </div><!-- main -->
</div><!-- layout -->

<script>
  /* ========= Date/Time ‡πÑ‡∏ó‡∏¢ ========= */
  function updateThaiDateTime(){
    const now = new Date();
    const thMonths = [
      "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå","‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°","‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô","‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
      "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°","‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô","‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°","‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô","‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
    ];
    const d = now.getDate();
    const m = now.getMonth();
    const y = now.getFullYear()+543;
    document.getElementById("thaiDate").textContent =
      d+" "+thMonths[m]+" ‡∏û.‡∏®. "+y;

    const hh = String(now.getHours()).padStart(2,"0");
    const mm = String(now.getMinutes()).padStart(2,"0");
    const ss = String(now.getSeconds()).padStart(2,"0");
    document.getElementById("thaiTime").textContent = `${hh}:${mm}:${ss}`;
  }
  updateThaiDateTime();
  setInterval(updateThaiDateTime,1000);

  /* ========= CONFIG REAL-TIME SOURCE ========= */
  const API_URL = "https://apipoooo-afk.github.io/financial-audit/fa-db-data-gov.json";
  let rawData = [];
  let chartType = null;
  let chartStatus = null;

  const yearFilter   = document.getElementById("yearFilter");
  const quarterFilter= document.getElementById("quarterFilter");
  const regionFilter = document.getElementById("regionFilter");
  const searchInput  = document.getElementById("searchInput");
  const lastRefreshEl= document.getElementById("lastRefresh");
  const tableBody    = document.getElementById("tableBody");
  const tableInfo    = document.getElementById("tableInfo");

  /* utility: ‡∏î‡∏∂‡∏á field ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© */
  function getField(row, keys, fallback=""){
    if(!row) return fallback;
    for(const k of keys){
      if(row[k] !== undefined && row[k] !== null && row[k] !== ""){
        return row[k];
      }
    }
    return fallback;
  }

  /* ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage ‡πÄ‡∏õ‡πá‡∏ô fallback */
  function loadFromLocal(){
    try{
      const raw = localStorage.getItem("fa-db-data-gov");
      const arr = raw ? JSON.parse(raw) : [];
      rawData = Array.isArray(arr) ? arr : [];
    }catch(e){
      rawData = [];
    }
  }

  async function fetchCentralData(){
    try{
      const res = await fetch(API_URL + "?t=" + Date.now(), {cache:"no-store"});
      if(!res.ok) throw new Error("HTTP "+res.status);
      const data = await res.json();
      if(Array.isArray(data)) rawData = data;
      else if(Array.isArray(data.data)) rawData = data.data;
      else rawData = [];
      try{
        localStorage.setItem("fa-db-data-gov", JSON.stringify(rawData));
      }catch(e){}
      lastRefreshEl.textContent = new Date().toLocaleString("th-TH");
      console.log("[FA CashBoard] loaded from API:", rawData.length);
    }catch(e){
      console.warn("[FA CashBoard] API error, fallback localStorage", e);
      loadFromLocal();
      lastRefreshEl.textContent = "Offline ‚Äì ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å localStorage";
    }

    buildYearOptions();
    refreshAll();
  }

  /* filter helper */
  function getYear(row){
    return getField(row,["fiscalYear","year","‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì","‡∏õ‡∏µ"],"");
  }
  function getRegion(row){
    return getField(row,["region","‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ"],"");
  }

  function getFilteredData(){
    const y = yearFilter.value;
    const q = quarterFilter.value;
    const r = regionFilter.value;
    const kw= searchInput.value.trim().toLowerCase();

    return rawData.filter(row=>{
      const fy = String(getYear(row));
      const rg = String(getRegion(row));

      if(y && fy !== y) return false;
      if(r && rg !== r) return false;

      // quarter: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ field quarter ‡∏´‡∏£‡∏∑‡∏≠ fsMonth
      const fsQuarter = getField(row,["quarter","‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™"],"");
      const fsMonth   = getField(row,["fsMonth","‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"],"");
      if(q){
        if(fsQuarter){
          if(fsQuarter !== q) return false;
        }else if(fsMonth){
          const m = Number(fsMonth);
          const qGuess = m>=10 || m<=12 ? "Q1"
                       : m<=3  ? "Q2"
                       : m<=6  ? "Q3"
                               : "Q4";
          if(qGuess !== q) return false;
        }
      }

      if(kw){
        const code = String(getField(row,["code","‡∏£‡∏´‡∏±‡∏™"],"")).toLowerCase();
        const name = String(getField(row,["name","‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô","unit","‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à"],"")).toLowerCase();
        const prov = String(getField(row,["province","‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"],"")).toLowerCase();
        if(!code.includes(kw) && !name.includes(kw) && !prov.includes(kw)) return false;
      }
      return true;
    });
  }

  function buildYearOptions(){
    const years = new Set();
    rawData.forEach(r=>{
      const y = getYear(r);
      if(y) years.add(String(y));
    });
    // clear old (keep first option)
    [...yearFilter.options].slice(1).forEach(o=>o.remove());
    [...years].sort().forEach(y=>{
      const opt=document.createElement("option");
      opt.value=y;
      opt.textContent="‡∏õ‡∏µ‡∏á‡∏ö "+y;
      yearFilter.appendChild(opt);
    });
  }

  /* ========= KPI UPDATE ========= */
  function updateKPI(filtered){
    const total = filtered.length;

    // 1) Total units
    document.getElementById("kpiTotalUnitsValue").textContent =
      total.toLocaleString("th-TH");
    document.getElementById("kpiTotalUnitsFoot").textContent =
      `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏á: ${total.toLocaleString("th-TH")} ‡∏´‡∏ô‡πà‡∏ß‡∏¢`;

    // 2) FS closed vs others (fsStatus)
    let closed=0, notClosed=0, late=0, notSub=0;
    let unq=0, qual=0, adv=0, disc=0;
    let done=0;

    filtered.forEach(r=>{
      const st = getField(r,["fsStatus"],"");
      if(st==="closed") closed++;
      else if(st==="notClosed") notClosed++;
      else if(st==="late") late++;
      else if(st==="notSubmitted") notSub++;

      const op = getField(r,["fsOpinion"],"");
      if(op==="unqualified") unq++;
      else if(op==="qualified") qual++;
      else if(op==="adverse")   adv++;
      else if(op==="disclaimer")disc++;

      const step = getField(r,["progressStep"],"");
      if(step==="followUp" || step==="reportSent") done++;
    });

    const other = notClosed+late+notSub;
    const pctClosed = total>0 ? (closed*100/total):0;
    document.getElementById("kpiFsClosedValue").textContent =
      closed.toLocaleString("th-TH");
    document.getElementById("kpiFsClosedFoot").textContent =
      `‡∏õ‡∏¥‡∏î‡∏á‡∏ö‡πÅ‡∏•‡πâ‡∏ß ${closed.toLocaleString("th-TH")} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ (${pctClosed.toFixed(1)}% ‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)`;

    // 3) FS opinion ‚Äì unqualified
    const pctUnq = total>0 ? (unq*100/total):0;
    document.getElementById("kpiFsUnqValue").textContent =
      unq.toLocaleString("th-TH");
    document.getElementById("kpiFsUnqFoot").textContent =
      `Unqualified ${pctUnq.toFixed(1)}% | Qualified ${qual.toLocaleString("th-TH")} | Adverse ${adv.toLocaleString("th-TH")} | Disclaimer ${disc.toLocaleString("th-TH")}`;

    // 4) Audit progress
    const pctDone = total>0 ? (done*100/total):0;
    document.getElementById("kpiAuditDoneValue").textContent =
      pctDone.toFixed(1)+"%";
    document.getElementById("kpiAuditDoneFoot").textContent =
      `‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß ${done.toLocaleString("th-TH")} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏à‡∏≤‡∏Å ${total.toLocaleString("th-TH")} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ï‡∏≤‡∏° progressStep)`;
  }

  /* ========= CHARTS ========= */
  function updateCharts(filtered){
    const ctxType   = document.getElementById("chartType");
    const ctxStatus = document.getElementById("chartStatus");
    if(!ctxType || !ctxStatus || !window.Chart) return;

    // type distribution
    const typeMap = {};
    filtered.forEach(r=>{
      const t = getField(r,["type","‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"],"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏");
      typeMap[t]=(typeMap[t]||0)+1;
    });
    const typeLabels = Object.keys(typeMap);
    const typeValues = typeLabels.map(k=>typeMap[k]);

    if(chartType) chartType.destroy();
    chartType = new Chart(ctxType,{
      type:"bar",
      data:{
        labels:typeLabels,
        datasets:[{
          label:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢",
          data:typeValues
        }]
      },
      options:{
        plugins:{
          legend:{display:false},
          tooltip:{callbacks:{
            label:(ctx)=>{
              const v=ctx.raw||0;
              const sum=typeValues.reduce((a,b)=>a+b,0)||1;
              const pct=(v*100/sum).toFixed(1);
              return `${v.toLocaleString("th-TH")} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ (${pct}%)`;
            }
          }}
        },
        scales:{
          x:{ticks:{font:{size:10}}},
          y:{beginAtZero:true}
        }
      }
    });

    // status chart ‚Äì bar + line
    let closed=0, notClosed=0, late=0, notSub=0;
    let done=0;
    filtered.forEach(r=>{
      const st = getField(r,["fsStatus"],"");
      if(st==="closed") closed++;
      else if(st==="notClosed") notClosed++;
      else if(st==="late") late++;
      else if(st==="notSubmitted") notSub++;
      const step = getField(r,["progressStep"],"");
      if(step==="followUp" || step==="reportSent") done++;
    });

    const statusLabels = ["‡∏õ‡∏¥‡∏î‡∏á‡∏ö‡πÅ‡∏•‡πâ‡∏ß","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î","‡∏™‡πà‡∏á‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤","‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏á‡∏ö"];
    const barValues    = [closed,notClosed,late,notSub];
    const total = filtered.length||1;
    const donePct = (done*100/total).toFixed(1);
    const lineValues = statusLabels.map(()=>donePct);

    if(chartStatus) chartStatus.destroy();
    chartStatus = new Chart(ctxStatus,{
      data:{
        labels:statusLabels,
        datasets:[
          {
            type:"bar",
            label:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢",
            data:barValues
          },
          {
            type:"line",
            label:"% ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô",
            data:lineValues,
            yAxisID:"y1"
          }
        ]
      },
      options:{
        scales:{
          y:{beginAtZero:true,position:"left",title:{display:true,text:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢"}},
          y1:{beginAtZero:true,position:"right",title:{display:true,text:"% ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô"},ticks:{callback:v=>v+"%"}}
        }
      }
    });
  }

  /* ========= TABLE ========= */
  function renderTable(filtered){
    tableBody.innerHTML="";
    const total = filtered.length;
    const showArr = filtered.slice(0,300);

    showArr.forEach((row,idx)=>{
      const tr=document.createElement("tr");
      const code = getField(row,["code","‡∏£‡∏´‡∏±‡∏™"],"-");
      const name = getField(row,["name","‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô","unit","‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à"],"-");
      const type = getField(row,["type","‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"],"-");
      const prov = getField(row,["province","‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"],"-");
      const dist = getField(row,["district","‡∏≠‡∏≥‡πÄ‡∏†‡∏≠","‡πÄ‡∏Ç‡∏ï"],"-");
      const subd = getField(row,["subdistrict","‡∏ï‡∏≥‡∏ö‡∏•","‡πÅ‡∏Ç‡∏ß‡∏á"],"-");
      const fsStatus = getField(row,["fsStatus"],"");
      const progress = getField(row,["progressStep"],"");
      const website  = getField(row,["website","url"],"");
      const link     = getField(row,["detailUrl","link","‡∏•‡∏¥‡∏á‡∏Å‡πå"],"");

      tr.innerHTML = `
        <td>${idx+1}</td>
        <td class="col-code">${code}</td>
        <td>${name}</td>
        <td>${type}</td>
        <td>${prov}</td>
        <td>${dist}</td>
        <td>${subd}</td>
        <td>${fsStatus || "-"}</td>
        <td>${progress || "-"}</td>
        <td class="link-small">
          ${website ? `<a href="${website}" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö</a>` : "-"}
        </td>
        <td class="link-small">
          ${link ? `<a href="${link}" target="_blank">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>` : "-"}
        </td>
      `;
      tableBody.appendChild(tr);
    });

    tableInfo.textContent =
      `‡πÅ‡∏™‡∏î‡∏á ${showArr.length.toLocaleString("th-TH")} ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${total.toLocaleString("th-TH")} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
  }

  function refreshAll(){
    const filtered = getFilteredData();
    updateKPI(filtered);
    updateCharts(filtered);
    renderTable(filtered);
  }

  /* ========= INIT ========= */
  fetchCentralData();            // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å
  setInterval(fetchCentralData, 30000);  // real-time polling ‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

  yearFilter.addEventListener("change",refreshAll);
  quarterFilter.addEventListener("change",refreshAll);
  regionFilter.addEventListener("change",refreshAll);
  searchInput.addEventListener("input",refreshAll);
</script>

</body>
</html>