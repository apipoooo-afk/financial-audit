<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>FA ‚Äì LG Form 8.3 | ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ (Trade Receivables)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#060818;
      --bg-soft:#0b1024;
      --card:#11152b;
      --border:#262b46;
      --accent:#42a5f5;
      --accent2:#26c6da;
      --danger:#ef5350;
      --warning:#ffb74d;
      --success:#66bb6a;
      --muted:#a3acc7;
      --text:#f5f7ff;
      --pink:#f48fb1;
      --radius-lg:16px;
      --shadow-soft:0 10px 30px rgba(0,0,0,0.55);
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, sans-serif;
      background:
        radial-gradient(circle at 10% 0%, rgba(123,30,60,0.36) 0, transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(66,165,245,0.32) 0, transparent 55%),
        var(--bg);
      color:var(--text);
    }

    header{
      padding:14px 18px;
      background:linear-gradient(120deg,#7b1e3c,#0d47a1,#42a5f5);
      box-shadow:0 6px 22px rgba(0,0,0,0.55);
      position:sticky;
      top:0;
      z-index:20;
    }
    .header-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      flex-wrap:wrap;
      gap:10px;
    }
    header h1{
      margin:0;
      font-size:22px;
      font-weight:700;
    }
    header p{
      margin:2px 0 0;
      font-size:12px;
      color:var(--muted);
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.45);
      font-size:11px;
      margin-top:6px;
    }

    main{
      max-width:1320px;
      margin:0 auto 40px;
      padding:18px;
    }

    .layout{
      display:grid;
      grid-template-columns:2.1fr 1.3fr;
      gap:18px;
    }
    @media(max-width:960px){
      .layout{grid-template-columns:1fr;}
    }

    .card{
      background:var(--card);
      border-radius:var(--radius-lg);
      border:1px solid var(--border);
      box-shadow:var(--shadow-soft);
      padding:14px 14px 12px;
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:8px;
      margin-bottom:10px;
    }
    .card-title{
      font-size:16px;
      font-weight:600;
    }
    .card-sub{
      font-size:11px;
      color:var(--muted);
      margin-top:2px;
    }
    .chip{
      padding:3px 9px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(66,165,245,0.6);
      background:rgba(66,165,245,0.12);
      color:var(--accent2);
      white-space:nowrap;
    }

    label{
      font-size:12px;
      display:block;
      margin-bottom:3px;
    }
    .label-en{font-size:11px;color:var(--muted);}

    input[type="text"],
    input[type="number"],
    select,
    textarea{
      width:100%;
      padding:7px 9px;
      border-radius:10px;
      border:1px solid var(--border);
      background:var(--bg-soft);
      color:var(--text);
      font-family:inherit;
      font-size:13px;
      outline:none;
    }
    textarea{
      min-height:80px;
      resize:vertical;
    }
    input:focus, select:focus, textarea:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(66,165,245,0.7);
    }

    .row{display:flex;gap:10px;flex-wrap:wrap;}
    .col{flex:1 1 0;min-width:140px;}

    button{
      border:none;
      border-radius:999px;
      padding:6px 14px;
      font-size:13px;
      cursor:pointer;
      font-family:inherit;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-primary{
      background:linear-gradient(135deg,#0d47a1,#42a5f5);
      color:#fff;
    }
    .btn-ghost{
      background:transparent;
      color:var(--muted);
      border:1px solid var(--border);
    }
    .btn-danger{background:var(--danger);color:#fff;}
    .btn-success{background:var(--success);color:#fff;}
    .btn-warning{background:var(--warning);color:#111;}
    .btn-sm{padding:4px 10px;font-size:11px;}

    .section{
      margin-bottom:12px;
      padding:10px;
      border-radius:12px;
      border:1px dashed var(--border);
      background:rgba(6,8,24,0.65);
    }
    .section-title{
      font-size:13px;
      font-weight:600;
      margin-bottom:3px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    .section-sub{
      font-size:11px;
      color:var(--muted);
      margin-bottom:6px;
    }

    .attachment-list{
      margin-top:4px;
      font-size:11px;
      background:rgba(0,0,0,0.23);
      border-radius:8px;
      border:1px solid var(--border);
      max-height:120px;
      overflow:auto;
      padding:5px 7px;
    }
    .attachment-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      padding:2px 0;
    }
    .attachment-name{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .validation-panel{
      font-size:12px;
      padding:8px;
      border-radius:10px;
      background:rgba(6,8,24,0.9);
      border:1px solid var(--border);
      max-height:220px;
      overflow:auto;
    }
    .validation-item{
      display:flex;
      gap:6px;
      align-items:flex-start;
      margin-bottom:4px;
    }

    .checklist{
      font-size:12px;
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-top:4px;
    }
    .checklist label{
      display:flex;
      align-items:flex-start;
      gap:5px;
      cursor:pointer;
      margin-bottom:0;
    }
    .checklist input[type="checkbox"]{margin-top:2px;}

    .status-tag{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,0.2);
    }
    .status-tag.ok{border-color:var(--success);color:var(--success);}
    .status-tag.warn{border-color:var(--warning);color:var(--warning);}
    .status-tag.err{border-color:var(--danger);color:var(--danger);}

    .pill{
      font-size:11px;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(244,143,177,0.65);
      background:rgba(244,143,177,0.15);
    }

    .system-list{
      margin-top:6px;
      font-size:12px;
      border-radius:10px;
      border:1px solid var(--border);
      background:rgba(6,8,24,0.9);
      max-height:150px;
      overflow:auto;
    }
    .system-item{
      padding:6px 8px;
      border-bottom:1px solid rgba(255,255,255,0.04);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    .system-item:last-child{border-bottom:none;}

    .export-row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:6px;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.65);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:50;
    }
    .modal{
      background:var(--card);
      border-radius:16px;
      border:1px solid var(--border);
      padding:16px 14px 12px;
      max-width:420px;
      width:100%;
      box-shadow:var(--shadow-soft);
    }
    .modal-title{
      font-size:15px;
      font-weight:600;
      margin-bottom:4px;
    }
    .modal-body{
      font-size:13px;
      color:var(--muted);
      margin-bottom:8px;
    }
    .modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      margin-top:4px;
    }

    footer{
      margin-top:14px;
      font-size:11px;
      color:var(--muted);
      text-align:right;
    }
  </style>
</head>
<body>

<header>
  <div class="header-row">
    <div>
      <h1>‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó. 8.3 ‚Äì ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ (Trade Receivables)</h1>
      <p>
        Digital LG Financial Audit | Working Paper 8.3 ‚Äì Trade AR Main Form
      </p>
      <div class="badge">
        üîó Fieldwork ¬∑ Notes (2Y) ¬∑ Review ¬∑ DB ¬∑ Cashboard
      </div>
    </div>

    <div style="text-align:right; min-width:220px;">
      <div style="margin-bottom:6px;">
        <button class="btn-ghost btn-sm" onclick="window.location.href='fa-lg-fieldwork.html'">
          ‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö Fieldwork
        </button>
      </div>
      <div id="globalStatusTag" class="status-tag warn">
        ‚è≥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏ó‡∏≥ (In progress)
      </div>
      <div style="font-size:11px; margin-top:4px;">
        ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à: <span id="unitNameLabel">-</span><br/>
        ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: <span id="fiscalYearLabel">-</span>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="layout">

    <!-- LEFT: MAIN FORM -->
    <div>

      <!-- A. CONTEXT & LOAD -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">A. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / Load Data</div>
            <div class="card-sub">
              ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ
            </div>
          </div>
          <span class="chip">Context & Source</span>
        </div>

        <div class="row" style="margin-bottom:8px;">
          <div class="col">
            <label>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <span class="label-en">(Fiscal Year)</span></label>
            <input type="number" id="fiscalYear" placeholder="2568" />
          </div>
          <div class="col">
            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à <span class="label-en">(Entity)</span></label>
            <input type="text" id="unitName" placeholder="‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (Province)</label>
            <input type="text" id="province" placeholder="‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©" />
          </div>
          <div class="col">
            <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ (District)</label>
            <input type="text" id="district" placeholder="‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©" />
          </div>
        </div>

        <div class="row" style="margin-top:8px; align-items:center;">
          <div class="col">
            <button class="btn-primary" id="btnLoadFromDb">
              üì• ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
          </div>
          <div class="col" style="font-size:11px; color:var(--muted);">
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ
          </div>
        </div>
      </div>

      <!-- B. TRADE AR DETAILS -->
      <div class="card" style="margin-top:14px;">
        <div class="card-header">
          <div>
            <div class="card-title">B. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ (Trade AR)</div>
            <div class="card-sub">
              ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó.8.3 ‚Äì ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‚Äì ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏Å
            </div>
          </div>
          <span class="chip">Trade AR Main Form</span>
        </div>

        <!-- 1) Overview -->
        <div class="section">
          <div class="section-title">
            <span>1) ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ (Overview)</span>
            <button class="btn-sm btn-ghost" data-ai-target="arOverview">
              ü§ñ AI Draft
            </button>
          </div>
          <div class="section-sub">
            ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‡∏¢‡∏≠‡∏î‡∏ï‡πâ‡∏ô‡∏á‡∏ß‡∏î ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏µ ‡∏¢‡∏≠‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡∏á‡∏ß‡∏î ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà ‡∏Ø‡∏•‡∏Ø
          </div>
          <textarea id="arOverview"
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏Ø‡∏•‡∏Ø..."></textarea>

          <div style="margin-top:6px;">
            <label style="font-size:11px;">‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Attachments)</label>
            <div class="row" style="margin-bottom:4px;">
              <div class="col">
                <input type="file" id="fileOverview" />
              </div>
              <div class="col" style="text-align:right;">
                <button class="btn-sm btn-ghost" onclick="addAttachment('overview')">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå</button>
              </div>
            </div>
            <div class="attachment-list" id="attachments-overview"></div>
          </div>
        </div>

        <!-- 2) Ageing -->
        <div class="section">
          <div class="section-title">
            <span>2) ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏¢‡∏∏‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ (Ageing Analysis)</span>
            <button class="btn-sm btn-ghost" data-ai-target="arAgeing">
              ü§ñ AI Draft
            </button>
          </div>
          <div class="section-sub">
            ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏¢‡∏∏‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ ‡πÅ‡∏¢‡∏Å‡∏ä‡πà‡∏ß‡∏á (0‚Äì30, 31‚Äì60, 61‚Äì90, ‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡∏õ‡∏µ) ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö
          </div>
          <textarea id="arAgeing"
            placeholder="‡∏•‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ô‡∏≤‡∏ô ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á ‡∏Ø‡∏•‡∏Ø..."></textarea>

          <div style="margin-top:6px;">
            <label style="font-size:11px;">‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Attachments)</label>
            <div class="row" style="margin-bottom:4px;">
              <div class="col">
                <input type="file" id="fileAgeing" />
              </div>
              <div class="col" style="text-align:right;">
                <button class="btn-sm btn-ghost" onclick="addAttachment('ageing')">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå</button>
              </div>
            </div>
            <div class="attachment-list" id="attachments-ageing"></div>
          </div>
        </div>

        <!-- 3) Collection & Confirm -->
        <div class="section">
          <div class="section-title">
            <span>3) ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ó‡∏ß‡∏á‡∏ñ‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î (Collection & Confirmation)</span>
            <button class="btn-sm btn-ghost" data-ai-target="arCollection">
              ü§ñ AI Draft
            </button>
          </div>
          <div class="section-sub">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ó‡∏ß‡∏á‡∏ñ‡∏≤‡∏° ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏ß‡∏á‡∏ñ‡∏≤‡∏° ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î ‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
          </div>
          <textarea id="arCollection"
            placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏ß‡∏á‡∏ñ‡∏≤‡∏° ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ ‡∏Ø‡∏•‡∏Ø..."></textarea>

          <div style="margin-top:6px;">
            <label style="font-size:11px;">‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Attachments)</label>
            <div class="row" style="margin-bottom:4px;">
              <div class="col">
                <input type="file" id="fileCollection" />
              </div>
              <div class="col" style="text-align:right;">
                <button class="btn-sm btn-ghost" onclick="addAttachment('collection')">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå</button>
              </div>
            </div>
            <div class="attachment-list" id="attachments-collection"></div>
          </div>
        </div>

        <!-- 4) Allowance & Conclusion -->
        <div class="section">
          <div class="section-title">
            <span>4) ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏à‡∏∞‡∏™‡∏π‡∏ç ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
            <button class="btn-sm btn-ghost" data-ai-target="arAllowanceConclusion">
              ü§ñ AI Draft
            </button>
          </div>
          <div class="section-sub">
            ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏à‡∏∞‡∏™‡∏π‡∏ç ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏Ç‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô
          </div>
          <textarea id="arAllowanceConclusion"
            placeholder="‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏à‡∏∞‡∏™‡∏π‡∏ç ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ ‡∏Ø‡∏•‡∏Ø..."></textarea>

          <div style="margin-top:6px;">
            <label style="font-size:11px;">‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (Attachments)</label>
            <div class="row" style="margin-bottom:4px;">
              <div class="col">
                <input type="file" id="fileAllowance" />
              </div>
              <div class="col" style="text-align:right;">
                <button class="btn-sm btn-ghost" onclick="addAttachment('allowance')">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå</button>
              </div>
            </div>
            <div class="attachment-list" id="attachments-allowance"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: AI, VALIDATION, ROUTING -->
    <div>

      <!-- C. AI & PROOFREAD -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">C. AI Assist & Proofreading</div>
            <div class="card-sub">
              ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
            </div>
          </div>
          <span class="chip">Quality Check</span>
        </div>

        <div class="row" style="margin-bottom:8px;">
          <button class="btn-primary" id="btnRunProofread">
            ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
          </button>
          <button class="btn-ghost btn-sm" id="btnClearIssues">
            üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï
          </button>
        </div>

        <div id="validationPanel" class="validation-panel">
          <div class="validation-item">
            <span>‚ÑπÔ∏è</span>
            <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‚Äì ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</span>
          </div>
        </div>
      </div>

      <!-- D. CHECKLIST & COMPLETION -->
      <div class="card" style="margin-top:14px;">
        <div class="card-header">
          <div>
            <div class="card-title">D. Checklist & Completion</div>
            <div class="card-sub">
              ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ ‡∏≠‡∏õ‡∏ó.8.3 ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠
            </div>
          </div>
          <span class="chip">Completion</span>
        </div>

        <div class="checklist">
          <label><input type="checkbox" id="chkDetailsComplete" /> ‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß</label>
          <label><input type="checkbox" id="chkDocsAttached" /> ‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß</label>
          <label><input type="checkbox" id="chkConclusionReady" /> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</label>
          <label><input type="checkbox" id="chkProofreadDone" /> ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÅ‡∏•‡πâ‡∏ß</label>
        </div>

        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn-success" id="btnConfirmComplete">
            ‚úîÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
          </button>
          <button class="btn-warning" id="btnPrint" disabled>
            üñ®Ô∏è ‡∏õ‡∏£‡∏¥‡πâ‡∏ô
          </button>
          <button class="btn-primary" id="btnSubmit" disabled>
            üì§ ‡∏™‡πà‡∏á
          </button>
        </div>

        <div style="font-size:11px; color:var(--muted); margin-top:6px;">
          ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ Export / ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô
        </div>
      </div>

      <!-- E. WARNING & EXPERT -->
      <div class="card" style="margin-top:14px;">
        <div class="card-header">
          <div>
            <div class="card-title">E. Warning & Expert Consultation</div>
            <div class="card-sub">
              ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ú‡∏¥‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ô‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç
            </div>
          </div>
          <span class="chip">Governance</span>
        </div>

        <div style="font-size:12px; margin-bottom:6px;">
          ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î/‡∏Å‡∏≤‡∏£‡∏ù‡πà‡∏≤‡∏ù‡∏∑‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:
          <span id="errorCounterPill" class="pill">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
        </div>

        <button class="btn-ghost" id="btnConsultExpert">
          üë®‚Äçüíº ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
        </button>

        <div style="font-size:11px; color:var(--muted); margin-top:6px;">
          ‡∏´‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ã‡πâ‡∏≥ ‚â• 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏à‡∏∞‡πÄ‡∏™‡∏ô‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        </div>
      </div>

      <!-- F. ROUTING & EXPORT -->
      <div class="card" style="margin-top:14px;">
        <div class="card-header">
          <div>
            <div class="card-title">F. Routing & Export</div>
            <div class="card-sub">
              ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Fieldwork / Notes / Review / DB / Cashboard ‡πÅ‡∏•‡∏∞ Export
            </div>
          </div>
          <span class="chip">Integration</span>
        </div>

        <div class="section">
          <div class="section-title">
            <span>1) ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô</span>
          </div>
          <div class="section-sub">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡πÄ‡∏ä‡πà‡∏ô Fieldwork, ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô 2 ‡∏õ‡∏µ, ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Ø‡∏•‡∏Ø
          </div>

          <input type="text" id="systemSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á..." />
          <div id="systemList" class="system-list"></div>
        </div>

        <div class="section">
          <div class="section-title">
            <span>2) Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
          </div>
          <div class="section-sub">
            ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£
          </div>

          <div class="export-row">
            <select id="exportFormat">
              <option value="pdf">PDF ‚Äì Official</option>
              <option value="docx">DOCX ‚Äì Word</option>
              <option value="xlsx">XLSX ‚Äì Excel</option>
              <option value="html">HTML ‚Äì Web</option>
              <option value="json">JSON ‚Äì Raw Data</option>
            </select>
            <button class="btn-primary btn-sm" id="btnExport">
              ‚¨áÔ∏è Export
            </button>
          </div>
          <div style="font-size:11px; color:var(--muted); margin-top:6px;">
            ‡∏ù‡∏±‡πà‡∏á backend ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ payload ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
          </div>
        </div>

        <footer>
          FA ‚Äì LG 8.3 Trade AR | OAG Sisaket Group 4
        </footer>
      </div>
    </div>
  </div>
</main>

<!-- Modal: Expert Consult -->
<div id="expertModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-title">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</div>
    <div class="modal-body">
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ú‡∏¥‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô / ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö / ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ã‡πâ‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á<br><br>
      ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
    </div>
    <div class="modal-actions">
      <button class="btn-ghost btn-sm" id="btnConsultNo">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</button>
      <button class="btn-primary btn-sm" id="btnConsultYes">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</button>
    </div>
  </div>
</div>

<script>
  // ---------------- GLOBAL STATE ----------------
  const state = {
    validationIssues: [],
    errorCount: 0,
    isCompleted: false,
    systems: [
      { key:'fieldwork', label:'Fieldwork ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏°', href:'fa-lg-fieldwork.html' },
      { key:'notes', label:'Notes 2Y ‚Äì ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô 2 ‡∏õ‡∏µ', href:'fa-lg-notes-2y.html' },
      { key:'review', label:'Review ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô FA', href:'fa-review-menu.html' },
      { key:'db', label:'Database ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á', href:'fa-db-data-gov.html' },
      { key:'cashboard', label:'Cashboard ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', href:'fa-cashboard.html' }
    ]
  };

  function registerProcessError(reason){
    state.errorCount += 1;
    const pill = document.getElementById('errorCounterPill');
    pill.textContent = state.errorCount + ' ‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
    if(state.errorCount >= 3){
      document.getElementById('expertModal').style.display = 'flex';
    }
    console.warn('Process issue:', reason);
  }

  // --------------- LOAD FROM DB (Mock) ---------------
  document.getElementById('btnLoadFromDb').addEventListener('click', () => {
    const fy = document.getElementById('fiscalYear').value || '2568';
    const unit = document.getElementById('unitName').value || '‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©';

    document.getElementById('fiscalYearLabel').textContent = fy;
    document.getElementById('unitNameLabel').textContent = unit;

    document.getElementById('arOverview').value =
      `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á: ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á ${unit} ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${fy} `;
    document.getElementById('arAgeing').value =
      'Ageing ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö: 0‚Äì30, 31‚Äì60, 61‚Äì90, >1 ‡∏õ‡∏µ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á...';
    document.getElementById('arCollection').value =
      '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏ß‡∏á‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏ß‡∏á‡∏ñ‡∏≤‡∏° ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡∏Ø‡∏•‡∏Ø...';
    document.getElementById('arAllowanceConclusion').value =
      '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏à‡∏∞‡∏™‡∏π‡∏ç‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö: ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ...';

    autoAttachFromDb('overview', 'DB-AR-Summary.xlsx');
    autoAttachFromDb('ageing', 'DB-AR-Ageing-Detail.xlsx');
    autoAttachFromDb('collection', 'DB-AR-Collection-Status.pdf');
    autoAttachFromDb('allowance', 'DB-AR-Allowance-Working.xlsx');
  });

  function autoAttachFromDb(sectionKey, fileName){
    const container = document.getElementById('attachments-' + sectionKey);
    if(!container) return;
    const div = document.createElement('div');
    div.className = 'attachment-item';
    div.innerHTML = `
      <span class="attachment-name">üìé [‡∏£‡∏∞‡∏ö‡∏ö] ${fileName}</span>
      <button class="btn-sm btn-ghost" onclick="this.parentElement.remove()">‡∏•‡∏ö</button>
    `;
    container.appendChild(div);
  }

  // --------------- ATTACHMENTS ----------------
  function addAttachment(sectionKey){
    const inputId =
      sectionKey === 'overview' ? 'fileOverview' :
      sectionKey === 'ageing' ? 'fileAgeing' :
      sectionKey === 'collection' ? 'fileCollection' :
      sectionKey === 'allowance' ? 'fileAllowance' : null;

    if(!inputId) return;
    const fileInput = document.getElementById(inputId);
    if(!fileInput || !fileInput.files || !fileInput.files.length){
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô');
      return;
    }
    const file = fileInput.files[0];
    const container = document.getElementById('attachments-' + sectionKey);
    const div = document.createElement('div');
    div.className = 'attachment-item';
    div.innerHTML = `
      <span class="attachment-name">üìé ${file.name}</span>
      <button class="btn-sm btn-ghost" onclick="this.parentElement.remove()">‡∏•‡∏ö</button>
    `;
    container.appendChild(div);
    fileInput.value = '';
  }
  window.addAttachment = addAttachment;

  // --------------- AI DRAFT (Mock) ---------------
  document.querySelectorAll('[data-ai-target]').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.getAttribute('data-ai-target');
      const el = document.getElementById(targetId);
      if(!el) return;
      const cur = el.value.trim();
      const draft = '[AI Draft] ‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö AI ‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πá‡∏à‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö.';
      el.value = cur ? (cur + '\n\n' + draft) : draft;
    });
  });

  // --------------- PROOFREAD / VALIDATION ---------------
  document.getElementById('btnRunProofread').addEventListener('click', () => {
    const issues = [];

    function checkRequired(id, label){
      const v = (document.getElementById(id).value || '').trim();
      if(!v){
        issues.push({type:'error', msg:'‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å: ' + label});
      }else if(v.length < 20){
        issues.push({type:'warn', msg:`‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô "${label}" ‡∏≠‡∏≤‡∏à‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ`});
      }
    }

    checkRequired('arOverview', '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤');
    checkRequired('arAgeing', '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏¢‡∏∏‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ');
    checkRequired('arCollection', '‡∏Å‡∏≤‡∏£‡∏ó‡∏ß‡∏á‡∏ñ‡∏≤‡∏°/‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î');
    checkRequired('arAllowanceConclusion', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏à‡∏∞‡∏™‡∏π‡∏ç‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏™‡∏£‡∏∏‡∏õ');

    const allowance = (document.getElementById('arAllowanceConclusion').value || '').trim();
    if(allowance && !allowance.match(/‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏à‡∏∞‡∏™‡∏π‡∏ç|allowance/i)){
      issues.push({
        type:'warn',
        msg:'‡∏Ç‡πâ‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ‚Äú‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏à‡∏∞‡∏™‡∏π‡∏ç / allowance‚Äù ‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ñ‡∏∂‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô'
      });
    }

    state.validationIssues = issues;
    renderValidationPanel();

    if(issues.length){
      registerProcessError('Validation issues found');
      setStatus('err','‚ö† ‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Issues detected)');
    }else{
      setStatus('ok','‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (Validated)');
    }
  });

  document.getElementById('btnClearIssues').addEventListener('click', () => {
    state.validationIssues = [];
    renderValidationPanel();
  });

  function renderValidationPanel(){
    const panel = document.getElementById('validationPanel');
    panel.innerHTML = '';
    if(!state.validationIssues.length){
      const div = document.createElement('div');
      div.className = 'validation-item';
      div.innerHTML = '<span>‚úÖ</span><span>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>';
      panel.appendChild(div);
      return;
    }
    state.validationIssues.forEach(issue => {
      const div = document.createElement('div');
      div.className = 'validation-item';
      const icon = issue.type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
      div.innerHTML = `<span>${icon}</span><span>${issue.msg}</span>`;
      panel.appendChild(div);
    });
  }

  function setStatus(type, text){
    const tag = document.getElementById('globalStatusTag');
    tag.className = 'status-tag ' + (type || '');
    tag.textContent = text;
  }

  // --------------- CHECKLIST & COMPLETION ---------------
  document.getElementById('btnConfirmComplete').addEventListener('click', () => {
    const a = document.getElementById('chkDetailsComplete').checked;
    const b = document.getElementById('chkDocsAttached').checked;
    const c = document.getElementById('chkConclusionReady').checked;
    const d = document.getElementById('chkProofreadDone').checked;

    if(!(a && b && c && d)){
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡πä‡∏Å Checklist ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 4 ‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô');
      registerProcessError('Confirm without checklist');
      return;
    }
    if(state.validationIssues.length){
      const ok = confirm('‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¢‡∏π‡πà ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');
      if(!ok){
        registerProcessError('Decline completion due to issues');
        return;
      }
    }

    state.isCompleted = true;
    document.getElementById('btnPrint').disabled = false;
    document.getElementById('btnSubmit').disabled = false;
    setStatus('ok','‚úÖ ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á (Completed & Ready)');
    alert('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó.8.3 ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
  });

  document.getElementById('btnPrint').addEventListener('click', () => {
    if(!state.isCompleted){
      alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‚Äì ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÑ‡∏î‡πâ');
      registerProcessError('Print before completion');
      return;
    }
    window.print();
  });

  document.getElementById('btnSubmit').addEventListener('click', () => {
    if(!state.isCompleted){
      alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‚Äì ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ');
      registerProcessError('Submit before completion');
      return;
    }
    // TODO: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° backend ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏£‡∏¥‡∏á
    alert('‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (Mock Submit)');
  });

  // --------------- EXPERT CONSULT ---------------
  document.getElementById('btnConsultExpert').addEventListener('click', () => {
    document.getElementById('expertModal').style.display = 'flex';
  });
  document.getElementById('btnConsultNo').addEventListener('click', () => {
    document.getElementById('expertModal').style.display = 'none';
  });
  document.getElementById('btnConsultYes').addEventListener('click', () => {
    document.getElementById('expertModal').style.display = 'none';
    alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á/‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏ô‡πâ‡∏≤ consult, Line OA, Email).');
  });

  // --------------- ROUTING ---------------
  function renderSystemList(){
    const list = document.getElementById('systemList');
    const kw = (document.getElementById('systemSearch').value || '').toLowerCase();
    list.innerHTML = '';
    state.systems
      .filter(s => !kw || s.label.toLowerCase().includes(kw))
      .forEach(s => {
        const div = document.createElement('div');
        div.className = 'system-item';
        div.innerHTML = `
          <span>${s.label}</span>
          <button class="btn-sm btn-primary" data-href="${s.href}">‡πÑ‡∏õ</button>
        `;
        list.appendChild(div);
      });

    list.querySelectorAll('button[data-href]').forEach(btn => {
      btn.addEventListener('click', () => {
        const href = btn.getAttribute('data-href');
        goToSystem(href);
      });
    });
  }
  document.getElementById('systemSearch').addEventListener('input', renderSystemList);

  function goToSystem(href){
    if(!state.isCompleted){
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó.8.3 ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô 2 ‡∏õ‡∏µ).');
      registerProcessError('Route before completion');
      return;
    }
    // ‡∏™‡πà‡∏á payload ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Notes (2Y) ‡∏ú‡πà‡∏≤‡∏ô localStorage ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏ì‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
    if(href.indexOf('fa-lg-notes-2y.html') !== -1){
      try{
        const payload = collectReportData();
        localStorage.setItem('fa_lg_8_3_payload', JSON.stringify(payload));
      }catch(e){
        console.warn('Failed to save payload to localStorage', e);
      }
    }
    window.location.href = href;
  }

  // --------------- EXPORT ---------------
  document.getElementById('btnExport').addEventListener('click', () => {
    if(!state.isCompleted){
      const ok = confirm('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Export ‡πÅ‡∏ö‡∏ö Draft ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');
      if(!ok){
        registerProcessError('Cancel export before completion');
        return;
      }
    }
    const fmt = document.getElementById('exportFormat').value;
    const payload = collectReportData();
    console.log('Export format:', fmt, 'payload:', payload);
    alert('Export ‡πÅ‡∏ö‡∏ö ' + fmt + ' (‡∏î‡∏π payload ‡πÉ‡∏ô console ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° backend ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ)');
  });

  function collectReportData(){
    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ payload ‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡πÑ‡∏õ backend ‡∏´‡∏£‡∏∑‡∏≠ Notes
    return {
      formCode: '‡∏≠‡∏õ‡∏ó.8.3',
      formName: '‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‚Äì ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏Å',
      fiscalYear: document.getElementById('fiscalYear').value || null,
      unitName: document.getElementById('unitName').value || null,
      province: document.getElementById('province').value || null,
      district: document.getElementById('district').value || null,
      sections: {
        overview: document.getElementById('arOverview').value || '',
        ageing: document.getElementById('arAgeing').value || '',
        collection: document.getElementById('arCollection').value || '',
        allowanceConclusion: document.getElementById('arAllowanceConclusion').value || ''
      },
      checklist: {
        detailsComplete: document.getElementById('chkDetailsComplete').checked,
        docsAttached: document.getElementById('chkDocsAttached').checked,
        conclusionReady: document.getElementById('chkConclusionReady').checked,
        proofreadDone: document.getElementById('chkProofreadDone').checked
      },
      validationIssues: state.validationIssues,
      isCompleted: state.isCompleted,
      errorCount: state.errorCount
    };
  }

  // --------------- INIT ---------------
  renderSystemList();
</script>
</body>
</html>
