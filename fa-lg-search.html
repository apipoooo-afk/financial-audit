<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>FA DB | ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  :root{
    --bg:#060818;
    --card:#11152b;
    --border:#262b46;
    --accent:#42a5f5;
    --accent2:#26c6da;
    --muted:#a3acc7;
    --text:#f5f7ff;
    --success:#22c55e;
  }
  *{box-sizing:border-box;}

  body{
    margin:0;
    font-family:"Segoe UI", Tahoma, sans-serif;
    background:var(--bg);
    color:var(--text);
  }

  header{
    padding:18px 12px;
    text-align:center;
    background:linear-gradient(120deg,#0d47a1,#6f42c1,#26c6da);
    box-shadow:0 4px 16px rgba(0,0,0,.7);
  }
  header h1{margin:0;font-size:22px;font-weight:800;}
  header p{margin:4px 0 0;font-size:13px;color:var(--muted);}

  .wrap{
    max-width:1200px;
    margin:20px auto;
    padding:0 16px;
  }

  .card{
    background:var(--card);
    border-radius:16px;
    border:1px solid rgba(255,255,255,.15);
    padding:15px 16px;
    margin-bottom:18px;
    box-shadow:0 8px 24px rgba(0,0,0,.65);
  }

  h2{
    margin:0 0 10px;
    font-size:18px;
    font-weight:700;
  }

  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:10px 12px;
  }

  input,select{
    width:100%;
    padding:8px;
    border-radius:8px;
    background:#05081a;
    border:1px solid #374151;
    font-size:13px;
    color:var(--text);
  }

  input:focus,select:focus{
    outline:none;
    border-color:var(--accent2);
  }

  .btn-row{
    margin-top:10px;
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }

  button{
    border:none;
    padding:9px 14px;
    border-radius:999px;
    cursor:pointer;
    font-size:13px;
  }

  .btn-primary{background:var(--success);color:#0f2015;font-weight:700;}
  .btn-secondary{background:#374151;color:#e5e7eb;}
  .btn-danger{background:#b91c1c;color:#fff;}

  table{
    width:100%;border-collapse:collapse;font-size:12px;margin-top:8px;
  }
  th,td{
    border:1px solid #374151;
    padding:6px 6px;
  }
  th{background:#020617;}
  tr:nth-child(even){background:#111827;}

  .link-btn{
    display:inline-block;
    padding:3px 7px;
    font-size:11px;
    border-radius:999px;
    color:#e0f2fe;
    border:1px solid #38bdf8;
    text-decoration:none;
  }
  .link-btn:hover{
    background:#38bdf8;
    color:#0d1b2a;
  }

  .nav{
    margin-right:10px;
    color:#e0e7ff;
    text-decoration:none;
    background:#374151;
    padding:8px 14px;
    border-radius:999px;
    font-size:13px;
  }

  .stat{
    font-size:13px;
    color:var(--muted);
    margin-top:4px;
  }
</style>

</head>
<body>

<header>
  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó.</h1>
  <p>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á fa-db-data-gov (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö)</p>
</header>

<div class="wrap">

  <!-- ‡πÄ‡∏ß‡∏•‡∏≤ -->
  <div style="margin-bottom:10px;font-size:13px;color:var(--muted);">
    ‚è± ‡πÄ‡∏ß‡∏•‡∏≤: <span id="clock">-</span>
  </div>

  <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <div class="card">
    <h2>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>

    <div class="grid">
      <div>
        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / ‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏õ‡∏ó.</label>
        <input id="q-unit" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à">
      </div>

      <div>
        <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
        <select id="q-province">
          <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option>
        </select>
      </div>

      <div>
        <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï</label>
        <input id="q-district" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≥‡πÄ‡∏†‡∏≠">
      </div>

      <div>
        <label>‡∏ï‡∏≥‡∏ö‡∏• / ‡πÅ‡∏Ç‡∏ß‡∏á</label>
        <input id="q-subdistrict" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡∏ö‡∏•">
      </div>

      <div>
        <label>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô / ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</label>
        <input id="q-village" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô">
      </div>

      <div>
        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó.</label>
        <input id="q-type" placeholder="‡∏≠‡∏ö‡∏ï./‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•/‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á...">
      </div>
    </div>

    <div class="btn-row">
      <button class="btn-primary" id="btnSearch">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
      <button class="btn-secondary" id="btnShowAll">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <button class="btn-secondary" id="btnClear">‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</button>
      <button class="btn-secondary" id="btnExport">üì§ Export CSV</button>
    </div>

    <div class="stat" id="searchStat">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
  <div class="card">
    <h2>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>‡∏£‡∏´‡∏±‡∏™</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
          <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</th>
          <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
          <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
          <th>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</th>
          <th>‡∏ï‡∏≥‡∏ö‡∏•</th>
          <th>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</th>
          <th>‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</th>
          <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
        </tr>
      </thead>
      <tbody id="dataBody"></tbody>
    </table>
  </div>

  <a href="fa-db-local.html" class="nav">‚¨Ö ‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
  <a href="fa-db-data-gov.html" class="nav">üìä ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á</a>

</div>

<script>
/* ===== CLOCK ===== */
function updateClock(){
  document.getElementById("clock").textContent =
    new Date().toLocaleString("th-TH");
}
setInterval(updateClock,1000); updateClock();

/* ===== LOAD DB ===== */
const KEY = "fa-db-data-gov";
let DB = [];

function loadDB(){
  DB = JSON.parse(localStorage.getItem(KEY) || "[]");
}

/* ===== RENDER TABLE ===== */
function renderTable(rows){
  const tb = document.getElementById("dataBody");
  tb.innerHTML = "";

  if(rows.length === 0){
    tb.innerHTML = `<tr><td colspan="11" style="text-align:center;color:#9ca3af;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
    return;
  }

  rows.forEach((r,i)=>{
    const tr = document.createElement("tr");
    const detail = "fa-lg-view.html?code=" + encodeURIComponent(r.code||"");

    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${r.code||""}</td>
      <td>${r.name||""}</td>
      <td>${r.unit||r.name||""}</td>
      <td>${r.type||""}</td>
      <td>${r.province||""}</td>
      <td>${r.district||""}</td>
      <td>${r.subdistrict||""}</td>
      <td>${r.village||""}</td>
      <td>${r.website ? `<a href="${r.website}" target="_blank" class="link-btn">‡πÄ‡∏õ‡∏¥‡∏î</a>` : ""}</td>
      <td><a href="${detail}" class="link-btn">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a></td>
    `;
    tb.appendChild(tr);
  });
}

/* ===== SEARCH ===== */
function normalize(t){return (t||"").toLowerCase().trim();}

function doSearch(showAll=false){
  let result = DB;

  if(!showAll){
    const qUnit  = normalize(document.getElementById("q-unit").value);
    const qProv  = document.getElementById("q-province").value.trim();
    const qDist  = normalize(document.getElementById("q-district").value);
    const qSub   = normalize(document.getElementById("q-subdistrict").value);
    const qVill  = normalize(document.getElementById("q-village").value);
    const qType  = normalize(document.getElementById("q-type").value);

    if(qUnit){
      result = result.filter(r=>
        normalize(r.unit).includes(qUnit) ||
        normalize(r.name).includes(qUnit)
      );
    }
    if(qProv){ result = result.filter(r=> (r.province||"") === qProv); }
    if(qDist){ result = result.filter(r=> normalize(r.district).includes(qDist)); }
    if(qSub){ result = result.filter(r=> normalize(r.subdistrict).includes(qSub)); }
    if(qVill){ result = result.filter(r=> normalize(r.village).includes(qVill)); }
    if(qType){ result = result.filter(r=> normalize(r.type).includes(qType)); }
  }

  renderTable(result);
  document.getElementById("searchStat").textContent =
    `‡∏û‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${result.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
}

/* ===== FILL PROVINCE SELECT (‡∏à‡∏≤‡∏Å DB ‡∏à‡∏£‡∏¥‡∏á) ===== */
function fillProvinces(){
  const all = DB;
  const sel = document.getElementById("q-province");
  const provs = new Set();
  all.forEach(r=>{ if(r.province) provs.add(r.province); });

  [...provs].sort().forEach(p=>{
    const o = document.createElement("option");
    o.value = p;
    o.textContent = p;
    sel.appendChild(o);
  });
}

/* ===== EXPORT CSV ===== */
function exportCSV(){
  const rows = DB;
  if(rows.length===0){ alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"); return; }

  const header = ["code","name","unit","type","province","district","subdistrict","village","website"];
  const lines = [header.join(",")];

  rows.forEach(r=>{
    const row = header.map(k=>{
      const v = (r[k]||"").toString().replace(/"/g,'""');
      return `"${v}"`;
    });
    lines.push(row.join(","));
  });

  const blob = new Blob([lines.join("\r\n")],{type:"text/csv;charset=utf-8;"});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement("a");
  a.href = url;
  a.download = "fa-lg-search-export.csv";
  a.click();
  URL.revokeObjectURL(url);
}

/* ===== CLEAR ===== */
function clearForm(){
  document.getElementById("q-unit").value = "";
  document.getElementById("q-province").value = "";
  document.getElementById("q-district").value = "";
  document.getElementById("q-subdistrict").value = "";
  document.getElementById("q-village").value = "";
  document.getElementById("q-type").value = "";
  document.getElementById("searchStat").textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤";
  document.getElementById("dataBody").innerHTML = "";
}

/* ===== INIT ===== */
loadDB();
fillProvinces();

document.getElementById("btnSearch").addEventListener("click",()=>doSearch(false));
document.getElementById("btnShowAll").addEventListener("click",()=>doSearch(true));
document.getElementById("btnClear").addEventListener("click",clearForm);
document.getElementById("btnExport").addEventListener("click",exportCSV);
</script>

</body>
</html>
