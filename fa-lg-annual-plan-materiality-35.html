<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>FA ‚Äì LG Annual | ‡∏≠‡∏õ‡∏ó.3.5 ‚Äì ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Materiality)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#060818;
      --card:#11152b;
      --border:#262b46;
      --accent:#42a5f5;
      --accent2:#26c6da;
      --muted:#a3acc7;
      --text:#f5f7ff;
      --pink:#f48fb1;
    }
    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, sans-serif;
      background:
        radial-gradient(circle at 10% 0%, rgba(123,30,60,0.36) 0, transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(66,165,245,0.32) 0, transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(38,198,218,0.22) 0, transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
      font-size:140%;
    }

    header{
      padding:16px 10px 12px;
      text-align:center;
      background:linear-gradient(120deg,#0d47a1,#42a5f5,#26c6da);
      box-shadow:0 4px 16px rgba(0,0,0,0.7);
      position:sticky;
      top:0;
      z-index:20;
    }
    header h2{ margin:0; font-size:20px; }
    header .sub{ font-size:13px; opacity:.9; }

    main{
      max-width:1100px;
      margin:20px auto 28px;
      padding:0 16px 20px;
    }

    .nav-top{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }
    .btn-nav{
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.45);
      background:rgba(0,0,0,0.35);
      color:#fff;
      font-size:12px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-nav:hover{ background:rgba(0,0,0,0.6); }

    .card{
      background:var(--card);
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      padding:16px 14px 16px;
      box-shadow:0 10px 30px rgba(0,0,0,0.9);
      margin-bottom:16px;
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      margin-bottom:10px;
    }
    .card-title{
      font-size:16px;
      font-weight:600;
    }
    .card-sub{
      font-size:12px;
      color:var(--muted);
    }
    .chip{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.2);
      font-size:11px;
      background:rgba(0,0,0,0.35);
      white-space:nowrap;
    }

    .form-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:10px 14px;
      margin-top:4px;
    }

    label{
      font-size:12px;
      display:block;
      margin-bottom:2px;
      color:#e3f2fd;
    }
    .input, select, textarea{
      width:100%;
      padding:6px 8px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#080c1b;
      color:var(--text);
      font-size:12px;
    }
    textarea{
      min-height:70px;
      resize:vertical;
    }
    .input:focus, select:focus, textarea:focus{
      outline:none;
      border-color:var(--accent2);
      box-shadow:0 0 0 1px rgba(38,198,218,0.5);
    }

    .section-title{
      font-size:14px;
      font-weight:600;
      margin:10px 0 6px;
    }
    .hint{
      font-size:11px;
      color:var(--muted);
      margin-bottom:6px;
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .btn{
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.4);
      background:rgba(0,0,0,0.4);
      color:#fff;
      font-size:12px;
      cursor:pointer;
    }
    .btn-primary{
      border-color:var(--accent);
      background:linear-gradient(120deg,#0d47a1,#42a5f5);
    }
    .btn-danger{
      border-color:#f44336;
      background:linear-gradient(120deg,#b71c1c,#f44336);
    }
    .btn-success{
      border-color:#4caf50;
      background:linear-gradient(120deg,#1b5e20,#4caf50);
    }
    .btn-info{
      border-color:#26c6da;
      background:linear-gradient(120deg,#006064,#26c6da);
    }
    .btn-ai{
      border-color:#f48fb1;
      background:linear-gradient(120deg,#7b1e3c,#f48fb1);
    }
    .btn:hover{
      background:rgba(0,0,0,0.7);
    }
    .btn-primary:hover,
    .btn-danger:hover,
    .btn-success:hover,
    .btn-info:hover,
    .btn-ai:hover{
      filter:brightness(1.1);
    }

    .footer-note{
      font-size:10px;
      color:var(--muted);
      margin-top:6px;
    }

    /* ---------- A4 PREVIEW ---------- */
    .a4-wrapper{
      margin-top:18px;
    }

    .a4-title{
      font-size:14px;
      font-weight:600;
      margin-bottom:6px;
    }

    .a4-page{
      width:210mm;
      min-height:297mm;
      margin:0 auto 16px;
      background:#ffffff;
      color:#000000;
      box-shadow:0 0 8px rgba(0,0,0,0.5);
      padding:12mm;
      font-size:11pt;
      position:relative;
    }

    .a4-header-center{
      text-align:center;
      margin-bottom:6px;
      font-size:12pt;
      font-weight:600;
    }
    .a4-subheader{
      text-align:center;
      font-size:10pt;
      margin-bottom:8px;
    }
    .a4-row{
      display:flex;
      justify-content:space-between;
      font-size:10pt;
      margin-bottom:4px;
    }
    .a4-row span{
      display:inline-block;
      min-width:80px;
    }
    .a4-row .value{
      border-bottom:1px solid #000;
      min-width:160px;
      display:inline-block;
      padding:0 2px;
    }

    .a4-table{
      width:100%;
      border-collapse:collapse;
      margin-top:8px;
      font-size:10pt;
    }
    .a4-table th,
    .a4-table td{
      border:1px solid #000;
      padding:4px 4px;
      vertical-align:top;
    }
    .a4-table th{
      text-align:center;
      font-weight:600;
    }

    .a4-footer{
      position:absolute;
      bottom:8mm;
      left:12mm;
      right:12mm;
      font-size:8pt;
      display:flex;
      justify-content:space-between;
    }

    /* PRINT */
    @page{
      size:A4;
      margin:12mm;
    }
    @media print{
      body{
        background:#ffffff;
        color:#000000;
        font-size:11pt;
      }
      header,
      .nav-top,
      .card:not(.card-a4),
      .no-print{
        display:none !important;
      }
      .a4-page{
        box-shadow:none;
        margin:0;
        width:auto;
        min-height:auto;
        padding:0;
      }
      main{
        max-width:100%;
        margin:0;
        padding:0;
      }
    }

    @media (max-width:900px){
      .a4-page{
        width:100%;
        min-height:auto;
      }
    }

    @media (max-width:600px){
      .card-header{
        flex-direction:column;
        align-items:flex-start;
      }
    }
  </style>
</head>
<body>

<header>
  <h2>üìè ‡∏≠‡∏õ‡∏ó.3.5 ‚Äì ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Materiality)</h2>
  <div class="sub">
    Overall Materiality (OM) ‚Ä¢ Performance Materiality (PM) ‚Ä¢ Threshold for Errors (TE) ‚Äì FA ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡∏≠‡∏õ‡∏ó.
  </div>
</header>

<main>

  <div class="nav-top">
    <a href="fa-lg-annual-plan.html" class="btn-nav">
      <span>üß≠</span> ‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô
    </a>
    <a href="fa-lg-annual.html" class="btn-nav">
      <span>üìÖ</span> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à
    </a>
    <a href="fa-menu.html" class="btn-nav">
      <span>üìÇ</span> FA Main Menu
    </a>
    <a href="index.html" class="btn-nav">
      <span>üè†</span> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    </a>
  </div>

  <!-- CARD 1: Basic info + Form reference -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‚Äì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</div>
        <div class="card-sub">
          ‡∏ú‡∏π‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì-‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (‡∏≠‡∏õ‡∏ó.3 ‚Äì ‡∏≠‡∏õ‡∏ó.8.31) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Materiality
        </div>
      </div>
      <div class="chip">‡∏≠‡∏õ‡∏ó.3.5 ‚Ä¢ Materiality</div>
    </div>

    <div class="hint">
      ‚öôÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å <code>localStorage["fa-db-data-gov"]</code>  
      ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ <code>fa-db-data-gov.html</code> ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
    </div>
    <div id="govDbStatus" class="hint"></div>

    <div class="form-grid">
      <div>
        <label for="fy">‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
        <select id="fy" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‚Äî</option>
          <option>2562</option><option>2563</option><option>2564</option>
          <option>2565</option><option>2566</option><option>2567</option>
          <option>2568</option><option>2569</option><option>2570</option>
          <option>2571</option><option>2572</option><option>2573</option>
          <option>2574</option><option>2575</option><option>2576</option>
          <option>2577</option><option>2578</option><option>2579</option>
          <option>2580</option><option>2581</option><option>2582</option>
        </select>
      </div>

      <div>
        <label for="period">‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (30 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2566 ‚Äì 2582)</label>
        <select id="period" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‚Äî</option>
          <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
        </select>
      </div>

      <div>
        <label for="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á)</label>
        <select id="province" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‚Äî</option>
        </select>
      </div>

      <div>
        <label for="amphoe">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï (‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á)</label>
        <select id="amphoe" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï ‚Äî</option>
        </select>
      </div>

      <div>
        <label for="auditee">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / ‡∏≠‡∏õ‡∏ó. (‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á)</label>
        <select id="auditee" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî</option>
        </select>
      </div>

      <div>
        <label for="formRef">‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏≠‡∏õ‡∏ó.3 ‚Äì ‡∏≠‡∏õ‡∏ó.8.31)</label>
        <select id="formRef" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‚Äî</option>
          <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
        </select>
      </div>
    </div>

    <div class="section-title">1.2 ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î OM / PM / TE)</div>
    <textarea id="formSummary" class="input" placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°/‡∏á‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏≠‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°, ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°, ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ‡∏Ø‡∏•‡∏Ø"></textarea>
  </section>

  <!-- CARD 2: Materiality Calculation -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‚Äì ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (OM / PM / TE)</div>
        <div class="card-sub">
          ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ê‡∏≤‡∏ô (Base) ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç Materiality ‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á ‡∏≠‡∏õ‡∏ó.3.5 ‚Äì ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÑ‡∏î‡πâ
        </div>
      </div>
      <div class="chip">OM ‚Ä¢ PM ‚Ä¢ TE</div>
    </div>

    <div class="form-grid">
      <div>
        <label for="baseType">‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Base)</label>
        <select id="baseType" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ê‡∏≤‡∏ô ‚Äî</option>
          <option value="‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</option>
          <option value="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</option>
          <option value="‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°</option>
          <option value="‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</option>
          <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)</option>
        </select>
      </div>
      <div>
        <label for="baseAmount">‡∏¢‡∏≠‡∏î‡∏ê‡∏≤‡∏ô (Base Amount)</label>
        <input id="baseAmount" class="input" type="number" step="0.01" placeholder="‡πÄ‡∏ä‡πà‡∏ô 120000000.00">
      </div>
      <div>
        <label for="baseRemark">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ê‡∏≤‡∏ô / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
        <input id="baseRemark" class="input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ï‡∏≤‡∏°‡∏á‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ê‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡∏Ø‡∏•‡∏Ø">
      </div>
    </div>

    <div class="section-title">2.1 Overall Materiality (OM)</div>
    <div class="form-grid">
      <div>
        <label for="omPercent">‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î OM (%)</label>
        <input id="omPercent" class="input" type="number" step="0.01" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2.0">
      </div>
      <div>
        <label for="omAmount">Overall Materiality (OM) ‚Äì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
        <input id="omAmount" class="input" type="number" step="0.01" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å Base √ó %">
      </div>
      <div>
        <label for="omComment">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•/‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î OM</label>
        <input id="omComment" class="input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á ‡∏≠‡∏õ‡∏ó. ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏Ø‡∏•‡∏Ø">
      </div>
    </div>

    <div class="section-title">2.2 Performance Materiality (PM)</div>
    <div class="form-grid">
      <div>
        <label for="pmPercent">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á PM ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö OM (%)</label>
        <input id="pmPercent" class="input" type="number" step="0.01" placeholder="‡πÄ‡∏ä‡πà‡∏ô 75">
      </div>
      <div>
        <label for="pmAmount">Performance Materiality (PM) ‚Äì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
        <input id="pmAmount" class="input" type="number" step="0.01" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å OM √ó %">
      </div>
      <div>
        <label for="pmComment">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•/‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î PM</label>
        <input id="pmComment" class="input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á RMM ‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°, ‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö ‡∏Ø‡∏•‡∏Ø">
      </div>
    </div>

    <div class="section-title">2.3 Threshold for Errors (TE)</div>
    <div class="form-grid">
      <div>
        <label for="tePercent">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô TE ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö OM ‡∏´‡∏£‡∏∑‡∏≠ PM (%)</label>
        <input id="tePercent" class="input" type="number" step="0.01" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5">
      </div>
      <div>
        <label for="teAmount">Threshold for Errors (TE) ‚Äì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
        <input id="teAmount" class="input" type="number" step="0.01" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å OM ‡∏´‡∏£‡∏∑‡∏≠ PM √ó %">
      </div>
      <div>
        <label for="teComment">‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÉ‡∏ä‡πâ TE ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</label>
        <input id="teComment" class="input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÑ‡∏°‡πà‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏Ø‡∏•‡∏Ø">
      </div>
    </div>

    <div class="section-title">2.4 ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</div>
    <textarea id="matRemark" class="input" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏ä‡∏¥‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏∏‡∏à‡∏£‡∏¥‡∏ï ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Ø‡∏•‡∏Ø"></textarea>

    <div class="btn-row no-print">
      <button type="button" class="btn" onclick="autoCalculateMateriality()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì OM / PM / TE ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
      <button type="button" class="btn" onclick="pushToA4()">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° A4</button>
    </div>
  </section>

  <!-- CARD 3: AI Analysis -->
  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 ‚Äì ‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á Materiality</div>
        <div class="card-sub">
          ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô Prototype ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á OM/PM/TE ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Input ‡πÉ‡∏´‡πâ AI ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
        </div>
      </div>
      <div class="chip">AI Assistant ‚Ä¢ Materiality</div>
    </div>

    <div class="form-grid">
      <div>
        <label for="aiQuestion">‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</label>
        <textarea id="aiQuestion" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏∞‡∏î‡∏±‡∏ö OM/PM/TE ‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á ‡∏≠‡∏õ‡∏ó. ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà, ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏î ‡∏Ø‡∏•‡∏Ø"></textarea>
      </div>
      <div>
        <label for="aiSourceData">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç/‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)</label>
        <textarea id="aiSourceData" class="input" placeholder="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ RMM, ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Materiality ‡∏Ø‡∏•‡∏Ø"></textarea>
      </div>
    </div>

    <div class="section-title">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢ AI / ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
    <textarea id="aiResult" class="input" placeholder="‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Prototype ‡πÉ‡∏ô Browser)"></textarea>

    <div class="btn-row no-print">
      <button type="button" class="btn-ai" onclick="fakeAiAnalyze()">ü§ñ ‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Prototype)</button>
      <button type="button" class="btn" onclick="pushToA4()">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° A4</button>
      <button type="button" class="btn-success" onclick="sendToReviewSystem()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô (Review)</button>
      <button type="button" class="btn-info" onclick="sendToWorkingpaperDb()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ (WP DB)</button>
    </div>

    <div class="footer-note">
      * ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô <code>fakeAiAnalyze()</code> ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API AI ‡∏à‡∏£‡∏¥‡∏á (OpenAI / Gemini ‡∏Ø‡∏•‡∏Ø) ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á  
      * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÉ‡∏ô JSON ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô/‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£
    </div>
  </section>

  <!-- CARD 4: A4 + Export -->
  <section class="card card-a4">
    <div class="card-header">
      <div>
        <div class="card-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4 ‚Äì ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3.5 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö A4 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå / ‡πÅ‡∏ô‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</div>
        <div class="card-sub">
          ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì-‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à-‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç OM / PM / TE ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4
        </div>
      </div>
      <div class="chip">A4 Layout ‚Ä¢ Export</div>
    </div>

    <div class="btn-row no-print">
      <button type="button" class="btn" onclick="pushToA4()">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° A4</button>
      <button type="button" class="btn btn-primary" onclick="window.print()">‡∏û‡∏¥‡∏°‡∏û‡πå / Export PDF (A4)</button>
      <button type="button" class="btn" onclick="exportA4Html()">Export ‡πÄ‡∏õ‡πá‡∏ô HTML (A4 ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤)</button>
      <button type="button" class="btn btn-danger" onclick="exportJson()">Export ‡πÄ‡∏õ‡πá‡∏ô JSON (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°)</button>
      <button type="button" class="btn-success" onclick="sendToReviewSystem()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô (Review)</button>
      <button type="button" class="btn-info" onclick="sendToWorkingpaperDb()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ (WP DB)</button>
    </div>

    <div class="a4-wrapper">
      <div class="a4-title">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3.5 ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4</div>

      <div class="a4-page" id="a4Page">
        <div class="a4-header-center">
          ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3.5 ‚Äì ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Materiality)
        </div>
        <div class="a4-subheader">
          ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô ‚Äì Overall / Performance Materiality & Threshold for Errors
        </div>

        <div class="a4-row">
          <div>
            <span>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</span>
            <span class="value" id="a4Fy">&nbsp;</span>
          </div>
          <div>
            <span>‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
            <span class="value" id="a4Period">&nbsp;</span>
          </div>
        </div>
        <div class="a4-row">
          <div>
            <span>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</span>
            <span class="value" id="a4Auditee">&nbsp;</span>
          </div>
          <div>
            <span>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï</span>
            <span class="value" id="a4Amphoe">&nbsp;</span>
          </div>
        </div>
        <div class="a4-row">
          <div>
            <span>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</span>
            <span class="value" id="a4Province">&nbsp;</span>
          </div>
          <div>
            <span>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</span>
            <span class="value" id="a4FormRef">&nbsp;</span>
          </div>
        </div>

        <div style="margin-top:10px; font-size:10pt;">
          <strong>1. ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</strong>
        </div>
        <div style="font-size:10pt; margin-top:4px;" id="a4FormSummary"></div>

        <div style="margin-top:10px; font-size:10pt;">
          <strong>2. ‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</strong>
        </div>
        <table class="a4-table">
          <tr>
            <th style="width:35%;">‡∏ê‡∏≤‡∏ô (Base)</th>
            <th style="width:25%;">‡∏¢‡∏≠‡∏î‡∏ê‡∏≤‡∏ô (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô)</th>
            <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
          </tr>
          <tr>
            <td id="a4BaseType"></td>
            <td id="a4BaseAmount"></td>
            <td id="a4BaseRemark"></td>
          </tr>
        </table>

        <div style="margin-top:10px; font-size:10pt;">
          <strong>3. ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Overall Materiality (OM), Performance Materiality (PM) ‡πÅ‡∏•‡∏∞ Threshold for Errors (TE)</strong>
        </div>
        <table class="a4-table">
          <tr>
            <th style="width:20%;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            <th style="width:15%;">‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ (%)</th>
            <th style="width:25%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
            <th>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ / ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
          </tr>
          <tr>
            <td>OM</td>
            <td id="a4OmPercent"></td>
            <td id="a4OmAmount"></td>
            <td id="a4OmComment"></td>
          </tr>
          <tr>
            <td>PM</td>
            <td id="a4PmPercent"></td>
            <td id="a4PmAmount"></td>
            <td id="a4PmComment"></td>
          </tr>
          <tr>
            <td>TE</td>
            <td id="a4TePercent"></td>
            <td id="a4TeAmount"></td>
            <td id="a4TeComment"></td>
          </tr>
        </table>

        <div style="margin-top:10px; font-size:10pt;">
          <strong>4. ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Materiality</strong>
        </div>
        <div style="font-size:10pt; margin-top:4px;" id="a4MatRemark"></div>

        <div style="margin-top:10px; font-size:10pt;">
          <strong>5. ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢ AI / ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</strong>
        </div>
        <div style="font-size:10pt; margin-top:4px;" id="a4AiResult"></div>

        <div class="a4-footer">
          <div>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3.5 ‚Äì Materiality ‚Äì FA LG Annual</div>
          <div id="a4FooterMeta">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö FA ‚Äì LG</div>
        </div>
      </div>
    </div>
  </section>

</main>

<script>
  /* ---------- Helper ---------- */

  function nl2br(text){
    if(!text) return '';
    return text.replace(/\n/g,'<br>');
  }

  /* ---------- Gov DB (fa-db-data-gov) ---------- */

  let LG_DB = [];

  function getProvinceField(row){
    return row.province || row.Province || row.prov || row['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î'] || '';
  }
  function getAmphoeField(row){
    return row.amphoe || row.district || row.District || row['‡∏≠‡∏≥‡πÄ‡∏†‡∏≠'] || row['‡πÄ‡∏Ç‡∏ï'] || '';
  }
  function getAuditeeNameField(row){
    return (
      row.auditee ||
      row.unitName ||
      row.unit ||
      row['‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à'] ||
      row['‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô'] ||
      ''
    );
  }

  function setStatus(msg, isError){
    const el = document.getElementById('govDbStatus');
    if(!el) return;
    el.textContent = msg || '';
    el.style.color = isError ? '#ffab91' : '#a3acc7';
  }

  function fillSelectOptions(select, items, placeholder){
    if(!select) return;
    select.innerHTML = '';
    const opt0 = document.createElement('option');
    opt0.value = '';
    opt0.textContent = placeholder;
    select.appendChild(opt0);
    items.forEach(v => {
      const o = document.createElement('option');
      o.value = v;
      o.textContent = v;
      select.appendChild(o);
    });
  }

  function initGovDbFromLocalStorage(){
    try{
      const raw = localStorage.getItem('fa-db-data-gov');
      if(!raw){
        setStatus('‚ö† ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage["fa-db-data-gov"] ‚Äì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ fa-db-data-gov.html ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô', true);
        return;
      }
      const data = JSON.parse(raw);
      if(!Array.isArray(data)){
        setStatus('‚ö† ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• fa-db-data-gov ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Array', true);
        return;
      }
      LG_DB = data;

      const provinces = [...new Set(
        LG_DB.map(getProvinceField).filter(Boolean)
      )].sort((a,b)=>a.localeCompare(b,'th-TH'));

      const provinceSelect = document.getElementById('province');
      fillSelectOptions(provinceSelect, provinces, '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‚Äî');

      setStatus(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${LG_DB.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, false);
    }catch(e){
      console.error(e);
      setStatus('‚ö† ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• fa-db-data-gov ‡∏à‡∏≤‡∏Å localStorage', true);
    }
  }

  function onProvinceChange(){
    const province = document.getElementById('province').value || '';
    const amphoeSelect = document.getElementById('amphoe');
    const auditeeSelect = document.getElementById('auditee');

    if(!province){
      fillSelectOptions(amphoeSelect, [], '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï ‚Äî');
      fillSelectOptions(auditeeSelect, [], '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî');
      return;
    }

    const amphoeList = [...new Set(
      LG_DB
        .filter(row => getProvinceField(row) === province)
        .map(getAmphoeField)
        .filter(Boolean)
    )].sort((a,b)=>a.localeCompare(b,'th-TH'));

    fillSelectOptions(amphoeSelect, amphoeList, '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï ‚Äî');
    fillSelectOptions(auditeeSelect, [], '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî');
  }

  function onAmphoeChange(){
    const province = document.getElementById('province').value || '';
    const amphoe = document.getElementById('amphoe').value || '';
    const auditeeSelect = document.getElementById('auditee');

    if(!province || !amphoe){
      fillSelectOptions(auditeeSelect, [], '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî');
      return;
    }

    const units = LG_DB.filter(row =>
      getProvinceField(row) === province &&
      getAmphoeField(row) === amphoe
    );

    const names = [...new Set(
      units.map(getAuditeeNameField).filter(Boolean)
    )].sort((a,b)=>a.localeCompare(b,'th-TH'));

    fillSelectOptions(auditeeSelect, names, '‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à ‚Äî');
  }

  /* ---------- ‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà + ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ---------- */

  function initPeriods(){
    const periodSelect = document.getElementById('period');
    if(!periodSelect) return;
    for(let y=2566; y<=2582; y++){
      const txt = '30 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô ' + y;
      const opt = document.createElement('option');
      opt.value = txt;
      opt.textContent = txt;
      periodSelect.appendChild(opt);
    }
  }

  function initFormRefs(){
    const select = document.getElementById('formRef');
    if(!select) return;

    const formsSet = new Set();

    // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
    [
      '‡∏≠‡∏õ‡∏ó.3','‡∏≠‡∏õ‡∏ó.3.1','‡∏≠‡∏õ‡∏ó.4','‡∏≠‡∏õ‡∏ó.5','‡∏≠‡∏õ‡∏ó.5.1','‡∏≠‡∏õ‡∏ó.5.2',
      '‡∏≠‡∏õ‡∏ó.3.5','‡∏≠‡∏õ‡∏ó.3.6',
      '‡∏≠‡∏õ‡∏ó.8.2','‡∏≠‡∏õ‡∏ó.8.2.1','‡∏≠‡∏õ‡∏ó.8.2.2','‡∏≠‡∏õ‡∏ó.8.2.3'
    ].forEach(f => formsSet.add(f));

    // 8.1‚Äì8.31
    for(let i=1; i<=31; i++){
      formsSet.add('‡∏≠‡∏õ‡∏ó.8.' + i);
    }

    const forms = Array.from(formsSet).sort((a,b)=>a.localeCompare(b,'th-TH',{numeric:true}));

    forms.forEach(f => {
      const opt = document.createElement('option');
      opt.value = f;
      opt.textContent = f;
      select.appendChild(opt);
    });
  }

  /* ---------- Materiality Calculation ---------- */

  function toNumber(val){
    const n = Number(val);
    return isNaN(n) ? 0 : n;
  }

  function formatNumber(n){
    if(n === null || n === undefined || isNaN(Number(n))) return '';
    return Number(n).toLocaleString('th-TH', {minimumFractionDigits:2, maximumFractionDigits:2});
  }

  function autoCalculateMateriality(){
    const baseAmount = toNumber(document.getElementById('baseAmount').value);
    const omPercent  = toNumber(document.getElementById('omPercent').value);
    const pmPercent  = toNumber(document.getElementById('pmPercent').value);
    const tePercent  = toNumber(document.getElementById('tePercent').value);

    if(baseAmount > 0 && omPercent > 0){
      const om = baseAmount * omPercent / 100;
      document.getElementById('omAmount').value = om.toFixed(2);
    }

    const omAmount = toNumber(document.getElementById('omAmount').value);

    if(omAmount > 0 && pmPercent > 0){
      const pm = omAmount * pmPercent / 100;
      document.getElementById('pmAmount').value = pm.toFixed(2);
    }

    const pmAmount = toNumber(document.getElementById('pmAmount').value);

    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ OM ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô TE ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ PM
    const baseForTE = pmAmount > 0 ? pmAmount : omAmount;
    if(baseForTE > 0 && tePercent > 0){
      const te = baseForTE * tePercent / 100;
      document.getElementById('teAmount').value = te.toFixed(2);
    }

    alert('‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì OM / PM / TE ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÅ‡∏•‡πâ‡∏ß');
  }

  /* ---------- Sync ‡πÑ‡∏õ A4 ---------- */

  function pushToA4(){
    document.getElementById('a4Fy').textContent       = document.getElementById('fy').value || '';
    document.getElementById('a4Period').textContent   = document.getElementById('period').value || '';
    document.getElementById('a4Auditee').textContent  = document.getElementById('auditee').value || '';
    document.getElementById('a4Amphoe').textContent   = document.getElementById('amphoe').value || '';
    document.getElementById('a4Province').textContent = document.getElementById('province').value || '';
    document.getElementById('a4FormRef').textContent  = document.getElementById('formRef').value || '';

    document.getElementById('a4FormSummary').innerHTML = nl2br(document.getElementById('formSummary').value || '');

    document.getElementById('a4BaseType').textContent   = document.getElementById('baseType').value || '';
    document.getElementById('a4BaseAmount').textContent = formatNumber(document.getElementById('baseAmount').value || '');
    document.getElementById('a4BaseRemark').textContent = document.getElementById('baseRemark').value || '';

    document.getElementById('a4OmPercent').textContent  = (document.getElementById('omPercent').value || '') + (document.getElementById('omPercent').value ? ' %' : '');
    document.getElementById('a4OmAmount').textContent   = formatNumber(document.getElementById('omAmount').value || '');
    document.getElementById('a4OmComment').textContent  = document.getElementById('omComment').value || '';

    document.getElementById('a4PmPercent').textContent  = (document.getElementById('pmPercent').value || '') + (document.getElementById('pmPercent').value ? ' %' : '');
    document.getElementById('a4PmAmount').textContent   = formatNumber(document.getElementById('pmAmount').value || '');
    document.getElementById('a4PmComment').textContent  = document.getElementById('pmComment').value || '';

    document.getElementById('a4TePercent').textContent  = (document.getElementById('tePercent').value || '') + (document.getElementById('tePercent').value ? ' %' : '');
    document.getElementById('a4TeAmount').textContent   = formatNumber(document.getElementById('teAmount').value || '');
    document.getElementById('a4TeComment').textContent  = document.getElementById('teComment').value || '';

    document.getElementById('a4MatRemark').innerHTML    = nl2br(document.getElementById('matRemark').value || '');
    document.getElementById('a4AiResult').innerHTML     = nl2br(document.getElementById('aiResult').value || '');

    const now = new Date();
    const ts = now.toLocaleString('th-TH');
    document.getElementById('a4FooterMeta').textContent = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö FA ‚Äì LG ‡∏ì ' + ts;
  }

  /* ---------- Build data ‡∏Å‡∏•‡∏≤‡∏á ---------- */

  function buildFormData(){
    const data = {
      fiscalYear   : document.getElementById('fy').value || '',
      period       : document.getElementById('period').value || '',
      auditee      : document.getElementById('auditee').value || '',
      amphoe       : document.getElementById('amphoe').value || '',
      province     : document.getElementById('province').value || '',
      formRef      : document.getElementById('formRef').value || '',
      formSummary  : document.getElementById('formSummary').value || '',
      baseType     : document.getElementById('baseType').value || '',
      baseAmount   : document.getElementById('baseAmount').value || '',
      baseRemark   : document.getElementById('baseRemark').value || '',
      omPercent    : document.getElementById('omPercent').value || '',
      omAmount     : document.getElementById('omAmount').value || '',
      omComment    : document.getElementById('omComment').value || '',
      pmPercent    : document.getElementById('pmPercent').value || '',
      pmAmount     : document.getElementById('pmAmount').value || '',
      pmComment    : document.getElementById('pmComment').value || '',
      tePercent    : document.getElementById('tePercent').value || '',
      teAmount     : document.getElementById('teAmount').value || '',
      teComment    : document.getElementById('teComment').value || '',
      matRemark    : document.getElementById('matRemark').value || '',
      aiQuestion   : document.getElementById('aiQuestion').value || '',
      aiSourceData : document.getElementById('aiSourceData').value || '',
      aiResult     : document.getElementById('aiResult').value || '',
      meta: {
        formCode : '‡∏≠‡∏õ‡∏ó.3.5',
        module   : 'FA-LG-Annual-Planning',
        exportedAt: new Date().toISOString()
      }
    };
    return data;
  }

  /* ---------- Export ---------- */

  function exportA4Html(){
    const a4 = document.getElementById('a4Page');
    if(!a4){
      alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ A4');
      return;
    }
    const htmlContent =
      '<!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><title>OP3-5-Materiality-A4</title>' +
      '<style>@page{size:A4;margin:12mm;}body{font-family:"TH Sarabun New","Segoe UI",sans-serif;font-size:11pt;} .a4-page{width:100%;min-height:100%;}</style>' +
      '</head><body>' + a4.outerHTML + '</body></html>';

    const blob = new Blob([htmlContent], {type:'text/html'});
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href = url;
    a.download = 'op3_5_materiality_a4.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function exportJson(){
    const data = buildFormData();
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href = url;
    a.download = 'op3_5_materiality.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  /* ---------- Integration: Review & Working Papers ---------- */

  function sendToReviewSystem(){
    const data = buildFormData();

    try{
      localStorage.setItem('fa_op3_5_last_for_review', JSON.stringify(data));
    }catch(e){
      console.error('localStorage error', e);
    }

    /*
    fetch('/api/review-system/op3-5', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    */

    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3.5 ‡∏™‡πà‡∏á‡πÑ‡∏õ ‚Äú‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ó‡∏≤‡∏ô‚Äù (‡∏à‡∏≥‡∏•‡∏≠‡∏á) ‡πÅ‡∏•‡πâ‡∏ß \n(‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà localStorage: fa_op3_5_last_for_review)');
  }

  function sendToWorkingpaperDb(){
    const data = buildFormData();

    try{
      localStorage.setItem('fa_op3_5_last_workingpaper', JSON.stringify(data));
    }catch(e){
      console.error('localStorage error', e);
    }

    /*
    fetch('/api/workingpapers/op3-5', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    */

    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏õ‡∏ó.3.5 ‡∏™‡πà‡∏á‡πÑ‡∏õ ‚Äú‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‚Äù (‡∏à‡∏≥‡∏•‡∏≠‡∏á) ‡πÅ‡∏•‡πâ‡∏ß \n(‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà localStorage: fa_op3_5_last_workingpaper)');
  }

  /* ---------- AI Prototype ---------- */

  function fakeAiAnalyze(){
    const fy       = document.getElementById('fy').value || '‚Äî';
    const period   = document.getElementById('period').value || '‚Äî';
    const auditee  = document.getElementById('auditee').value || '‚Äî';
    const formRef  = document.getElementById('formRef').value || '‚Äî';
    const baseType = document.getElementById('baseType').value || '‚Äî';
    const baseAmt  = document.getElementById('baseAmount').value || '';
    const omPct    = document.getElementById('omPercent').value || '';
    const pmPct    = document.getElementById('pmPercent').value || '';
    const tePct    = document.getElementById('tePercent').value || '';
    const omAmt    = document.getElementById('omAmount').value || '';
    const pmAmt    = document.getElementById('pmAmount').value || '';
    const teAmt    = document.getElementById('teAmount').value || '';
    const question = document.getElementById('aiQuestion').value || '';
    const src      = document.getElementById('aiSourceData').value || '';
    const summary  = document.getElementById('formSummary').value || '';

    let result = '';
    result += '‚òÖ ‡∏Å‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ Materiality\n';
    result += '- ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: ' + fy + '\n';
    result += '- ‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + period + '\n';
    result += '- ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à: ' + auditee + '\n';
    result += '- ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°: ' + formRef + '\n';
    result += '- ‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: ' + baseType + ' (' + (baseAmt || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + ')\n';
    result += '- OM: ' + (omPct || '‚Äî') + '% ‚âà ' + (omAmt || '‚Äî') + '\n';
    result += '- PM: ' + (pmPct || '‚Äî') + '% ‡∏Ç‡∏≠‡∏á OM ‚âà ' + (pmAmt || '‚Äî') + '\n';
    result += '- TE: ' + (tePct || '‚Äî') + '% ‡∏Ç‡∏≠‡∏á OM/PM ‚âà ' + (teAmt || '‚Äî') + '\n\n';

    if(summary){
      result += '‚òÖ ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô\n';
      result += summary + '\n\n';
    }
    if(question){
      result += '‚òÖ ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ AI/‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå\n';
      result += question + '\n\n';
    }
    if(src){
      result += '‚òÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏ï‡∏±‡∏î‡∏ï‡∏≠‡∏ô)\n';
      result += src.substring(0,800);
      if(src.length > 800){
        result += '\n...[‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö]...\n';
      }
      result += '\n\n';
    }

    result += '‚òÖ ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á OM / PM / TE (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)\n';
    result += '- ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö OM ‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô (Base) ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô 1‚Äì3% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏≠‡∏õ‡∏ó. ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)\n';
    result += '- ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á RMM: ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î OM/PM ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö\n';
    result += '- ‡∏î‡∏π‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç PM ‡∏°‡∏±‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ OM ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î\n';
    result += '- TE ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏™‡∏∞‡∏™‡∏°‡∏à‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô OM ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤\n';
    result += '\n(‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Prototype ‚Äì ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πà‡∏≠ API AI ‡∏à‡∏£‡∏¥‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏õ‡πá‡∏ô Prompt ‡πÉ‡∏´‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ô‡∏≠‡∏Ñ‡πà‡∏≤ OM/PM/TE ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏î‡πâ)\n';

    document.getElementById('aiResult').value = result;
    alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß\n(‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ)');
  }

  /* ---------- Init ---------- */

  document.addEventListener('DOMContentLoaded', function(){
    initGovDbFromLocalStorage();
    initPeriods();
    initFormRefs();

    const provinceSelect = document.getElementById('province');
    const amphoeSelect   = document.getElementById('amphoe');

    if(provinceSelect){
      provinceSelect.addEventListener('change', onProvinceChange);
    }
    if(amphoeSelect){
      amphoeSelect.addEventListener('change', onAmphoeChange);
    }
  });
</script>

</body>
</html>
