<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>FA Database Login | Financial Audit System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#060818;
      --card:#11152b;
      --border:#262b46;
      --pink:#f48fb1;
      --blue:#0d47a1;
      --teal:#20c997;
      --muted:#a3acc7;
    }
    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:"Segoe UI",Arial,sans-serif;
      background:
        radial-gradient(circle at 10% 0%, rgba(123,30,60,0.36) 0, transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(66,165,245,0.32) 0, transparent 55%),
        radial-gradient(circle at 0% 100%, rgba(32,201,151,0.20) 0, transparent 55%),
        var(--bg);
      color:#f5f7ff;
      min-height:100vh;
    }

    header{
      text-align:center;
      padding:22px 10px;
      background:linear-gradient(120deg,#7b1e3c,#0d47a1,#20c997);
      box-shadow:0 4px 14px rgba(0,0,0,.6);
      position:sticky;
      top:0;
      z-index:10;
    }
    header h1{
      margin:0;
      font-size:24px;
      font-weight:800;
      letter-spacing:.03em;
    }
    header h3{
      margin:4px 0 0;
      font-size:13px;
      opacity:.9;
    }

    .wrap{
      max-width:880px;
      margin:28px auto 32px;
      padding:0 16px 24px;
      display:grid;
      grid-template-columns: minmax(0,1.2fr) minmax(0,1fr);
      gap:18px;
    }
    @media(max-width:860px){
      .wrap{
        grid-template-columns:1fr;
      }
    }

    .card{
      background:var(--card);
      border-radius:18px;
      border:1px solid rgba(255,255,255,.06);
      box-shadow:0 12px 32px rgba(0,0,0,.8);
      padding:20px 18px 18px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 0 0, rgba(244,143,177,0.22) 0, transparent 55%);
      opacity:0;
      transition:opacity .25s ease;
      pointer-events:none;
    }
    .card:hover::before{
      opacity:1;
    }
    .card > *{
      position:relative;
      z-index:1;
    }

    .card-main{
      border-top:3px solid #42a5f5;
    }
    .card-info{
      border-top:3px solid #20c997;
    }

    h2{
      margin:0 0 6px;
      font-size:19px;
    }
    .muted{
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
    }

    label{
      display:block;
      margin-top:10px;
      margin-bottom:4px;
      font-size:13px;
      font-weight:600;
    }

    input[type="email"],
    input[type="password"]{
      width:100%;
      padding:10px 11px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(5,8,26,0.92);
      color:#fff;
      font-size:14px;
      outline:none;
    }
    input:focus{
      border-color:var(--pink);
      box-shadow:0 0 0 1px rgba(244,143,177,0.45);
    }

    .row-inline{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }

    .checkbox-row{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      color:var(--muted);
    }

    .btn-primary{
      padding:10px 18px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-size:14px;
      font-weight:700;
      color:#fff;
      background:linear-gradient(135deg,#f48fb1,#42a5f5);
      box-shadow:0 7px 22px rgba(13,71,161,0.7);
      min-width:180px;
    }
    .btn-primary:hover{
      filter:brightness(1.05);
      box-shadow:0 0 18px rgba(66,165,245,0.9);
    }

    .btn-ghost{
      padding:9px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.28);
      background:rgba(5,8,26,0.7);
      cursor:pointer;
      font-size:13px;
      color:#f5f7ff;
    }
    .btn-ghost:hover{
      background:rgba(255,255,255,0.08);
    }

    .badge-session{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(144,238,144,0.6);
      background:rgba(76,175,80,0.12);
      font-size:11px;
      margin-top:8px;
      color:#c8e6c9;
    }
    .dot-online{
      width:8px;height:8px;border-radius:50%;
      background:#69f0ae;
      box-shadow:0 0 10px #69f0ae;
    }

    .msg{
      margin-top:8px;
      font-size:12px;
      min-height:16px;
    }
    .msg-error{color:#ffb3b3;}
    .msg-ok{color:#b2ffb2;}

    ul.feature-list{
      margin:10px 0 0;
      padding-left:18px;
      font-size:13px;
      color:var(--muted);
    }
    ul.feature-list li{margin-bottom:4px;}

    .mini-title{
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.11em;
      color:#9fa7ff;
      margin-bottom:6px;
    }

    .pill{
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      font-size:11px;
      margin-right:4px;
      margin-top:4px;
      color:#e0e4ff;
    }

    footer{
      border-top:1px solid rgba(255,255,255,0.12);
      padding:10px 18px 14px;
      font-size:11px;
      color:var(--muted);
      text-align:center;
      background:rgba(3,5,15,0.9);
    }
  </style>
</head>

<body>

<header>
  <h1>üóÑ FA Database Login</h1>
  <h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Financial Audit System</h3>
</header>

<div class="wrap">

  <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î Login ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <div class="card card-main">
    <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (FA Database)</h2>
    <p class="muted">
      ‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö <strong>Financial Audit System</strong><br>
      ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (10 ‡∏´‡∏°‡∏ß‡∏î) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ / ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ
    </p>

    <div id="sessionInfo" class="badge-session" style="display:none;">
      <span class="dot-online"></span>
      <span id="sessionText"></span>
    </div>

    <form id="dbLoginForm" style="margin-top:10px;">
      <label for="dbEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email)</label>
      <input type="email" id="dbEmail" placeholder="‡πÄ‡∏ä‡πà‡∏ô apipoooo@gmail.com" required>

      <label for="dbPassword">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)</label>
      <input type="password" id="dbPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å" required>

      <div class="checkbox-row" style="margin-top:10px;">
        <input type="checkbox" id="dbRemember">
        <label for="dbRemember" style="margin:0;">‡∏à‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</label>
      </div>

      <div class="row-inline">
        <button type="submit" class="btn-primary">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button type="button" class="btn-ghost" onclick="window.location.href='index.html'">
          ‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å (Home)
        </button>
      </div>

      <div id="dbMsg" class="msg"></div>
    </form>
  </div>

  <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
  <div class="card card-info">
    <div class="mini-title">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
    <h2>FA Database ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?</h2>
    <p class="muted">
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô <strong>Data Center</strong> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à
      ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Login ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô FA ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
    </p>

    <p class="muted" style="margin-top:10px;"><strong>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:</strong></p>
    <ul class="feature-list">
      <li>‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 10 ‡∏´‡∏°‡∏ß‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó., ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£, ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢/‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö, ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏Ø‡∏•‡∏Ø</li>
      <li>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö (CRUD) ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</li>
      <li>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡πÄ‡∏ä‡πà‡∏ô Excel / CSV / PDF (‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ï‡∏¥‡∏°)</li>
      <li>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô FA ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πà‡∏≠ (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ / ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ ‡∏Ø‡∏•‡∏Ø)</li>
      <li>‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡πà‡∏≠‡πÑ‡∏õ</li>
    </ul>

    <p class="muted" style="margin-top:12px;"><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:</strong></p>
    <ul class="feature-list">
      <li>‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</li>
      <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô LocalStorage ‡∏ä‡∏∑‡πà‡∏≠ <code>fas-users</code> ‡πÅ‡∏•‡∏∞ <code>fas-session</code></li>
      <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡πâ‡∏≤‡∏á session ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠ <code>fa-db-session</code> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</li>
    </ul>

    <div style="margin-top:10px;">
      <span class="pill">Shared Identity: fas-users</span>
      <span class="pill">Module: FA Database</span>
      <span class="pill">Scope: View &amp; Manage Data</span>
    </div>
  </div>

</div>

<footer>
  ¬© 2025 Financial Audit System ‚Ä¢ FA Database Module ‚Ä¢ Local demo using browser LocalStorage
</footer>

<script>
  // ---------- CONFIG ----------
  const USERS_KEY = "fas-users";        // users ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å
  const MAIN_SESSION_KEY = "fas-session"; // session ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å
  const DB_SESSION_KEY = "fa-db-session"; // session ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

  // ---------- Utility ----------
  function loadJson(key){
    try{
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : null;
    }catch(e){
      console.warn("‡∏≠‡πà‡∏≤‡∏ô localStorage ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", key, e);
      return null;
    }
  }
  function saveJson(key, value){
    try{
      localStorage.setItem(key, JSON.stringify(value));
    }catch(e){
      console.warn("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å localStorage ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", key, e);
    }
  }

  function loadUsers(){
    const data = loadJson(USERS_KEY);
    return Array.isArray(data) ? data : [];
  }

  function loadMainSession(){
    const sess = loadJson(MAIN_SESSION_KEY);
    if(!sess) return null;
    if(sess.expiresAt && Date.now() > sess.expiresAt){
      // ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á
      localStorage.removeItem(MAIN_SESSION_KEY);
      return null;
    }
    return sess;
  }

  function loadDbSession(){
    const sess = loadJson(DB_SESSION_KEY);
    if(!sess) return null;
    if(sess.expiresAt && Date.now() > sess.expiresAt){
      localStorage.removeItem(DB_SESSION_KEY);
      return null;
    }
    return sess;
  }

  function createDbSession(email, remember){
    const now = Date.now();
    const FOUR_HOURS = 4 * 60 * 60 * 1000;
    const TWO_HOURS  = 2 * 60 * 60 * 1000;
    const session = {
      email,
      loginAt: now,
      remember: !!remember,
      expiresAt: now + (remember ? FOUR_HOURS : TWO_HOURS)
    };
    saveJson(DB_SESSION_KEY, session);
  }

  // ---------- Prefill & Session Display ----------
  const dbEmailInput   = document.getElementById("dbEmail");
  const sessionInfoBox = document.getElementById("sessionInfo");
  const sessionText    = document.getElementById("sessionText");
  const dbMsg          = document.getElementById("dbMsg");

  (function initPrefill(){
    const mainSess = loadMainSession();
    const dbSess   = loadDbSession();
    const users    = loadUsers();

    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ session ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß + user ‡∏¢‡∏±‡∏á approved -> ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÑ‡∏õ‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
    if(dbSess && dbSess.email){
      const u = users.find(x => (x.email || "").toLowerCase() === dbSess.email.toLowerCase());
      if(u && u.status === "approved"){
        sessionInfoBox.style.display = "inline-flex";
        sessionText.textContent = `‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠: ${u.fullname || u.email} ‚Ä¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π`;
        dbEmailInput.value = u.email;
        dbMsg.className = "msg msg-ok";
        dbMsg.textContent = "‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ session ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ";
        return;
      }
    }

    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ db-session ‡πÅ‡∏ï‡πà‡∏°‡∏µ main-session ‡∏≠‡∏¢‡∏π‡πà
    if(mainSess && mainSess.email){
      const u = users.find(x => (x.email || "").toLowerCase() === mainSess.email.toLowerCase());
      if(u){
        sessionInfoBox.style.display = "inline-flex";
        sessionText.textContent = `‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠: ${u.fullname || u.email}`;
        dbEmailInput.value = u.email;
      }
    }
  })();

  // ---------- Login Handler ----------
  document.getElementById("dbLoginForm").addEventListener("submit", function(e){
    e.preventDefault();

    const email = dbEmailInput.value.trim().toLowerCase();
    const pass  = document.getElementById("dbPassword").value.trim();
    const remember = document.getElementById("dbRemember").checked;

    dbMsg.textContent = "";
    dbMsg.className = "msg";

    if(!email || !pass){
      dbMsg.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô";
      dbMsg.className = "msg msg-error";
      return;
    }

    const users = loadUsers();
    const user  = users.find(u => (u.email || "").toLowerCase() === email);

    if(!user){
      dbMsg.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Login ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô (login.html)";
      dbMsg.className = "msg msg-error";
      return;
    }

    if(user.password !== pass){
      dbMsg.textContent = "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
      dbMsg.className = "msg msg-error";
      return;
    }

    if(user.status !== "approved"){
      dbMsg.textContent = "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö ‡∏à‡∏∂‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ";
      dbMsg.className = "msg msg-error";
      return;
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á session ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    createDbSession(user.email, remember);

    dbMsg.textContent = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶";
    dbMsg.className = "msg msg-ok";

    setTimeout(()=>{
      window.location.href = "fa-database-menu.html";
    }, 800);
  });
</script>

</body>
</html>
