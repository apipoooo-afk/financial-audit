<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>FA DB | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ + ‡∏≠‡∏õ‡∏ó.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{
    --bg:#060818;
    --card:#11152b;
    --muted:#a3acc7;
  }
  *{box-sizing:border-box;}
  body{margin:0;font-family:"Segoe UI",Arial;background:var(--bg);color:#fff;}
  header{
    padding:18px 10px;
    text-align:center;
    background:linear-gradient(120deg,#0d47a1,#6f42c1);
    box-shadow:0 4px 14px rgba(0,0,0,.6);
  }
  header h1{margin:0;font-size:22px;font-weight:800;}
  header p{margin:4px 0 0;font-size:13px;color:var(--muted);}
  .wrap{max-width:1100px;margin:18px auto 30px;padding:0 16px;}
  .top-row{
    display:flex;justify-content:space-between;flex-wrap:wrap;
    gap:8px;font-size:13px;color:var(--muted);margin-bottom:10px;
  }
  .card{
    background:var(--card);
    border-radius:16px;
    border:1px solid rgba(255,255,255,.14);
    padding:14px 14px 10px;
    margin-bottom:14px;
    box-shadow:0 8px 20px rgba(0,0,0,.55);
  }
  h2{margin:0 0 10px;font-size:18px;}
  label{display:block;font-size:13px;margin-top:6px;}
  input,textarea,select{
    width:100%;margin-top:4px;padding:7px 8px;
    border-radius:8px;border:1px solid rgba(255,255,255,.18);
    background:#05081a;color:#fff;font-size:13px;
  }
  textarea{min-height:60px;resize:vertical;}
  input:focus,textarea:focus,select:focus{outline:none;border-color:#20c997;}
  .form-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:8px 12px;
  }
  .btn-row{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px;}
  button,.nav{
    border:none;border-radius:999px;
    padding:8px 14px;font-size:13px;cursor:pointer;
  }
  .btn-primary{background:#20c997;color:#000;font-weight:700;}
  .btn-secondary{background:#374151;color:#e5e7eb;}
  .btn-danger{background:#b91c1c;color:#fff;}
  table{
    width:100%;border-collapse:collapse;font-size:12px;margin-top:6px;
  }
  th,td{
    border:1px solid rgba(148,163,184,.4);
    padding:6px 5px;
  }
  th{background:#020617;font-weight:600;}
  tr:nth-child(even){background:rgba(15,23,42,.8);}
  .actions button{margin-right:4px;margin-bottom:2px;}
  .stat-box span{margin-right:10px;}
  a.nav{
    display:inline-block;margin-top:10px;margin-right:8px;
    color:#e0e7ff;text-decoration:none;font-size:13px;
  }
  input[type="file"]{padding:4px 0;}

  /* search zone */
  .search-grid{margin-top:6px;}
  .search-grid label{font-size:12px;margin-top:0;}
  .search-grid input,.search-grid select{font-size:12px;padding:5px 8px;}
</style>
</head>
<body>

<header>
  <h1>üèõÔ∏è FA DB ‚Äì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ / ‡∏≠‡∏õ‡∏ó. ‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</h1>
  <p>Master Local Government Database ‚Äì Shared Across All FA Systems</p>
</header>

<div class="wrap">

  <div class="top-row">
    <div>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <strong id="userEmail">-</strong></div>
    <div class="stat-box">
      üëÅ ‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ: <strong id="statCurrent">0</strong>
      üîÑ ‡∏™‡∏∞‡∏™‡∏°: <strong id="statTotal">0</strong>
    </div>
  </div>

  <!-- üü¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô) -->
  <div class="card">
    <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Äì ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / ‡∏≠‡∏õ‡∏ó. (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö)</h2>
    <div style="font-size:12px;color:var(--muted);margin-bottom:4px;">
      ‚Ä¢ ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage key: <code>fa-db-data-gov</code><br>
      ‚Ä¢ ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö FA, Tracking, Review, Learning, Cash Board ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:<br>
      <code>JSON.parse(localStorage.getItem("fa-db-data-gov") || "[]")</code><br>
    </div>

    <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
    <div style="font-size:12px;color:var(--muted);margin-top:4px;">
      üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏° <strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î / ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡∏ï‡∏≥‡∏ö‡∏• / ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</strong>
    </div>
    <div class="form-grid search-grid">
      <div>
        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å + ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ)</label>
        <input type="text" id="s-unit" class="search-input"
               list="unitList" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à">
        <datalist id="unitList"></datalist>
      </div>
      <div>
        <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)</label>
        <select id="s-province" class="search-input">
          <option value="">‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
        </select>
      </div>
      <div>
        <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï (‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å + ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ)</label>
        <input type="text" id="s-district" class="search-input"
               list="districtList" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï">
        <datalist id="districtList"></datalist>
      </div>
      <div>
        <label>‡∏ï‡∏≥‡∏ö‡∏• / ‡πÅ‡∏Ç‡∏ß‡∏á (‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å + ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ)</label>
        <input type="text" id="s-subdistrict" class="search-input"
               list="subdistrictList" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á">
        <datalist id="subdistrictList"></datalist>
      </div>
      <div>
        <label>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô / ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô/‡∏ä‡∏∏‡∏°‡∏ä‡∏ô)</label>
        <input type="text" id="s-village" class="search-input"
               list="villageList" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô/‡∏ä‡∏∏‡∏°‡∏ä‡∏ô">
        <datalist id="villageList"></datalist>
      </div>
    </div>
    <div class="btn-row">
      <button type="button" class="btn-primary" id="btnSearch">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button type="button" class="btn-secondary" id="btnSearchReset">‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
      <button type="button" class="btn-secondary" id="btnViewLG">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div class="btn-row">
      <label style="font-size:12px;">
        üì• Import CSV:
        <input type="file" id="csvFile" accept=".csv">
      </label>
      <button type="button" class="btn-secondary" id="btnExportCsv">üì§ Export CSV (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)</button>
      <button type="button" class="btn-secondary" id="btnExportExcel">üìë Export Excel</button>
      <button type="button" class="btn-secondary" id="btnExportPDF">üñ® Export PDF</button>
      <button type="button" class="btn-danger" id="btnDeleteAll">üóë ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div style="font-size:12px;color:var(--muted);margin-top:4px;">
      ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• fa-db-data-gov)
    </div>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>‡∏£‡∏´‡∏±‡∏™</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡∏Å‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</th>
          <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</th>
          <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
          <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
          <th>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</th>
          <th>‡∏ï‡∏≥‡∏ö‡∏•</th>
          <th>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</th>
          <th>‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</th>
          <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="dataBody"></tbody>
    </table>
  </div>

  <!-- üü© ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏¢‡πâ‡∏≤‡∏¢‡∏•‡∏á‡∏°‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á) -->
  <div class="card">
    <h2>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Äì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</h2>
    <form id="dataForm">
      <div class="form-grid">
        <div>
          <label>‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó. (code)</label>
          <input type="text" id="f-code" required placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó.">
        </div>
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏õ‡∏ó. (name)</label>
          <input type="text" id="f-name" required value="‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©">
        </div>
        <div>
          <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à (audit unit)</label>
          <input type="text" id="f-unit" list="unitList"
                 placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ï‡∏≥‡∏ö‡∏•..., ‡∏≠‡∏ö‡∏ï....">
        </div>
        <div>
          <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó. (type)</label>
          <input type="text" id="f-type" placeholder="‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏ö‡∏ï./‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ô‡∏Ñ‡∏£ ‡∏Ø‡∏•‡∏Ø">
        </div>
        <div>
          <label>‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á (ministry)</label>
          <input type="text" id="f-ministry" value="‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢">
        </div>
        <div>
          <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (level)</label>
          <input type="text" id="f-level" value="‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô">
        </div>
        <div>
          <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (province)</label>
          <select id="f-province">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option>
          </select>
        </div>
        <div>
          <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ / ‡πÄ‡∏Ç‡∏ï (district)</label>
          <input type="text" id="f-district">
        </div>
        <div>
          <label>‡∏ï‡∏≥‡∏ö‡∏• / ‡πÅ‡∏Ç‡∏ß‡∏á (subdistrict)</label>
          <input type="text" id="f-subdistrict">
        </div>
        <div>
          <label>‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô / ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô (village)</label>
          <input type="text" id="f-village">
        </div>
        <div>
          <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà / ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà (address / moo)</label>
          <input type="text" id="f-address">
        </div>
        <div>
          <label>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå (zipcode)</label>
          <input type="text" id="f-zipcode">
        </div>
        <div>
          <label>‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î (LAT)</label>
          <input type="text" id="f-lat">
        </div>
        <div>
          <label>‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î (LONG)</label>
          <input type="text" id="f-long">
        </div>
        <div>
          <label>‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (website)</label>
          <input type="text" id="f-website">
        </div>
      </div>
      <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (remark)</label>
      <textarea id="f-remark"></textarea>

      <div class="btn-row">
        <button type="submit" class="btn-primary" id="btnSave">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button type="button" class="btn-secondary" id="btnClear">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
      </div>
    </form>
  </div>

  <a href="fa-database-menu.html" class="nav">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
  <a href="index.html" class="nav">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>

</div>

<script>
/* ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î */
const PROVINCES = [
  "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£","‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà","‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ","‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå","‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£",
  "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô","‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ","‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤","‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ","‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó",
  "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥","‡∏ä‡∏∏‡∏°‡∏û‡∏£","‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà","‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢","‡∏ï‡∏£‡∏±‡∏á",
  "‡∏ï‡∏£‡∏≤‡∏î","‡∏ï‡∏≤‡∏Å","‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å","‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°","‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°",
  "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤","‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä","‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå","‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ","‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™",
  "‡∏ô‡πà‡∏≤‡∏ô","‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå","‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ","‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå",
  "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ","‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ","‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤","‡∏û‡∏∞‡πÄ‡∏¢‡∏≤","‡∏û‡∏±‡∏á‡∏á‡∏≤",
  "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á","‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£","‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å","‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ","‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå",
  "‡πÅ‡∏û‡∏£‡πà","‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï","‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°","‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£","‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô",
  "‡∏¢‡∏∞‡∏•‡∏≤","‡∏¢‡πÇ‡∏™‡∏ò‡∏£","‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î","‡∏£‡∏∞‡∏ô‡∏≠‡∏á","‡∏£‡∏∞‡∏¢‡∏≠‡∏á",
  "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ","‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ","‡∏•‡∏≥‡∏õ‡∏≤‡∏á","‡∏•‡∏≥‡∏û‡∏π‡∏ô","‡πÄ‡∏•‡∏¢",
  "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©","‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","‡∏™‡∏á‡∏Ç‡∏•‡∏≤","‡∏™‡∏ï‡∏π‡∏•","‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£",
  "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°","‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£","‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß","‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ","‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ",
  "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢","‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ","‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ","‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå","‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢",
  "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π","‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á","‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç","‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ","‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå",
  "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ","‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"
];

const MODULE_KEY   = "gov";
const STORAGE_KEY  = "fa-db-data-" + MODULE_KEY;   // = fa-db-data-gov
const TOTAL_KEY    = "fa-db-total-" + MODULE_KEY;
const SESSION_KEY  = "fa-db-session-" + MODULE_KEY;

let data = [];
let editIndex = -1;
let lgOnly = false; // mode "‡∏î‡∏π‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô"

/* element refs */
const fCode        = document.getElementById("f-code");
const fName        = document.getElementById("f-name");
const fUnit        = document.getElementById("f-unit");
const fType        = document.getElementById("f-type");
const fMinistry    = document.getElementById("f-ministry");
const fLevel       = document.getElementById("f-level");
const fProvince    = document.getElementById("f-province");
const fDistrict    = document.getElementById("f-district");
const fSubdistrict = document.getElementById("f-subdistrict");
const fVillage     = document.getElementById("f-village");
const fAddress     = document.getElementById("f-address");
const fZipcode     = document.getElementById("f-zipcode");
const fLat         = document.getElementById("f-lat");
const fLong        = document.getElementById("f-long");
const fWebsite     = document.getElementById("f-website");
const fRemark      = document.getElementById("f-remark");

const btnSave        = document.getElementById("btnSave");
const btnClear       = document.getElementById("btnClear");
const btnDeleteAll   = document.getElementById("btnDeleteAll");
const btnExportCsv   = document.getElementById("btnExportCsv");
const btnExportExcel = document.getElementById("btnExportExcel");
const btnExportPDF   = document.getElementById("btnExportPDF");
const csvFile        = document.getElementById("csvFile");
const btnSearch      = document.getElementById("btnSearch");
const btnSearchReset = document.getElementById("btnSearchReset");
const btnViewLG      = document.getElementById("btnViewLG");

function populateProvinces(){
  const sProvince = document.getElementById("s-province");
  // ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  fProvince.innerHTML = "";
  let opt0 = document.createElement("option");
  opt0.value = "";
  opt0.textContent = "-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --";
  fProvince.appendChild(opt0);
  PROVINCES.forEach(p=>{
    const o = document.createElement("option");
    o.value = p;
    o.textContent = p;
    fProvince.appendChild(o);
  });
  // default ‡πÉ‡∏´‡πâ‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
  fProvince.value = "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©";

  // dropdown ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
  sProvince.innerHTML = "";
  const o0 = document.createElement("option");
  o0.value = "";
  o0.textContent = "‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î";
  sProvince.appendChild(o0);
  PROVINCES.forEach(p=>{
    const o = document.createElement("option");
    o.value = p;
    o.textContent = p;
    sProvince.appendChild(o);
  });
}

function checkSession(){
  const raw = localStorage.getItem("fas-session");
  if(!raw){ location.href="fa-database-login.html"; return; }
  try{
    const s = JSON.parse(raw);
    if(Date.now()>s.expiresAt){
      localStorage.removeItem("fas-session");
      location.href="fa-database-login.html";
      return;
    }
    document.getElementById("userEmail").textContent = s.email || "-";
  }catch{
    location.href="fa-database-login.html";
  }
}

function updateStatsOnLoad(){
  const total = Number(localStorage.getItem(TOTAL_KEY) || "0") + 1;
  const curr  = Number(sessionStorage.getItem(SESSION_KEY) || "0") + 1;
  localStorage.setItem(TOTAL_KEY, String(total));
  sessionStorage.setItem(SESSION_KEY, String(curr));
  document.getElementById("statTotal").textContent = total;
  document.getElementById("statCurrent").textContent = curr;
}

function loadData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    data = raw ? JSON.parse(raw) : [];
  }catch{ data=[]; }
}
function saveData(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  populateSearchDatalists();
}

function getFilters(){
  const fu = (document.getElementById("s-unit").value || "").trim().toLowerCase();
  const fp = (document.getElementById("s-province").value || "").trim().toLowerCase();
  const fd = (document.getElementById("s-district").value || "").trim().toLowerCase();
  const fsd= (document.getElementById("s-subdistrict").value || "").trim().toLowerCase();
  const fv = (document.getElementById("s-village").value || "").trim().toLowerCase();
  return {fu,fp,fd,fsd,fv};
}
function matchField(value, filter){
  if(!filter) return true;
  if(!value) return false;
  return value.toString().toLowerCase().includes(filter);
}

function renderTable(){
  const tbody = document.getElementById("dataBody");
  tbody.innerHTML = "";

  const hasData = data.length > 0;
  const f = getFilters();

  let rows = data.filter(row=>
    matchField(row.unit,        f.fu) &&
    matchField(row.province,    f.fp) &&
    matchField(row.district,    f.fd) &&
    matchField(row.subdistrict, f.fsd) &&
    matchField(row.village,     f.fv)
  );

  if(lgOnly){
    rows = rows.filter(r => (r.level || "").includes("‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô"));
  }

  // 1) ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
  if(!hasData){
    tbody.innerHTML = `
      <tr>
        <td colspan="12" style="text-align:center;color:#9ca3af;">
          ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô <code>fa-db-data-gov</code> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° <strong>Import CSV</strong><br>
          ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå <strong>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏≠‡∏õ‡∏ó. ‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢.csv</strong> ‡∏Å‡πà‡∏≠‡∏ô
        </td>
      </tr>`;
    return;
  }

  // 2) ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
  if(rows.length === 0){
    tbody.innerHTML = `
      <tr>
        <td colspan="12" style="text-align:center;color:#9ca3af;">
          ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        </td>
      </tr>`;
    return;
  }

  // 3) ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏Å‡∏ï‡∏¥
  rows.forEach((row,idx)=>{
    const tr = document.createElement("tr");
    const detailUrl = "fa-lg-detail.html?code=" + encodeURIComponent(row.code || "");
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${row.code||""}</td>
      <td><a href="${detailUrl}" target="_blank" style="color:#60a5fa;text-decoration:underline;">${row.name||""}</a></td>
      <td>${row.unit||""}</td>
      <td>${row.type||""}</td>
      <td>${row.province||""}</td>
      <td>${row.district||""}</td>
      <td>${row.subdistrict||""}</td>
      <td>${row.village||""}</td>
      <td>${row.website||""}</td>
      <td>${row.remark||""}</td>
      <td class="actions">
        <button type="button" onclick="editRow(${data.indexOf(row)})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button type="button" onclick="deleteRow(${data.indexOf(row)})">‡∏•‡∏ö</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function clearForm(){
  fCode.value="";
  fName.value="‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©";
  fUnit.value="";
  fType.value="";
  fMinistry.value="‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢";
  fLevel.value="‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô";
  fProvince.value="‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©";
  fDistrict.value="";
  fSubdistrict.value="";
  fVillage.value="";
  fAddress.value="";
  fZipcode.value="";
  fLat.value="";
  fLong.value="";
  fWebsite.value="";
  fRemark.value="";
  editIndex=-1;
  btnSave.textContent="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
}

document.getElementById("dataForm").addEventListener("submit", e=>{
  e.preventDefault();
  const row = {
    code:       fCode.value.trim(),
    name:       fName.value.trim(),
    unit:       (fUnit.value.trim() || fName.value.trim()),
    type:       fType.value.trim(),
    ministry:   fMinistry.value.trim(),
    level:      fLevel.value.trim(),
    province:   fProvince.value.trim(),
    district:   fDistrict.value.trim(),
    subdistrict:fSubdistrict.value.trim(),
    village:    fVillage.value.trim(),
    address:    fAddress.value.trim(),
    zipcode:    fZipcode.value.trim(),
    lat:        fLat.value.trim(),
    long:       fLong.value.trim(),
    website:    fWebsite.value.trim(),
    remark:     fRemark.value.trim(),
    updatedAt:new Date().toISOString()
  };
  if(editIndex===-1){
    row.createdAt=row.updatedAt;
    data.push(row);
  }else{
    data[editIndex]={...data[editIndex],...row};
  }
  saveData(); renderTable(); clearForm();
});
btnClear.addEventListener("click", clearForm);

window.editRow=function(idx){
  const r=data[idx];
  fCode.value        = r.code||"";
  fName.value        = r.name||"";
  fUnit.value        = r.unit||"";
  fType.value        = r.type||"";
  fMinistry.value    = r.ministry||"";
  fLevel.value       = r.level||"";
  fProvince.value    = r.province||"";
  fDistrict.value    = r.district||"";
  fSubdistrict.value = r.subdistrict||"";
  fVillage.value     = r.village||"";
  fAddress.value     = r.address||"";
  fZipcode.value     = r.zipcode||"";
  fLat.value         = r.lat||"";
  fLong.value        = r.long||"";
  fWebsite.value     = r.website||"";
  fRemark.value      = r.remark||"";
  editIndex=idx;
  btnSave.textContent="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
};
window.deleteRow=function(idx){
  if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) return;
  data.splice(idx,1);
  saveData(); renderTable();
};

btnDeleteAll.addEventListener("click", ()=>{
  if(!confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ?")) return;
  data=[]; saveData(); renderTable();
});

function toCSV(){
  const header=[
    "code","name","unit","type","ministry","level",
    "province","district","subdistrict","village",
    "address","zipcode","lat","long","website","remark"
  ];
  const lines=[header.join(",")];
  data.forEach(r=>{
    const row=header.map(k=>{
      const v=(r[k]||"").toString().replace(/"/g,'""');
      return `"${v}"`;
    });
    lines.push(row.join(","));
  });
  return lines.join("\r\n");
}
btnExportCsv.addEventListener("click", ()=>{
  const csv=toCSV();
  const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;a.download="fa-db-lg-master.csv";
  document.body.appendChild(a);a.click();document.body.removeChild(a);
  URL.revokeObjectURL(url);
});
btnExportExcel.addEventListener("click", ()=>{
  const csv=toCSV();
  const blob=new Blob([csv],{type:"application/vnd.ms-excel;charset=utf-8;"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;a.download="fa-db-lg-master.xls";
  document.body.appendChild(a);a.click();document.body.removeChild(a);
  URL.revokeObjectURL(url);
});
btnExportPDF.addEventListener("click", ()=>{
  const tableHtml = document.querySelector("table").outerHTML;
  const win = window.open("", "_blank");
  win.document.write(`
    <html>
      <head><title>FA DB ‚Äì ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</title></head>
      <body>
        <h3 style="font-family:sans-serif;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / ‡∏≠‡∏õ‡∏ó.</h3>
        ${tableHtml}
      </body>
    </html>
  `);
  win.document.close();
  win.focus();
  win.print();
});

/* Import: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö) ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå ‡∏≠‡∏õ‡∏ó. ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ */
csvFile.addEventListener("change", e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=evt=>importCSV(evt.target.result);
  reader.readAsText(file,"utf-8");
});
function importCSV(text){
  const lines=text.split(/\r?\n/).filter(l=>l.trim()!=="");
  if(lines.length<2){alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");return;}
  const header=lines[0].split(",").map(h=>h.replace(/(^"|"$)/g,"").trim());

  const isThaiLG =
    header.indexOf("‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î")    !== -1 &&
    header.indexOf("‡∏≠‡∏≥‡πÄ‡∏†‡∏≠")      !== -1 &&
    header.indexOf("‡∏ï‡∏≥‡∏ö‡∏•")       !== -1 &&
    header.indexOf("‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó.") !== -1;

  const imported=[];
  if(isThaiLG){
    const idxs = {
      province:   header.indexOf("‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"),
      district:   header.indexOf("‡∏≠‡∏≥‡πÄ‡∏†‡∏≠"),
      subdistrict:header.indexOf("‡∏ï‡∏≥‡∏ö‡∏•"),
      code:       header.indexOf("‡∏£‡∏´‡∏±‡∏™ ‡∏≠‡∏õ‡∏ó."),
      type:       header.indexOf("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏≠‡∏õ‡∏ó."),
      name:       header.indexOf("‡∏≠‡∏õ‡∏ó."),
      addrNo:     header.indexOf("‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà"),
      moo:        header.indexOf("‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà"),
      zipcode:    header.indexOf("‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå"),
      lat:        header.indexOf("LAT"),
      long:       header.indexOf("LONG"),
      website:    header.indexOf("‡πÄ‡∏ß‡πá‡∏õ‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏≠‡∏õ‡∏ó")
    };
    for(let i=1;i<lines.length;i++){
      const cols=lines[i].split(",").map(c=>c.replace(/(^"|"$)/g,""));
      if(cols.length===0) continue;
      const name      = cols[idxs.name] || "";
      const province  = cols[idxs.province] || "";
      const district  = cols[idxs.district] || "";
      const subd      = cols[idxs.subdistrict] || "";
      imported.push({
        code: (cols[idxs.code] || "").toString(),
        name: name,
        unit: name,
        type: cols[idxs.type] || "",
        ministry: "",
        level: "‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô",
        province: province,
        district: district,
        subdistrict: subd,
        village: "",
        address: ((cols[idxs.addrNo]||"") + " ‡∏°." + (cols[idxs.moo]||"")).trim(),
        zipcode: cols[idxs.zipcode] || "",
        lat: cols[idxs.lat] || "",
        long: cols[idxs.long] || "",
        website: cols[idxs.website] || "",
        remark: "",
        createdAt:new Date().toISOString(),
        updatedAt:new Date().toISOString()
      });
    }
  }else{
    const idxs={
      code:header.indexOf("code"),
      name:header.indexOf("name"),
      unit:header.indexOf("unit"),
      type:header.indexOf("type"),
      ministry:header.indexOf("ministry"),
      level:header.indexOf("level"),
      province:header.indexOf("province"),
      district:header.indexOf("district"),
      subdistrict:header.indexOf("subdistrict"),
      village:header.indexOf("village"),
      address:header.indexOf("address"),
      zipcode:header.indexOf("zipcode"),
      lat:header.indexOf("lat"),
      long:header.indexOf("long"),
      website:header.indexOf("website"),
      remark:header.indexOf("remark")
    };
    for(const k in idxs){
      if(idxs[k]===-1){
        alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö");
        return;
      }
    }
    for(let i=1;i<lines.length;i++){
      const cols=lines[i].split(",").map(c=>c.replace(/(^"|"$)/g,""));
      if(cols.length===0) continue;
      imported.push({
        code:cols[idxs.code]||"",
        name:cols[idxs.name]||"",
        unit:cols[idxs.unit]||"",
        type:cols[idxs.type]||"",
        ministry:cols[idxs.ministry]||"",
        level:cols[idxs.level]||"",
        province:cols[idxs.province]||"",
        district:cols[idxs.district]||"",
        subdistrict:cols[idxs.subdistrict]||"",
        village:cols[idxs.village]||"",
        address:cols[idxs.address]||"",
        zipcode:cols[idxs.zipcode]||"",
        lat:cols[idxs.lat]||"",
        long:cols[idxs.long]||"",
        website:cols[idxs.website]||"",
        remark:cols[idxs.remark]||"",
        createdAt:new Date().toISOString(),
        updatedAt:new Date().toISOString()
      });
    }
  }
  data=data.concat(imported);
  saveData(); renderTable();
  alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ CSV ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢: "+imported.length+" ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
}

/* datalist ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ */
function populateSearchDatalists(){
  const unitSet = new Set();
  const distSet = new Set();
  const subdSet = new Set();
  const villSet = new Set();
  data.forEach(r=>{
    if(r.unit)       unitSet.add(r.unit);
    if(r.district)   distSet.add(r.district);
    if(r.subdistrict)subdSet.add(r.subdistrict);
    if(r.village)    villSet.add(r.village);
  });
  function fillList(id,set){
    const dl = document.getElementById(id);
    if(!dl) return;
    dl.innerHTML="";
    set.forEach(v=>{
      const opt=document.createElement("option");
      opt.value=v;
      dl.appendChild(opt);
    });
  }
  fillList("unitList",unitSet);
  fillList("districtList",distSet);
  fillList("subdistrictList",subdSet);
  fillList("villageList",villSet);
}

/* search events */
btnSearch.addEventListener("click", ()=>{
  lgOnly = false;
  renderTable();
});
document.querySelectorAll(".search-input").forEach(el=>{
  el.addEventListener("keydown", e=>{
    if(e.key==="Enter"){
      e.preventDefault();
      lgOnly = false;
      renderTable();
    }
  });
});
btnSearchReset.addEventListener("click", ()=>{
  document.getElementById("s-unit").value="";
  document.getElementById("s-province").value="";
  document.getElementById("s-district").value="";
  document.getElementById("s-subdistrict").value="";
  document.getElementById("s-village").value="";
  lgOnly = false;
  renderTable();
});
btnViewLG.addEventListener("click", ()=>{
  document.getElementById("s-unit").value="";
  document.getElementById("s-province").value="";
  document.getElementById("s-district").value="";
  document.getElementById("s-subdistrict").value="";
  document.getElementById("s-village").value="";
  lgOnly = true;
  renderTable();
});

/* init */
checkSession();
updateStatsOnLoad();
populateProvinces();
loadData();
populateSearchDatalists();
renderTable();
clearForm();
</script>

</body>
</html>
