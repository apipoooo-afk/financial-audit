<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏≠‡∏õ‡∏ó. 8.7 | Financial Audit ‚Äì Local Government</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --primary:#0d47a1;
      --primary-2:#42a5f5;
      --accent:#ffd54f;
      --accent2:#26c6da;
      --bg:#060818;
      --bg-soft:#0b1024;
      --card:#11152b;
      --text:#f5f7ff;
      --muted:#a3acc7;
      --border:#262b46;
      --maroon:#7b1e3c;
      --pink:#f48fb1;
      --shadow-soft:0 12px 30px rgba(0,0,0,0.55);
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    header{
      padding:18px 20px 14px;
      background:
        linear-gradient(120deg,#0d47a1,#7b1e3c,#42a5f5);
      box-shadow:var(--shadow-soft);
      border-bottom:1px solid rgba(255,255,255,0.12);
    }
    header h1{
      margin:0;
      font-size:24px;
      font-weight:800;
      letter-spacing:0.5px;
    }
    header p{
      margin:4px 0 0 0;
      font-size:13px;
      opacity:0.9;
    }

    .header-meta{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      font-size:12px;
      opacity:0.9;
    }
    .chip{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.25);
      display:inline-flex;
      align-items:center;
      gap:6px;
    }

    .container{
      max-width:1080px;
      margin:20px auto;
      padding:20px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow-soft);
    }

    h2{
      margin-top:0;
      margin-bottom:10px;
      border-left:5px solid var(--accent2);
      padding-left:10px;
      font-size:18px;
    }

    .section{
      margin-bottom:26px;
    }

    label{
      display:block;
      font-size:13px;
      margin-top:8px;
      color:var(--muted);
    }

    input, select, textarea{
      width:100%;
      padding:8px 10px;
      margin-top:4px;
      background:var(--bg-soft);
      border:1px solid var(--border);
      color:var(--text);
      border-radius:6px;
      font-size:13px;
    }
    textarea{resize:vertical; min-height:70px;}

    .flex{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
    }
    .flex > div{
      flex:1;
      min-width:220px;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin:14px 0 6px;
      font-size:13px;
    }
    table th, table td{
      border:1px solid var(--border);
      padding:6px 6px;
      text-align:center;
    }
    table th{
      background:rgba(7,16,46,0.9);
      font-weight:600;
      position:sticky;
      top:0;
      z-index:2;
    }
    table input{
      width:100%;
      border:none;
      background:transparent;
      text-align:right;
      font-size:13px;
      color:var(--text);
    }
    td[contenteditable="true"]{
      text-align:left;
      background:rgba(255,255,255,0.02);
    }

    tfoot td{
      font-weight:700;
      background:rgba(4,12,40,0.95);
    }

    .btn{
      padding:9px 14px;
      border:none;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      color:#fff;
      margin:4px 6px 4px 0;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn span{font-size:14px;}
    .btn-primary{background:var(--primary);}
    .btn-accent{background:var(--accent); color:#000;}
    .btn-pink{background:var(--pink);}
    .btn-soft{background:var(--border);}
    .btn-danger{background:#ef5350;}

    .attachment-box{
      background:var(--bg-soft);
      border:1px dashed var(--pink);
      padding:10px 12px;
      border-radius:12px;
      margin-top:10px;
      font-size:13px;
      max-height:120px;
      overflow:auto;
    }

    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:4px;
    }

    .note{
      font-size:11px;
      color:var(--muted);
      margin-top:4px;
    }

    .summary-panel{
      background:rgba(4,12,40,0.9);
      border-radius:12px;
      padding:10px 12px;
      font-size:12px;
      border:1px solid var(--border);
      margin-top:6px;
    }

    .summary-panel strong{
      color:var(--accent2);
    }

    .badge{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      background:rgba(66,165,245,0.12);
      border:1px solid rgba(66,165,245,0.5);
      margin-left:6px;
    }

    .print-hint{
      font-size:11px;
      color:var(--muted);
      margin-top:2px;
    }

    @media (max-width:768px){
      .container{margin:10px;}
      header h1{font-size:20px;}
    }

    /* --- A4 Print Style --- */
    @media print{
      body{
        background:#fff;
        -webkit-print-color-adjust:exact;
        print-color-adjust:exact;
      }
      header{
        border-radius:0;
      }
      .container{
        box-shadow:none;
        border:none;
        margin:0;
        max-width:100%;
      }
      .no-print{display:none !important;}
      table{
        font-size:11px;
      }
      @page{
        size:A4 portrait;
        margin:15mm;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>‡∏≠‡∏õ‡∏ó. 8.7 ‚Äì ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h1>
  <p>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡∏à‡∏≤‡∏Å ‡∏≠‡∏õ‡∏ó. 8.3, 8.4, 8.5, 8.6 | ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‚Äì‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
  <div class="header-meta">
    <div class="chip">üìÅ <span>Financial Audit ‚Äì Local Government</span></div>
    <div class="chip">üßÆ <span>‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö 2 ‡∏õ‡∏µ + ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á + % ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</span></div>
  </div>
</header>

<div class="container">

  <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à -->
  <div class="section">
    <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à</h2>
    <div class="flex">
      <div>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à / Local Government Entity</label>
        <input type="text" id="orgName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©">
      </div>
      <div>
        <label>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô) / Fiscal Year (Current)</label>
        <select id="fiscalYear">
          <option value="2569">2569</option>
          <option value="2568" selected>2568</option>
          <option value="2567">2567</option>
          <option value="2566">2566</option>
        </select>
      </div>
      <div>
        <label>‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö / Auditor</label>
        <input type="text" id="auditorName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö / Audit Team">
      </div>
    </div>
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å -->
  <div class="section">
    <h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏≠‡∏õ‡∏ó. 8.7 <span class="badge">20‚Äì50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></h2>
    <div class="toolbar no-print">
      <button class="btn btn-soft" onclick="addRow()"><span>‚ûï</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß</button>
      <button class="btn btn-danger" onclick="removeLastRow()"><span>üóë</span> ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡πâ‡∏≤‡∏¢</button>
      <button class="btn btn-primary" onclick="recalculate()"><span>üßÆ</span> ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà</button>
    </div>
    <div class="note no-print">
      * ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‚Äú‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‚Äù ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á  
      * ‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ) ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Äú‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú% ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‚Äù ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    </div>

    <div style="max-height:420px; overflow:auto; margin-top:10px;">
      <table id="mainTable">
        <thead>
          <tr>
            <th style="width:40px;">‡∏•‡∏≥‡∏î‡∏±‡∏ö<br>No.</th>
            <th style="min-width:220px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br>Item</th>
            <th style="width:110px;">‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô<br>Current Year</th>
            <th style="width:110px;">‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô<br>Prior Year</th>
            <th style="width:110px;">‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á<br>Difference</th>
            <th style="width:100px;">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (%)<br>% Change</th>
            <th style="min-width:180px;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏<br>Remark</th>
          </tr>
        </thead>
        <tbody>
          <!-- 30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ) -->
          <!-- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ / ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ / ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ / ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå ‡∏Ø‡∏•‡∏Ø ‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏° 8.3‚Äì8.6 -->

          <!-- 1‚Äì5 ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ / ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ -->
          <tr>
            <td>1</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 1 / ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>2</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 2 / ‡∏†‡∏≤‡∏©‡∏µ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>3</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 3 / ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>4</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 4 / ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>5</td>
            <td contenteditable="true">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>

          <!-- 6‚Äì10 ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ / ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô -->
          <tr>
            <td>6</td>
            <td contenteditable="true">‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 1 / ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>7</td>
            <td contenteditable="true">‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 2 / ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>8</td>
            <td contenteditable="true">‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>9</td>
            <td contenteditable="true">‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß / ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>10</td>
            <td contenteditable="true">‡∏™‡∏£‡∏∏‡∏õ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>

          <!-- 11‚Äì15 ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ / ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô‚Äì‡∏¢‡∏≤‡∏ß -->
          <tr>
            <td>11</td>
            <td contenteditable="true">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 1 / ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>12</td>
            <td contenteditable="true">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á/‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>13</td>
            <td contenteditable="true">‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>14</td>
            <td contenteditable="true">‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß / ‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>15</td>
            <td contenteditable="true">‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>

          <!-- 16‚Äì20 ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ñ‡∏≤‡∏ß‡∏£ / ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô -->
          <tr>
            <td>16</td>
            <td contenteditable="true">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ñ‡∏≤‡∏ß‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 1 / ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>17</td>
            <td contenteditable="true">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ñ‡∏≤‡∏ß‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà 2 / ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>18</td>
            <td contenteditable="true">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡∏ñ‡∏ô‡∏ô/‡∏™‡∏∞‡∏û‡∏≤‡∏ô ‡∏Ø‡∏•‡∏Ø)</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>19</td>
            <td contenteditable="true">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>20</td>
            <td contenteditable="true">‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ñ‡∏≤‡∏ß‡∏£‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>

          <!-- 21‚Äì30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ / ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
          <tr>
            <td>21</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 1 / ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏≠‡∏∑‡πà‡∏ô</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>22</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 2</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>23</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 3</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>24</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 4</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>25</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 5</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>26</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 6</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>27</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 7</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>28</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 8</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>29</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 9</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
          <tr>
            <td>30</td>
            <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏µ‡πà 10 / ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</td>
            <td><input type="number" class="curr"></td>
            <td><input type="number" class="prev"></td>
            <td class="diff"></td>
            <td class="pct"></td>
            <td contenteditable="true"></td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="2">‡∏£‡∏ß‡∏° (Sum)</td>
            <td id="totalCurr"></td>
            <td id="totalPrev"></td>
            <td id="totalDiff"></td>
            <td id="totalPct"></td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="summary-panel">
      ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:  
      ‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏° <strong id="summaryCurr">0</strong> | ‡∏õ‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏ß‡∏° <strong id="summaryPrev">0</strong> | ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏° <strong id="summaryDiff">0</strong>  
      ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <strong id="summaryPct">0%</strong> (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°)
    </div>
  </div>

  <!-- ‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
  <div class="section">
    <h2>‡πÅ‡∏ô‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</h2>
    <div class="toolbar no-print">
      <button class="btn btn-pink" onclick="document.getElementById('attach').click()">
        <span>üìé</span> ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå (Attach Files)
      </button>
      <button class="btn btn-soft" onclick="autoAttachFromWP()">
        <span>üîó</span> ‡πÅ‡∏ô‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (WP / Data Center)
      </button>
    </div>
    <input id="attach" type="file" multiple style="display:none">
    <div class="attachment-box" id="attachList">
      <p style="margin:0; color:var(--muted);">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</p>
    </div>
    <div class="note">
      * ‡πÉ‡∏ä‡πâ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ó‡∏≥‡∏Å‡∏≤‡∏£, ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢, ‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö ‡∏≠‡∏õ‡∏ó. 8.7
    </div>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å -->
  <div class="section no-print">
    <h2>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <div class="toolbar">
      <button class="btn btn-primary" onclick="loadData()"><span>‚è¨</span> ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô (Load)</button>
      <button class="btn btn-accent" onclick="saveData()"><span>üíæ</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Save)</button>
      <button class="btn btn-pink" onclick="aiSummary()"><span>ü§ñ</span> AI ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡∏∏‡∏õ</button>
      <button class="btn btn-soft" onclick="window.print()"><span>üñ®</span> Export A4 / Print to PDF</button>
      <button class="btn btn-soft" onclick="window.location.href='fa-lg-fieldwork.html'"><span>üè†</span> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å Fieldwork</button>
    </div>
    <div class="print-hint">
      Export A4: ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° ‚ÄúExport A4 / Print to PDF‚Äù ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Printer ‡πÄ‡∏õ‡πá‡∏ô ‚ÄúSave as PDF‚Äù / ‚Äú‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏õ‡πá‡∏ô PDF‚Äù ‚Üí ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4
    </div>
  </div>

</div>

<script>
/* ----------------------------
   ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå
-----------------------------*/
document.getElementById('attach').addEventListener('change', function(){
  const list = document.getElementById('attachList');
  list.innerHTML = "";
  if(this.files.length === 0){
    list.innerHTML = '<p style="margin:0; color:var(--muted);">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</p>';
    return;
  }
  for(const f of this.files){
    const item = document.createElement("div");
    item.textContent = "üìé " + f.name;
    list.appendChild(item);
  }
});

function autoAttachFromWP(){
  // ‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/WordPress ‡∏´‡∏£‡∏∑‡∏≠ Data Center
  alert("autoAttachFromWP(): ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á / WP (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î API endpoint ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)");
}

/* ----------------------------
   ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
-----------------------------*/
function recalculate(){
  const rows = document.querySelectorAll("#mainTable tbody tr");
  let totalCurr = 0;
  let totalPrev = 0;

  rows.forEach(row => {
    const currInput = row.querySelector(".curr");
    const prevInput = row.querySelector(".prev");
    const diffCell = row.querySelector(".diff");
    const pctCell = row.querySelector(".pct");

    const curr = currInput && currInput.value !== "" ? parseFloat(currInput.value) : 0;
    const prev = prevInput && prevInput.value !== "" ? parseFloat(prevInput.value) : 0;

    const diff = curr - prev;
    let pct = 0;
    if(prev !== 0){
      pct = (diff / prev) * 100;
    }else if(curr !== 0){
      pct = 100;
    }

    if(!isNaN(curr)) totalCurr += curr;
    if(!isNaN(prev)) totalPrev += prev;

    if(diffCell){
      diffCell.textContent = diff === 0 ? "" : diff.toLocaleString(undefined,{maximumFractionDigits:2});
    }
    if(pctCell){
      pctCell.textContent = (pct === 0 ? "" : pct.toFixed(2) + "%");
    }
  });

  const totalDiff = totalCurr - totalPrev;
  let totalPct = 0;
  if(totalPrev !== 0){
    totalPct = (totalDiff / totalPrev) * 100;
  }else if(totalCurr !== 0){
    totalPct = 100;
  }

  document.getElementById("totalCurr").textContent = totalCurr === 0 ? "" : totalCurr.toLocaleString(undefined,{maximumFractionDigits:2});
  document.getElementById("totalPrev").textContent = totalPrev === 0 ? "" : totalPrev.toLocaleString(undefined,{maximumFractionDigits:2});
  document.getElementById("totalDiff").textContent = totalDiff === 0 ? "" : totalDiff.toLocaleString(undefined,{maximumFractionDigits:2});
  document.getElementById("totalPct").textContent = totalPct === 0 ? "" : totalPct.toFixed(2) + "%";

  document.getElementById("summaryCurr").textContent = totalCurr.toLocaleString(undefined,{maximumFractionDigits:2});
  document.getElementById("summaryPrev").textContent = totalPrev.toLocaleString(undefined,{maximumFractionDigits:2});
  document.getElementById("summaryDiff").textContent = totalDiff.toLocaleString(undefined,{maximumFractionDigits:2});
  document.getElementById("summaryPct").textContent = totalPct.toFixed(2) + "%";
}

/* Auto recalc on change */
document.addEventListener("input", function(e){
  if(e.target.classList.contains("curr") || e.target.classList.contains("prev")){
    recalculate();
  }
});

/* ----------------------------
   ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50)
-----------------------------*/
function updateRowNumbers(){
  const rows = document.querySelectorAll("#mainTable tbody tr");
  rows.forEach((row, idx) => {
    const cell = row.querySelector("td:first-child");
    if(cell) cell.textContent = idx + 1;
  });
}

function addRow(){
  const tbody = document.querySelector("#mainTable tbody");
  const currentRows = tbody.querySelectorAll("tr").length;
  if(currentRows >= 50){
    alert("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß");
    return;
  }
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td></td>
    <td contenteditable="true">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà ${currentRows + 1}</td>
    <td><input type="number" class="curr"></td>
    <td><input type="number" class="prev"></td>
    <td class="diff"></td>
    <td class="pct"></td>
    <td contenteditable="true"></td>
  `;
  tbody.appendChild(tr);
  updateRowNumbers();
}

function removeLastRow(){
  const tbody = document.querySelector("#mainTable tbody");
  const rows = tbody.querySelectorAll("tr");
  if(rows.length <= 1){
    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÅ‡∏ñ‡∏ß)");
    return;
  }
  tbody.removeChild(rows[rows.length - 1]);
  updateRowNumbers();
  recalculate();
}

/* ----------------------------
   ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á (‡πÇ‡∏Ñ‡∏£‡∏á)
   NOTE: ‡πÅ‡∏Å‡πâ URL endpoint ‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á JSON ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö backend ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
-----------------------------*/
async function loadData(){
  try{
    const org = document.getElementById("orgName").value || "";
    const year = document.getElementById("fiscalYear").value || "";
    if(!org || !year){
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
      return;
    }

    // TODO: ‡πÅ‡∏Å‡πâ URL ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö API ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const res = await fetch("https://example.com/api/fa-lg-8-7?org="+encodeURIComponent(org)+"&year="+encodeURIComponent(year));
    if(!res.ok){
      throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
    }
    const data = await res.json();

    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: { rows: [{item,curr,prev,remark}, ...] }
    if(Array.isArray(data.rows)){
      const tbody = document.querySelector("#mainTable tbody");
      const rows = tbody.querySelectorAll("tr");
      rows.forEach((row, idx) => {
        const r = data.rows[idx];
        if(!r) return;
        const itemCell = row.cells[1];
        const currInput = row.querySelector(".curr");
        const prevInput = row.querySelector(".prev");
        const remarkCell = row.cells[6];

        if(itemCell && r.item !== undefined) itemCell.textContent = r.item;
        if(currInput && r.curr !== undefined) currInput.value = r.curr;
        if(prevInput && r.prev !== undefined) prevInput.value = r.prev;
        if(remarkCell && r.remark !== undefined) remarkCell.textContent = r.remark;
      });
      recalculate();
      alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    }else{
      alert("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á");
    }
  }catch(err){
    console.error(err);
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API endpoint)");
  }
}

async function saveData(){
  try{
    const org = document.getElementById("orgName").value || "";
    const year = document.getElementById("fiscalYear").value || "";
    const auditor = document.getElementById("auditorName").value || "";

    if(!org || !year){
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
      return;
    }

    const rows = [];
    document.querySelectorAll("#mainTable tbody tr").forEach(row => {
      const item = row.cells[1]?.textContent?.trim() || "";
      const curr = row.querySelector(".curr")?.value || "";
      const prev = row.querySelector(".prev")?.value || "";
      const remark = row.cells[6]?.textContent?.trim() || "";
      rows.push({item, curr: curr === "" ? null : Number(curr), prev: prev === "" ? null : Number(prev), remark});
    });

    const payload = {
      orgName: org,
      fiscalYear: year,
      auditor,
      rows
    };

    // TODO: ‡πÅ‡∏Å‡πâ URL ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö API ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const res = await fetch("https://example.com/api/fa-lg-8-7",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });

    if(!res.ok){
      throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
    }
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß)");
  }catch(err){
    console.error(err);
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API endpoint)");
  }
}

/* ----------------------------
   AI ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡∏∏‡∏õ (‡πÇ‡∏Ñ‡∏£‡∏á)
-----------------------------*/
function aiSummary(){
  // ‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö OpenAI / Gemini / ‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
  alert("AI Summary: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡∏≠‡∏õ‡∏ó. 8.7 (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î backend ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°)");
}

/* init ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å */
window.addEventListener("load", () => {
  updateRowNumbers();
  recalculate();
});
</script>

</body>
</html>